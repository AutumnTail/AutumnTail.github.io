<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  
  <title>Hadoop 3.1.2 + Zookeeper 3.4.14 + Spark 2.4.1 + HBase 2.0.5 + Phoenix 5.0.0 高可用集群部署 | 人似秋鸿来有信，事如春梦了无痕</title>
  <meta name="description" content="" />
  <meta name="keywords" content="" />
  <meta name="HandheldFriendly" content="True" />
  <meta name="apple-mobile-web-app-capable" content="yes">
  <link rel="shortcut icon" href="/">
  <link rel="alternate" href="/atom.xml" title="人似秋鸿来有信，事如春梦了无痕">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

  <link rel="shortcut icon" href="" />
  <link rel="icon" href="" />
  <link href="https://fonts.googleapis.com/css?family=Ubuntu" rel="stylesheet">
  <link href="https://cdn.bootcss.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet">
  <link href='//cdn.bootcss.com/node-waves/0.7.5/waves.min.css' rel='stylesheet'>
  <link rel="stylesheet" href="/style.css">
  <script>
    function setLoadingBarProgress(num) {
      document.getElementById('loading-bar').style.width=num+"%";
    }
  </script>
</head>

<body>
    <div id="loading-bar-wrapper">
  <div id="loading-bar"></div>
</div>


    <script>setLoadingBarProgress(20)</script>
    <header class="l_header">
	<div class='wrapper'>
		<div class="nav-main container container--flex">
			<a class="logo flat-box" href='/' >
				<!-- <i class="fa fa-home"></i> -->
				人似秋鸿来有信，事如春梦了无痕
			</a>

				<div class='menu'>
					<ul class='h-list'>
                        
    						
    							<li>
    								<a class='nav-home flat-box' href='/'>
    									<i class='fa fa-home fa-'></i>&nbsp;主页
    								</a>
    							</li>
    						
    							<li>
    								<a class='nav-blog flat-box' href='/blog'>
    									<i class='fa fa-rss fa-'></i>&nbsp;博客
    								</a>
    							</li>
    						
    							<li>
    								<a class='nav-archives flat-box' href='/archives'>
    									<i class='fa fa-archive fa-'></i>&nbsp;归档
    								</a>
    							</li>
    						
    							<li>
    								<a class='nav-home flat-box' href='/'>
    									<i class='fa fa-user fa-'></i>&nbsp;关于我
    								</a>
    							</li>
    						
        			 
					</ul>
					<div class='underline'></div>
				</div>

			
			<ul class='switcher h-list'>
				
				<li class='s-menu'><a class="fa fa-navicon fa-fw" href='javascript:void(0)'></a></li>
			</ul>
		</div>

		<div class='nav-sub container container--flex'>
			<a class="logo" class="flat-box" href='javascript:void(0)'>
				xaoxuu
			</a>

			<ul class='switcher h-list'>
				<li class='s-comment'><a class="fa fa-comments fa-fw flat-box" href='javascript:void(0)'></a></li>
				<li class='s-top'><a class="fa fa-arrow-up fa-fw flat-box" href='javascript:void(0)'></a></li>
				<li class='s-toc'><a class="fa fa-list-ul fa-fw flat-box" href='javascript:void(0)'></a></li>
			</ul>
		</div>
	</div>
</header>
	<aside class="menu-phone">
        <div class="header">人似秋鸿来有信，事如春梦了无痕</div>
		<nav>
            <ul>
                
                    
                        <li>
                            <a class='nav-home flat-box nav flat-box' href='/'><i class='fa fa-home fa-fw'></i>&nbsp;主页</a>
                        </li>
                    
                        <li>
                            <a class='nav-blog flat-box nav flat-box' href='/blog'><i class='fa fa-rss fa-fw'></i>&nbsp;博客</a>
                        </li>
                    
                        <li>
                            <a class='nav-archives flat-box nav flat-box' href='/archives'><i class='fa fa-archive fa-fw'></i>&nbsp;归档</a>
                        </li>
                    
                        <li>
                            <a class='nav-home flat-box nav flat-box' href='/'><i class='fa fa-user fa-fw'></i>&nbsp;关于我</a>
                        </li>
                    
             
            </ul>
		</nav>
	</aside>

    <script>setLoadingBarProgress(40);</script>
    <div class="l_body">
    <div class='container clearfix'>
        <div class='l_main'>
            <article id="post-hadoop-ha-cluster" class="post white-box article-type-post" itemscope itemprop="blogPost">
    <section class='meta'>
        <h1 class="title">
            
                Hadoop 3.1.2 + Zookeeper 3.4.14 + Spark 2.4.1 + HBase 2.0.5 + Phoenix 5.0.0 高可用集群部署
            
        </h1>
        <time>
            2019-04-22&nbsp;&nbsp;
            <i class="fa fa-eye fa-fw" aria-hidden="true"></i>&nbsp;<span id="busuanzi_value_page_pv"><i class="fa fa-spinner fa-spin fa-fw" aria-hidden="true"></i></span>
        </time>
        
    
    <div class='cats'>
        <a href="/categories/计算机技术/">计算机技术</a>
    </div>


    </section>

    <section class="article typo">

        <div class="article-entry" itemprop="articleBody">
            <p>本文记录梳理一下手动布署hadoop集群具体步骤，在相互兼容的基础上，选择了目前为止各个组件的最新版。所以请不要询问为什么是这几个版本，因为作者已经花了大量的时间尝试过。</p>
<a id="more"></a>
<h2 id="1-集群环境：采用4台主机，其中101，102为HA主节点。可采用VMWare模拟。"><a href="#1-集群环境：采用4台主机，其中101，102为HA主节点。可采用VMWare模拟。" class="headerlink" title="1. 集群环境：采用4台主机，其中101，102为HA主节点。可采用VMWare模拟。"></a>1. 集群环境：采用4台主机，其中101，102为HA主节点。可采用VMWare模拟。</h2><table>
<thead>
<tr>
<th style="text-align:center">IP地址</th>
<th style="text-align:center">主机名</th>
<th style="text-align:center">Hadoop</th>
<th style="text-align:center">Spark</th>
<th style="text-align:center">HBase</th>
<th style="text-align:center">Phoenix</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">192.168.80.101</td>
<td style="text-align:center">centos1</td>
<td style="text-align:center">namenode/()</td>
<td style="text-align:center"></td>
<td style="text-align:center">HMaster</td>
<td style="text-align:center"></td>
</tr>
<tr>
<td style="text-align:center">192.168.80.102</td>
<td style="text-align:center">centos2</td>
<td style="text-align:center">namenode()</td>
<td style="text-align:center"></td>
<td style="text-align:center">HMaster</td>
<td style="text-align:center"></td>
</tr>
<tr>
<td style="text-align:center">192.168.80.103</td>
<td style="text-align:center">centos3</td>
<td style="text-align:center"></td>
<td style="text-align:center"></td>
<td style="text-align:center">HRigeonServer</td>
<td style="text-align:center"></td>
</tr>
<tr>
<td style="text-align:center">192.168.80.104</td>
<td style="text-align:center">centos4</td>
<td style="text-align:center"></td>
<td style="text-align:center"></td>
<td style="text-align:center">HRigeonServer</td>
</tr>
</tbody>
</table>
<h3 id="1-1-用VMWare-Workstation准备一个虚拟环境，安装CentOS-7-6"><a href="#1-1-用VMWare-Workstation准备一个虚拟环境，安装CentOS-7-6" class="headerlink" title="1.1 用VMWare Workstation准备一个虚拟环境，安装CentOS 7.6"></a>1.1 用VMWare Workstation准备一个虚拟环境，安装CentOS 7.6</h3><h4 id="1-1-1-配置主机名、IP"><a href="#1-1-1-配置主机名、IP" class="headerlink" title="1.1.1 配置主机名、IP"></a>1.1.1 配置主机名、IP</h4><p>编辑/etc/hostname</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ vim /etc/hostname</span><br><span class="line">centos1</span><br></pre></td></tr></table></figure>
<p>编辑/etc/hosts<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$ vim /etc/hosts</span><br><span class="line">127.0.0.1   localhost localhost.localdomain localhost4 ocalhost4.localdomain4</span><br><span class="line">::1         localhost localhost.localdomain localhost6 localhost6.localdomain6</span><br><span class="line">192.168.80.101 centos1</span><br><span class="line">192.168.80.102 centos2</span><br><span class="line">192.168.80.103 centos3</span><br><span class="line">192.168.80.104 centos4</span><br></pre></td></tr></table></figure></p>
<p>设置IP路由等，编辑/etc/sysconfig/network-scripts/ifcfg-eth0</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">$ vim /etc/sysconfig/network-scripts/ifcfg-ens33</span><br><span class="line">TYPE=Ethernet</span><br><span class="line">PROXY_METHOD=none</span><br><span class="line">BROWSER_ONLY=no</span><br><span class="line">BOOTPROTO=none</span><br><span class="line">DEFROUTE=yes</span><br><span class="line">IPV4_FAILURE_FATAL=no</span><br><span class="line">IPV6INIT=yes</span><br><span class="line">IPV6_AUTOCONF=yes</span><br><span class="line">IPV6_DEFROUTE=yes</span><br><span class="line">IPV6_FAILURE_FATAL=no</span><br><span class="line">IPV6_ADDR_GEN_MODE=stable-privacy</span><br><span class="line">NAME=ens33</span><br><span class="line">UUID=2d111847-e946-496c-918d-49815fcd251b</span><br><span class="line">DEVICE=ens33</span><br><span class="line">ONBOOT=yes</span><br><span class="line">IPADDR=192.168.80.101</span><br><span class="line">PREFIX=24</span><br><span class="line">GATEWAY=192.168.80.2</span><br><span class="line">DNS1=192.168.80.2</span><br><span class="line">IPV6_PRIVACY=no</span><br></pre></td></tr></table></figure>
<p>重启网络</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo systemctl restart network</span><br></pre></td></tr></table></figure>
<h4 id="1-1-2-安装基础包"><a href="#1-1-2-安装基础包" class="headerlink" title="1.1.2 安装基础包"></a>1.1.2 安装基础包</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ sudo yum install gcc openssh openssl-devel bzip2-devel libffi-devel ntp -y</span><br><span class="line">$ sudo yum install net-tools checkpolicy dkms foomatic bash-completion psmisc -y</span><br></pre></td></tr></table></figure>
<h4 id="1-1-3-安装-JDK-1-8"><a href="#1-1-3-安装-JDK-1-8" class="headerlink" title="1.1.3 安装 JDK 1.8"></a>1.1.3 安装 JDK 1.8</h4><p>可直接安装Open JDK或者通过包管理工具Jabba安装。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">$ curl -sL https://github.com/shyiko/jabba/raw/master/install.sh | bash &amp;&amp; . ~/.jabba/jabba.sh</span><br><span class="line"><span class="comment"># list available JDK's</span></span><br><span class="line">$ jabba ls-remote</span><br><span class="line"><span class="comment"># install Oracle 1.8</span></span><br><span class="line">$ jabba install 1.8</span><br><span class="line"><span class="comment"># or install Adopt OpenJDK (Hotspot)</span></span><br><span class="line">$ jabba install adopt@1.8.0</span><br><span class="line"><span class="comment"># switch to </span></span><br><span class="line">$ jabba use adopt@1.8.0</span><br><span class="line"><span class="comment"># set default</span></span><br><span class="line">$ jabba <span class="built_in">alias</span> default adopt@1.8.0</span><br></pre></td></tr></table></figure>
<h4 id="1-1-4-安装Scala"><a href="#1-1-4-安装Scala" class="headerlink" title="1.1.4 安装Scala"></a>1.1.4 安装Scala</h4><p>可通过sdkman安装scala</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ curl -s <span class="string">"https://get.sdkman.io"</span> | bash</span><br><span class="line">$ sdk install scala</span><br></pre></td></tr></table></figure>
<h4 id="1-1-5-关闭防火墙"><a href="#1-1-5-关闭防火墙" class="headerlink" title="1.1.5 关闭防火墙"></a>1.1.5 关闭防火墙</h4><p>在开始安装集群前，最好先关闭防火墙，否则后续会出现很多异常问题。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo systemctl stop firewalld &amp; systemctl <span class="built_in">disable</span> firewalld</span><br></pre></td></tr></table></figure>
<h4 id="1-1-6-关闭Swap"><a href="#1-1-6-关闭Swap" class="headerlink" title="1.1.6 关闭Swap"></a>1.1.6 关闭Swap</h4><ul>
<li>执行swapoff -a临时关闭，但系统重启后恢复</li>
<li>编辑/etc/fstab，注释掉包含swap的行后，重启</li>
</ul>
<h4 id="1-1-7-禁用SELinux"><a href="#1-1-7-禁用SELinux" class="headerlink" title="1.1.7 禁用SELinux"></a>1.1.7 禁用SELinux</h4><p>编辑/etc/selinux/config，更改SELINUX=disabled，重启。检查状态</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sestatus</span><br></pre></td></tr></table></figure>
<h4 id="1-1-8-设置环境变量"><a href="#1-1-8-设置环境变量" class="headerlink" title="1.1.8 设置环境变量"></a>1.1.8 设置环境变量</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">$ sudo vim /etc/profile</span><br><span class="line"></span><br><span class="line"><span class="comment"># java</span></span><br><span class="line"><span class="comment"># export JAVA_HOME=/home/richard/.jabba/jdk/adopt@1.8.202-08</span></span><br><span class="line"><span class="built_in">export</span> JRE_HOME=/home/richard/.jabba/jdk/adopt@1.8.202-08/jre</span><br><span class="line"></span><br><span class="line"><span class="comment"># scala</span></span><br><span class="line"><span class="built_in">export</span> SCALA_HOME=/home/richard/hadoop/app/scala-2.12.8</span><br><span class="line"><span class="built_in">export</span> PATH=<span class="variable">$PATH</span>:<span class="variable">$JRM_HOME</span>/bin:<span class="variable">$SCALA_HOME</span>/bin</span><br><span class="line"><span class="comment"># export PATH=$PATH:$JAVA_HOME/bin:$JRE_HOME/bin:$SCALA_HOME/bin</span></span><br></pre></td></tr></table></figure>
<h3 id="1-2-Clone三个新的镜像"><a href="#1-2-Clone三个新的镜像" class="headerlink" title="1.2 Clone三个新的镜像"></a>1.2 Clone三个新的镜像</h3><p><img src="/images/clone-vm-image.png" alt=""></p>
<h3 id="1-3-更改新镜像的IP-hostname"><a href="#1-3-更改新镜像的IP-hostname" class="headerlink" title="1.3 更改新镜像的IP, hostname"></a>1.3 更改新镜像的IP, hostname</h3><h3 id="1-4-设置SSH免登录"><a href="#1-4-设置SSH免登录" class="headerlink" title="1.4 设置SSH免登录"></a>1.4 设置SSH免登录</h3><h4 id="1-4-1-生成公钥"><a href="#1-4-1-生成公钥" class="headerlink" title="1.4.1 生成公钥"></a>1.4.1 生成公钥</h4><p>在centos1上执行</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ ssh-keygen -t rsa</span><br></pre></td></tr></table></figure>
<p>一路回车，默认值。</p>
<h4 id="1-4-2-分发公钥"><a href="#1-4-2-分发公钥" class="headerlink" title="1.4.2 分发公钥"></a>1.4.2 分发公钥</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ ssh-copy-id centos1</span><br><span class="line">$ ssh-copy-id centos2</span><br><span class="line">$ ssh-copy-id centos3</span><br><span class="line">$ ssh-copy-id centos4</span><br></pre></td></tr></table></figure>
<h4 id="1-4-3-在其它主机上执行同样步骤"><a href="#1-4-3-在其它主机上执行同样步骤" class="headerlink" title="1.4.3 在其它主机上执行同样步骤"></a>1.4.3 在其它主机上执行同样步骤</h4><h3 id="1-5-创建相关目录"><a href="#1-5-创建相关目录" class="headerlink" title="1.5 创建相关目录"></a>1.5 创建相关目录</h3><p>相关文件目录都在~/hadoop下，~/hadoop/src放置源码，程序安装到~/hadoop/app，数据放在~/hadoop/data，日志在~/hadoop/logs</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="keyword">for</span> N <span class="keyword">in</span> $(seq 1 4); <span class="keyword">do</span> ssh centos<span class="variable">$N</span> sudo yum install ntp -y; <span class="keyword">done</span></span><br><span class="line"><span class="comment"># 创建 Hadoop3.1.2 和 Zookeeper3.4.14 需要的目录</span></span><br><span class="line">$ <span class="keyword">for</span> N <span class="keyword">in</span> $(seq 1 4); <span class="keyword">do</span> ssh centos<span class="variable">$N</span> mkdir /home/hadoop/&#123;src,app,logs,data&#125; -p; <span class="keyword">done</span>;</span><br><span class="line">$ <span class="keyword">for</span> N <span class="keyword">in</span> $(seq 1 4); <span class="keyword">do</span> ssh centos<span class="variable">$N</span> mkdir /home/hadoop/data/&#123;hadoop-3.1.2,zookeeper-3.4.14&#125; -p; <span class="keyword">done</span>;</span><br><span class="line">$ <span class="keyword">for</span> N <span class="keyword">in</span> $(seq 1 4); <span class="keyword">do</span> ssh centos<span class="variable">$N</span> mkdir /home/hadoop/logs/&#123;hadoop-3.1.2,zookeeper-3.4.14&#125; -p; <span class="keyword">done</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">## 在 Hadoop3.1.2 的 NameNode 上创建 HA 共享目录</span></span><br><span class="line">$ <span class="keyword">for</span> N <span class="keyword">in</span> $(seq 1 4); <span class="keyword">do</span> ssh centos<span class="variable">$N</span> mkdir /home/hadoop/data/hadoop-3.1.2/&#123;journalnode,ha-name-dir-shared&#125; -p; <span class="keyword">done</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建 Hbase2.0.5 需要的目录</span></span><br><span class="line">$ <span class="keyword">for</span> N <span class="keyword">in</span> $(seq 1 4); <span class="keyword">do</span> ssh centos<span class="variable">$N</span> mkdir /home/hadoop/logs/hbase-2.0.5 -p; <span class="keyword">done</span>;</span><br><span class="line">$ <span class="keyword">for</span> N <span class="keyword">in</span> $(seq 1 4); <span class="keyword">do</span> ssh centos<span class="variable">$N</span> mkdir /home/hadoop/data/hbase-2.0.5 -p; <span class="keyword">done</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建 Spark2.4.1 需要的目录</span></span><br><span class="line">$ <span class="keyword">for</span> N <span class="keyword">in</span> $(seq 1 4); <span class="keyword">do</span> ssh centos<span class="variable">$N</span> mkdir /home/hadoop/data/spark-2.4.1 -p; <span class="keyword">done</span>;</span><br><span class="line">$ <span class="keyword">for</span> N <span class="keyword">in</span> $(seq 1 4); <span class="keyword">do</span> ssh centos<span class="variable">$N</span> mkdir /home/hadoop/logs/spark-2.4.1 -p; <span class="keyword">done</span>;</span><br></pre></td></tr></table></figure>
<h3 id="1-6-设置环境变量"><a href="#1-6-设置环境变量" class="headerlink" title="1.6 设置环境变量"></a>1.6 设置环境变量</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">$ sudo vim /etc/profile</span><br><span class="line"><span class="comment"># hadoop</span></span><br><span class="line"><span class="built_in">export</span> HADOOP_HOME=/home/richard/hadoop/app/hadoop-3.1.2</span><br><span class="line"><span class="built_in">export</span> HADOOP_CONF_DIR=<span class="variable">$HADOOP_HOME</span>/etc/hadoop</span><br><span class="line"><span class="built_in">export</span> HADOOP_LOG_DIR=/home/richard/hadoop/logs/hadoop-3.1.2</span><br><span class="line"><span class="built_in">export</span> PATH=<span class="variable">$PATH</span>:<span class="variable">$HADOOP_HOME</span>/sbin:<span class="variable">$HADOOP_HOME</span>/bin</span><br><span class="line"></span><br><span class="line"><span class="comment"># zookepper</span></span><br><span class="line"><span class="built_in">export</span> ZOOKEEPER_HOME=/home/richard/hadoop/app/zookeeper-3.4.14</span><br><span class="line"><span class="built_in">export</span> PATH=<span class="variable">$PATH</span>:<span class="variable">$ZOOKEEPER_HOME</span>/bin</span><br><span class="line"></span><br><span class="line"><span class="comment"># hbase</span></span><br><span class="line"><span class="built_in">export</span> HBASE_HOME=/home/richard/hadoop/app/hbase-2.0.5</span><br><span class="line"><span class="built_in">export</span> PATH=<span class="variable">$PATH</span>:<span class="variable">$HBASE_HOME</span>/bin</span><br><span class="line"></span><br><span class="line"><span class="comment"># phoenix for hbase</span></span><br><span class="line"><span class="built_in">export</span> PHOENIX_HOME=/home/richard/hadoop/app/phoenix-5.0.0-HBase-2.0</span><br><span class="line"><span class="built_in">export</span> PHOENIX_CLASSPATH=<span class="variable">$PHOENIX_HOME</span></span><br><span class="line"><span class="built_in">export</span> PATH=<span class="variable">$PATH</span>:<span class="variable">$PHOENIX_HOME</span>/bin</span><br><span class="line"></span><br><span class="line"><span class="comment"># spark</span></span><br><span class="line"><span class="built_in">export</span> SPARK_HOME=/home/richard/hadoop/app/spark-2.4.1</span><br><span class="line"><span class="built_in">export</span> PATH=<span class="variable">$PATH</span>:<span class="variable">$SPARK_HOME</span>/bin:<span class="variable">$SPARK_HOME</span>/sbin</span><br><span class="line"></span><br><span class="line">$ <span class="built_in">source</span> /etc/profile</span><br></pre></td></tr></table></figure>
<h2 id="2-安装zookeeper"><a href="#2-安装zookeeper" class="headerlink" title="2. 安装zookeeper"></a>2. 安装zookeeper</h2><h3 id="2-1-创建配置文件zoo-cfg"><a href="#2-1-创建配置文件zoo-cfg" class="headerlink" title="2.1 创建配置文件zoo.cfg"></a>2.1 创建配置文件zoo.cfg</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">cd</span> <span class="variable">$ZOOKEEPER_HOME</span>/conf</span><br><span class="line">$ cp zoo-sample.cfg zoo.cfg</span><br><span class="line">$ vim zoo.cfg</span><br><span class="line"><span class="comment"># ZooKeeper使用的基本时间单位（以毫秒为单位）。它用于做心跳，最小会话超时将是tickTime的两倍。</span></span><br><span class="line">tickTime=200</span><br><span class="line"></span><br><span class="line"><span class="comment"># 存储内存数据库快照的位置，除非另有说明，否则指向数据库更新的事务日志。</span></span><br><span class="line">dataDir=/home/work/_data/zookeeper-3.4.13</span><br><span class="line"></span><br><span class="line"><span class="comment"># 用于事务日志的不同目录。</span></span><br><span class="line">dataLogDir=/home/work/_logs/zookeeper-3.4.13</span><br><span class="line"></span><br><span class="line"><span class="comment"># 侦听客户端连接的端口</span></span><br><span class="line">clientPort=2181</span><br><span class="line"></span><br><span class="line"><span class="comment"># 表示在leader选举结束后，followers与leader同步需要的时间，如果followers比较多或者说leader的数据灰常多时，同步时间相应可能会增加，那么这个值也需要相应增加。当然，这个值也是follower和observer在开始同步leader的数据时的最大等待时间(setSoTimeout)</span></span><br><span class="line">initLimit=5</span><br><span class="line"></span><br><span class="line"><span class="comment"># 表示follower和observer与leader交互时的最大等待时间，只不过是在与leader同步完毕之后，进入正常请求转发或ping等消息交互时的超时时间。</span></span><br><span class="line">syncLimit=2</span><br><span class="line"></span><br><span class="line"><span class="comment"># server.serverid=host:tickpot:electionport</span></span><br><span class="line"><span class="comment"># server：固定写法</span></span><br><span class="line"><span class="comment"># serverid：每个服务器的指定ID（必须处于1-255之间，必须每一台机器不能重复）</span></span><br><span class="line"><span class="comment"># host：主机名</span></span><br><span class="line"><span class="comment"># tickpot：心跳通信端口</span></span><br><span class="line"><span class="comment"># electionport：选举端口</span></span><br><span class="line">server.1=centos1:2888:3888</span><br><span class="line">server.2=centos2:2888:3888</span><br><span class="line">server.3=centos3:2888:3888</span><br><span class="line">server.4=centos4:2888:3888</span><br></pre></td></tr></table></figure>
<p>复制zookeeper到其它机器上</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="keyword">for</span> N <span class="keyword">in</span> $(seq 2 4); <span class="keyword">do</span> scp -r /home/hadoop/app/zookeeper-3.4.14 centos<span class="variable">$N</span>:/home/hadoop/app/; <span class="keyword">done</span>;</span><br></pre></td></tr></table></figure>
<h3 id="2-2-为每台服务器创建身份标识"><a href="#2-2-为每台服务器创建身份标识" class="headerlink" title="2.2 为每台服务器创建身份标识"></a>2.2 为每台服务器创建身份标识</h3><p>通过创建名为 myid 的文件将每台服务器标识身份，每个服务器对应一个文件，用于服务器快速选举，该文件位于配置文件 /home/hadoop/app/zookeeper-3.4.14/conf/zoo.cfg 中的 dataDir 配置项中。<br>  <br>接下来，我们在配置文件 /home/hadoop/app/zookeeper-3.4.14/conf/zoo.cfg 中配置的 dataDir 目录，创建 myid 文件，内容为 server. 后面的数字，记住只能是数字：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># centos1</span></span><br><span class="line">$ <span class="built_in">echo</span> 1 &gt; /home/hadoop/data/zookeeper-3.4.14/myid</span><br><span class="line"></span><br><span class="line"><span class="comment"># centos2</span></span><br><span class="line">$ <span class="built_in">echo</span> 2 &gt; /home/hadoop/data/zookeeper-3.4.14/myid</span><br><span class="line"></span><br><span class="line"><span class="comment"># centos3</span></span><br><span class="line">$ <span class="built_in">echo</span> 3 &gt; /home/hadoop/data/zookeeper-3.4.14/myid</span><br><span class="line"></span><br><span class="line"><span class="comment"># centos4</span></span><br><span class="line">$ <span class="built_in">echo</span> 4 &gt; /home/hadoop/data/zookeeper-3.4.14/myid</span><br></pre></td></tr></table></figure>
<h3 id="2-3-在所有节点上启动zookeeper"><a href="#2-3-在所有节点上启动zookeeper" class="headerlink" title="2.3 在所有节点上启动zookeeper"></a>2.3 在所有节点上启动zookeeper</h3><p>在所有机器上运行 zkServer.sh start 命令启动服务，然后输入 JPS 命令，在所有节点中，您将看到 QuorumPeerMain 服务。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="keyword">for</span> N <span class="keyword">in</span> $(seq 1 4); <span class="keyword">do</span> ssh centos<span class="variable">$N</span> /home/hadoop/app/bin/zkServer.sh start; <span class="keyword">done</span>;</span><br><span class="line"><span class="comment"># check if success</span></span><br><span class="line">$ <span class="keyword">for</span> N <span class="keyword">in</span> $(seq 1 4); <span class="keyword">do</span> ssh centos<span class="variable">$N</span> jps; <span class="keyword">done</span>;</span><br><span class="line">44861 Jps</span><br><span class="line">12143 QuorumPeerMain</span><br></pre></td></tr></table></figure>
<h3 id="2-4-查看zookeeper运行状态"><a href="#2-4-查看zookeeper运行状态" class="headerlink" title="2.4 查看zookeeper运行状态"></a>2.4 查看zookeeper运行状态</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># will see only one as leader, and others as followers</span></span><br><span class="line">$ zkServer.sh status</span><br><span class="line"><span class="comment"># check if zookeeper is installed correctly by zk cli</span></span><br><span class="line">$ zkCli.sh</span><br><span class="line">...</span><br><span class="line">ls /</span><br><span class="line">[zookeeper]</span><br></pre></td></tr></table></figure>
<h2 id="3-安装hadoop"><a href="#3-安装hadoop" class="headerlink" title="3. 安装hadoop"></a>3. 安装hadoop</h2><h3 id="3-1-修改配置文件"><a href="#3-1-修改配置文件" class="headerlink" title="3.1 修改配置文件"></a>3.1 修改配置文件</h3><h4 id="3-1-1-编辑-HADOOP-HOME-etc-hadoop-core-site-xml"><a href="#3-1-1-编辑-HADOOP-HOME-etc-hadoop-core-site-xml" class="headerlink" title="3.1.1 编辑 $HADOOP_HOME/etc/hadoop/core-site.xml"></a>3.1.1 编辑 $HADOOP_HOME/etc/hadoop/core-site.xml</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span><br><span class="line">&lt;?xml-stylesheet type="text/xsl" href="configuration.xsl"?&gt;</span><br><span class="line"><span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>fs.defaultFS<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>hdfs://bigdata<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">description</span>&gt;</span>默认文件系统的名称。一个URI，其方案和权限决定了FileSystem的实现。<span class="tag">&lt;/<span class="name">description</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>ha.zookeeper.quorum<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>centos1:2181,centos2:2181,centos3:2181,centos4:2181<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">description</span>&gt;</span>由逗号分隔的ZooKeeper服务器地址列表，由ZKFailoverController在自动故障转移中使用。<span class="tag">&lt;/<span class="name">description</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>hadoop.tmp.dir<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>/home/hadoop/data/hadoop-3.1.2<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">description</span>&gt;</span>数据目录目录<span class="tag">&lt;/<span class="name">description</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>dfs.ha.fencing.methods<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>sshfence<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">description</span>&gt;</span>用于服务防护的防护方法列表。可能包含内置方法（例如shell和sshfence）或用户定义的方法。<span class="tag">&lt;/<span class="name">description</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>dfs.ha.fencing.ssh.private-key-files<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>/root/.ssh/id_rsa<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">description</span>&gt;</span>用于内置sshfence fencer的SSH私钥文件。<span class="tag">&lt;/<span class="name">description</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>io.file.buffer.size<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>131072<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">description</span>&gt;</span>SequenceFiles中使用的读/写缓冲区的大小。<span class="tag">&lt;/<span class="name">description</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>ipc.client.connect.max.retries<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>100<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">description</span>&gt;</span>客户端为建立服务器连接而重试的次数。<span class="tag">&lt;/<span class="name">description</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>ipc.client.connect.retry.interval<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>10000<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">description</span>&gt;</span>客户端在重试建立服务器连接之前将等待的毫秒数。<span class="tag">&lt;/<span class="name">description</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h4 id="3-1-2-编辑-HADOOP-HOME-etc-hadoop-hdfs-site-xml"><a href="#3-1-2-编辑-HADOOP-HOME-etc-hadoop-hdfs-site-xml" class="headerlink" title="3.1.2 编辑$HADOOP_HOME/etc/hadoop/hdfs-site.xml"></a>3.1.2 编辑$HADOOP_HOME/etc/hadoop/hdfs-site.xml</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span><br><span class="line">&lt;?xml-stylesheet type="text/xsl" href="configuration.xsl"?&gt;</span><br><span class="line"><span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>dfs.nameservices<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>bigdata<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>dfs.ha.namenodes.bigdata<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>centos1,centos2<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">description</span>&gt;</span>给定名称服务的前缀包含给定名称服务的逗号分隔的名称节点列表。<span class="tag">&lt;/<span class="name">description</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>dfs.namenode.rpc-address.bigdata.centos1<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>centos1:8020<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>dfs.namenode.rpc-address.bigdata.centos2<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>centos2:8020<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>dfs.namenode.http-address.bigdata.centos1<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>centos1:50070<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>dfs.namenode.http-address.bigdata.centos2<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>centos2:50070<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>dfs.namenode.shared.edits.dir<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>qjournal://centos1:8485;centos2:8485/bigdata<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">description</span>&gt;</span>HA群集中多个名称节点之间的共享存储上的目录。此目录将由活动写入并由备用数据库读取，以保持命名空间同步。<span class="tag">&lt;/<span class="name">description</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>dfs.client.failover.proxy.provider.bigdata<span class="tag">&lt;/<span class="name">name</span>&gt;</span>       <span class="tag">&lt;<span class="name">value</span>&gt;</span>org.apache.hadoop.hdfs.server.namenode.ha.ConfiguredFailoverProxyProvider<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">description</span>&gt;</span>配置Java类的名称，DFS客户端将使用该名称来确定哪个NameNode是当前的Active，以及哪个NameNode当前正在为客户端请求提供服务。<span class="tag">&lt;/<span class="name">description</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>dfs.ha.automatic-failover.enabled<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>true<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">description</span>&gt;</span>是否启用自动故障转移。<span class="tag">&lt;/<span class="name">description</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>dfs.replication<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>3<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>dfs.permissions.enabled<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>false<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">description</span>&gt;</span>如果为“true”，则启用HDFS中的权限检查。如果为“false”，则关闭权限检查，但所有其他行为都保持不变。<span class="tag">&lt;/<span class="name">description</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>dfs.journalnode.edits.dir<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>$&#123;hadoop.tmp.dir&#125;/journalnode<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">description</span>&gt;</span>指定JournalNode在本地磁盘存放数据的位置<span class="tag">&lt;/<span class="name">description</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>dfs.namenode.name.dir<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>file://$&#123;hadoop.tmp.dir&#125;/namenode<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">description</span>&gt;</span>设置namenode存放路径<span class="tag">&lt;/<span class="name">description</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>dfs.datanode.data.dir<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>file://$&#123;hadoop.tmp.dir&#125;/datanode<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">description</span>&gt;</span>设置datanode存放径路<span class="tag">&lt;/<span class="name">description</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>dfs.blocksize<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>268435456<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">description</span>&gt;</span>大型文件系统的HDFS块大小为256MB。<span class="tag">&lt;/<span class="name">description</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>dfs.namenode.handler.count<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>100<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">description</span>&gt;</span>namenode的服务器线程数<span class="tag">&lt;/<span class="name">description</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h4 id="3-1-3-mapred-site-xml"><a href="#3-1-3-mapred-site-xml" class="headerlink" title="3.1.3 mapred.site.xml"></a>3.1.3 mapred.site.xml</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version="1.0"?&gt;</span><br><span class="line">&lt;?xml-stylesheet type="text/xsl" href="configuration.xsl"?&gt;</span><br><span class="line"><span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>mapreduce.framework.name<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>yarn<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">description</span>&gt;</span>指定mr框架为yarn方式<span class="tag">&lt;/<span class="name">description</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span>&gt;</span> </span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>mapreduce.map.memory.mb<span class="tag">&lt;/<span class="name">name</span>&gt;</span> </span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>512<span class="tag">&lt;/<span class="name">value</span>&gt;</span> </span><br><span class="line">        <span class="tag">&lt;<span class="name">description</span>&gt;</span>每个Map任务的物理内存限制<span class="tag">&lt;/<span class="name">description</span>&gt;</span> </span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span>&gt;</span> </span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>mapreduce.reduce.memory.mb<span class="tag">&lt;/<span class="name">name</span>&gt;</span> </span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>512<span class="tag">&lt;/<span class="name">value</span>&gt;</span> </span><br><span class="line">        <span class="tag">&lt;<span class="name">description</span>&gt;</span>每个Reduce任务的物理内存限制<span class="tag">&lt;/<span class="name">description</span>&gt;</span> </span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span> </span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>mapreduce.jobhistory.address<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>0.0.0.0:10020<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">description</span>&gt;</span>MapReduce JobHistory服务器IPC主机：端口<span class="tag">&lt;/<span class="name">description</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>mapreduce.jobhistory.webapp.address<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>0.0.0.0:19888<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">description</span>&gt;</span>MapReduce JobHistory服务器Web浏览时的主机：端口<span class="tag">&lt;/<span class="name">description</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>mapreduce.application.classpath<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span></span><br><span class="line">          /home/hadoop/app/hadoop-3.1.2/etc/hadoop,</span><br><span class="line">          /home/hadoop/app/hadoop-3.1.2/share/hadoop/common/*,</span><br><span class="line">          /home/hadoop/app/hadoop-3.1.2/share/hadoop/common/lib/*,</span><br><span class="line">          /home/hadoop/app/hadoop-3.1.2/share/hadoop/hdfs/*,</span><br><span class="line">          /home/hadoop/app/hadoop-3.1.2/share/hadoop/hdfs/lib/*,</span><br><span class="line">          /home/hadoop/app/hadoop-3.1.2/share/hadoop/mapreduce/*,</span><br><span class="line">          /home/hadoop/app/hadoop-3.1.2/share/hadoop/mapreduce/lib/*,</span><br><span class="line">          /home/hadoop/app/hadoop-3.1.2/share/hadoop/yarn/*,</span><br><span class="line">          /home/hadoop/app/hadoop-3.1.2/share/hadoop/yarn/lib/*        </span><br><span class="line">        <span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h4 id="3-1-4-capacity-scheduler-xml"><a href="#3-1-4-capacity-scheduler-xml" class="headerlink" title="3.1.4 capacity-scheduler.xml"></a>3.1.4 capacity-scheduler.xml</h4><h4 id="3-1-5-yarn-site-xml"><a href="#3-1-5-yarn-site-xml" class="headerlink" title="3.1.5 yarn-site.xml"></a>3.1.5 yarn-site.xml</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version="1.0"?&gt;</span><br><span class="line"><span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- Site specific YARN configuration properties--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>yarn.resourcemanager.recovery.enabled<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>true<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">description</span>&gt;</span>启动后启用RM以恢复状态。如果为true，则必须指定yarn.resourcemanager.store.class。<span class="tag">&lt;/<span class="name">description</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>yarn.resourcemanager.store.class<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>org.apache.hadoop.yarn.server.resourcemanager.recovery.ZKRMStateStore<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">description</span>&gt;</span>用作持久存储的类。<span class="tag">&lt;/<span class="name">description</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>yarn.resourcemanager.zk-address<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>centos1:2181,centos2:2181<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">description</span>&gt;</span>ZooKeeper服务的地址，多个地址使用逗号隔开<span class="tag">&lt;/<span class="name">description</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>yarn.resourcemanager.ha.enabled<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>true<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">description</span>&gt;</span>启用RM高可用性。启用时，（1）默认情况下，RM以待机模式启动，并在提示时转换为活动模式。（2）RM集合中的节点列在yarn.resourcemanager.ha.rm-ids中（3）如果明确指定了yarn.resourcemanager.ha.id，则每个RM的id来自yarn.resourcemanager.ha.id或者可以通过匹配yarn.resourcemanager.address。<span class="tag">&lt;/<span class="name">description</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>yarn.resourcemanager.ha.rm-ids<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>rm1,rm2<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">description</span>&gt;</span>启用HA时群集中的RM节点列表。最少2个<span class="tag">&lt;/<span class="name">description</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>yarn.resourcemanager.webapp.address.rm1<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>centos1:8088<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>yarn.resourcemanager.webapp.address.rm2<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>centos2:8088<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>yarn.resourcemanager.cluster-id<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>bd-yarn-ha<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">description</span>&gt;</span>集群HA的id，用于在ZooKeeper上创建节点，区分使用同一个ZooKeeper集群的不同Hadoop集群<span class="tag">&lt;/<span class="name">description</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>yarn.resourcemanager.hostname.rm1<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>centos1<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">description</span>&gt;</span>主机名<span class="tag">&lt;/<span class="name">description</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>yarn.resourcemanager.hostname.rm2<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>centos2<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">description</span>&gt;</span>主机名<span class="tag">&lt;/<span class="name">description</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>yarn.nodemanager.aux-services<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>mapreduce_shuffle<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">description</span>&gt;</span>reducer取数据的方式是mapreduce_shuffle<span class="tag">&lt;/<span class="name">description</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span>&gt;</span>  </span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>yarn.nodemanager.resource.memory-mb<span class="tag">&lt;/<span class="name">name</span>&gt;</span>  </span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>2048<span class="tag">&lt;/<span class="name">value</span>&gt;</span>  </span><br><span class="line">        <span class="tag">&lt;<span class="name">discription</span>&gt;</span>每个节点可用内存,单位MB<span class="tag">&lt;/<span class="name">discription</span>&gt;</span>  </span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span> </span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span>&gt;</span>  </span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>yarn.nodemanager.resource.cpu-vcores<span class="tag">&lt;/<span class="name">name</span>&gt;</span>  </span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>2<span class="tag">&lt;/<span class="name">value</span>&gt;</span>  </span><br><span class="line">        <span class="tag">&lt;<span class="name">discription</span>&gt;</span>每个节点可用cpu<span class="tag">&lt;/<span class="name">discription</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span>   </span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span>&gt;</span>  </span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>yarn.scheduler.minimum-allocation-mb<span class="tag">&lt;/<span class="name">name</span>&gt;</span>  </span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>512<span class="tag">&lt;/<span class="name">value</span>&gt;</span>  </span><br><span class="line">        <span class="tag">&lt;<span class="name">discription</span>&gt;</span>单个任务可申请最少内存，默认1024MB<span class="tag">&lt;/<span class="name">discription</span>&gt;</span>  </span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span>  </span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span>&gt;</span>  </span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>yarn.scheduler.maximum-allocation-mb<span class="tag">&lt;/<span class="name">name</span>&gt;</span>  </span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>1024<span class="tag">&lt;/<span class="name">value</span>&gt;</span>  </span><br><span class="line">        <span class="tag">&lt;<span class="name">discription</span>&gt;</span>单个任务可申请最大内存，默认8192MB<span class="tag">&lt;/<span class="name">discription</span>&gt;</span>  </span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span> </span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span>&gt;</span>  </span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>yarn.scheduler.minimum-allocation-vcores<span class="tag">&lt;/<span class="name">name</span>&gt;</span>  </span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>1<span class="tag">&lt;/<span class="name">value</span>&gt;</span>  </span><br><span class="line">        <span class="tag">&lt;<span class="name">discription</span>&gt;</span>最小的cores 1 个，默认的就是一个<span class="tag">&lt;/<span class="name">discription</span>&gt;</span>  </span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span> </span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span>&gt;</span>  </span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>yarn.scheduler.minimum-allocation-vcores<span class="tag">&lt;/<span class="name">name</span>&gt;</span>  </span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>2<span class="tag">&lt;/<span class="name">value</span>&gt;</span>  </span><br><span class="line">        <span class="tag">&lt;<span class="name">discription</span>&gt;</span>最多可分配的cores 2 个<span class="tag">&lt;/<span class="name">discription</span>&gt;</span>  </span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span> </span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>yarn.nodemanager.pmem-check-enabled<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>false<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>yarn.nodemanager.vmem-check-enabled<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>false<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>yarn.log-aggregation-enable<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>true<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">discription</span>&gt;</span>是否开启聚合日志<span class="tag">&lt;/<span class="name">discription</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>yarn.nodemanager.log-aggregation.roll-monitoring-interval-seconds<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>-1<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">discription</span>&gt;</span>定义NM唤醒上载日志文件的频率。默认值为-1。默认情况下，应用程序完成后将上载日志。通过设置此配置，可以在应用程序运行时定期上载日志。可设置的最小滚动间隔秒数为3600。<span class="tag">&lt;/<span class="name">discription</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>yarn.log.server.url<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>http://c0:19888/jobhistory/logs<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">discription</span>&gt;</span> 配置日志服务器的地址<span class="tag">&lt;/<span class="name">discription</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>yarn.log-aggregation.retain-seconds<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>-1<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">discription</span>&gt;</span> 在删除聚合日志之前保留多长时间。-1禁用。单位是秒<span class="tag">&lt;/<span class="name">discription</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>yarn.nodemanager.log-dirs<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>/home/hadoop/data/hadoop-3.1.2/yarn/container-logs/<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">discription</span>&gt;</span>nodemanager存放container日志的本地路径<span class="tag">&lt;/<span class="name">discription</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>yarn.nodemanager.remote-app-log-dir<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>/tmp/logs<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">discription</span>&gt;</span>nodemanager存放container日志的本地路径<span class="tag">&lt;/<span class="name">discription</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h4 id="3-1-6-hadoop-env-sh"><a href="#3-1-6-hadoop-env-sh" class="headerlink" title="3.1.6 hadoop-env.sh"></a>3.1.6 hadoop-env.sh</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">export</span> JAVA_HOME=/home/richard/.jabba/jdk/adopt@1.8.202-08</span><br><span class="line"></span><br><span class="line">HDFS_DATANODE_USER=hadoop</span><br><span class="line"><span class="comment"># HDFS_DATANODE_SECURE_USER=</span></span><br><span class="line">HDFS_ZKFC_USER=hadoop</span><br><span class="line">HDFS_JOURNALNODE_USER=hadoop</span><br><span class="line">HDFS_NAMENODE_USER=hadoop</span><br><span class="line">HDFS_SECONDARYNAMENODE_USER=hadoop</span><br><span class="line"></span><br><span class="line">YARN_RESOURCEMANAGER_USER=hadoop</span><br><span class="line">YARN_NODEMANAGER_USER=hadoop</span><br></pre></td></tr></table></figure>
<h4 id="3-1-7-修改workers"><a href="#3-1-7-修改workers" class="headerlink" title="3.1.7 修改workers"></a>3.1.7 修改workers</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ vim /home/hadoop/app/hadoop-3.1.2/etc/hadoop/workers</span><br><span class="line">centos3</span><br><span class="line">centos4</span><br></pre></td></tr></table></figure>
<h3 id="3-2-启动Hadoop"><a href="#3-2-启动Hadoop" class="headerlink" title="3.2 启动Hadoop"></a>3.2 启动Hadoop</h3><h4 id="3-2-1-启动JournalNode集群"><a href="#3-2-1-启动JournalNode集群" class="headerlink" title="3.2.1 启动JournalNode集群"></a>3.2.1 启动JournalNode集群</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="keyword">for</span> N <span class="keyword">in</span> $(seq 1 4); <span class="keyword">do</span> ssh centos<span class="variable">$N</span> hdfs --daemon start journalnode;jps; <span class="keyword">done</span>;</span><br></pre></td></tr></table></figure>
<h4 id="3-2-2-格式化NameNode"><a href="#3-2-2-格式化NameNode" class="headerlink" title="3.2.2 格式化NameNode"></a>3.2.2 格式化NameNode</h4><p>在centos1上</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hdfs namenode -format</span><br></pre></td></tr></table></figure>
<h4 id="3-2-3-启动zookeeper故障转移控制器，格式化zookeeper"><a href="#3-2-3-启动zookeeper故障转移控制器，格式化zookeeper" class="headerlink" title="3.2.3 启动zookeeper故障转移控制器，格式化zookeeper"></a>3.2.3 启动zookeeper故障转移控制器，格式化zookeeper</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ hdfs zkfc -formatZK</span><br><span class="line"><span class="comment"># check if zkfc success, whill see hadoop-ha at ls /</span></span><br><span class="line">$ zkCli.sh</span><br><span class="line">ls /</span><br><span class="line">[zookper, hadoop-ha]</span><br></pre></td></tr></table></figure>
<h4 id="3-2-4-启动NameNode"><a href="#3-2-4-启动NameNode" class="headerlink" title="3.2.4 启动NameNode"></a>3.2.4 启动NameNode</h4><p>在centos1上</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">$ hdfs --daemon start namenode</span><br><span class="line"><span class="comment"># run at centos2 to copy namenode to backup</span></span><br><span class="line">$ hdfs namenode -bootstrapStandby</span><br><span class="line">$ hdfs --daemon start namenode</span><br><span class="line"><span class="comment"># start hdfs at centos1</span></span><br><span class="line">$ sbin/start-dfs.sh</span><br><span class="line"><span class="comment"># check status</span></span><br><span class="line">$ hdfs haadmin --getAllServiceState</span><br><span class="line"><span class="comment"># start YARN from centos1</span></span><br><span class="line">$ sbin/start-yarn.sh</span><br></pre></td></tr></table></figure>
<h4 id="3-2-5-验证高可用性"><a href="#3-2-5-验证高可用性" class="headerlink" title="3.2.5 验证高可用性"></a>3.2.5 验证高可用性</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">[centos1]$ hdfs haadmin -getAllServiceState</span><br><span class="line">centos1:8020	standby</span><br><span class="line">centos2:8020	active</span><br><span class="line"><span class="comment"># kill namenode from centos2</span></span><br><span class="line">[centos2]$ jps</span><br><span class="line">11954 NameNode</span><br><span class="line">[centos2]$ <span class="built_in">kill</span> -9 11954</span><br><span class="line">[centos1]$ hdfs haadmin -getAllServiceState</span><br><span class="line">centos1:8020	active</span><br><span class="line">centos2:8020	failed to connect...</span><br></pre></td></tr></table></figure>
<h2 id="4-安装Spark-2-4-1"><a href="#4-安装Spark-2-4-1" class="headerlink" title="4. 安装Spark 2.4.1"></a>4. 安装Spark 2.4.1</h2><h3 id="4-1-编辑spark-env-sh"><a href="#4-1-编辑spark-env-sh" class="headerlink" title="4.1 编辑spark-env.sh"></a>4.1 编辑spark-env.sh</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">$ vim conf/spark-env.sh</span><br><span class="line"><span class="built_in">export</span> SPARK_DAEMON_JAVA_OPTS=<span class="string">"-Dspark.deploy.recoveryMode=ZOOKEEPER -Dspark.deploy.zookeeper.url=ccentos1:2181,centos2:2181,centos3:2181,centos4:2181 -Dspark.deploy.zookeeper.dir=/spark-2.4.1"</span></span><br><span class="line"><span class="built_in">export</span> SPARK_LOG_DIR=/home/hadoop/logs/spark-2.4.0-bin-hadoop2.7</span><br><span class="line"></span><br><span class="line"><span class="comment"># Spark Work内存使用量</span></span><br><span class="line"><span class="built_in">export</span> SPARK_WORKER_MEMORY=512M</span><br><span class="line"></span><br><span class="line"><span class="comment"># 该参数决定了yarn集群中，最多能够同时启动的EXECUTOR的实例个数。</span></span><br><span class="line"><span class="built_in">export</span> SPARK_EXECUTOR_INSTANCES=3</span><br><span class="line"></span><br><span class="line"><span class="comment"># 设置每个EXECUTOR能够使用的CPU core的数量。</span></span><br><span class="line"><span class="built_in">export</span> SPARK_EXECUTOR_CORES=3</span><br><span class="line"></span><br><span class="line"><span class="comment"># 该参数设置的是每个EXECUTOR分配的内存的数量</span></span><br><span class="line"><span class="built_in">export</span> SPARK_EXECUTOR_MEMORY=512M</span><br><span class="line"></span><br><span class="line"><span class="comment">#该参数设置的是DRIVER分配的内存的大小</span></span><br><span class="line"><span class="built_in">export</span> SPARK_DRIVER_MEMORY=1G</span><br><span class="line"></span><br><span class="line"><span class="comment"># Spark Application在Yarn中的名字</span></span><br><span class="line"><span class="built_in">export</span> SPARK_YARN_APP_NAME=<span class="string">"lion.Spark-2.4.1"</span></span><br></pre></td></tr></table></figure>
<h3 id="4-2-编辑spark-defaults-conf"><a href="#4-2-编辑spark-defaults-conf" class="headerlink" title="4.2 编辑spark-defaults.conf"></a>4.2 编辑spark-defaults.conf</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">$ vim conf/spark-defaults.conf</span><br><span class="line"><span class="comment"># 如果没有适合当前本地性要求的任务可供运行，将跑得慢的任务在空闲计算资源上再度调度的行为,这个参数会引发一些tmp文件被删除的问题，一般设置为false</span></span><br><span class="line">spark.speculation        <span class="literal">false</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 如果设置为true,前台用jdbc方式连接，显示的会是乱码</span></span><br><span class="line">spark.sql.hive.convertMetastoreParquet  <span class="literal">false</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 应用程序上载到HDFS的复制份数</span></span><br><span class="line">spark.yarn.submit.file.replication 3</span><br><span class="line"></span><br><span class="line"><span class="comment"># Spark application master给YARN ResourceManager 发送心跳的时间间隔（ms）</span></span><br><span class="line">spark.yarn.scheduler.heartbeat.interal-ms  5000</span><br><span class="line"></span><br><span class="line"><span class="comment"># 仅适用于HashShuffleMananger的实现，同样是为了解决生成过多文件的问题，采用的方式是在不同批次运行的Map任务之间重用Shuffle输出文件，也就是说合并的是不同批次的Map任务的输出数据，但是每个Map任务所需要的文件还是取决于Reduce分区的数量，因此，它并不减少同时打开的输出文件的数量，因此对内存使用量的减少并没有帮助。只是HashShuffleManager里的一个折中的解决方案。</span></span><br><span class="line">spark.shuffle.consolidateFiles  <span class="literal">true</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 一个partition对应着一个task,如果数据量过大，可以调整次参数来减少每个task所需消耗的内存.</span></span><br><span class="line">spark.sql.shuffle.partitions 100</span><br><span class="line"></span><br><span class="line"><span class="comment"># Spark SQL在每次执行次，先把SQL查询编译JAVA字节码。针对执行时间长的SQL查询或频繁执行的SQL查询，此配置能加快查询速度，因为它产生特殊的字节码去执行。但是针对很短的查询，可能会增加开销，因为它必须先编译每一个查询</span></span><br><span class="line">spark.sql.codegen <span class="literal">true</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 我们都知道shuffle默认情况下的文件数据为map tasks * reduce tasks,通过设置其为true,可以使spark合并shuffle的中间文件为reduce的tasks数目。</span></span><br><span class="line">spark.shuffle.consolidateFiles <span class="literal">true</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 是否记录Spark事件，对于在应用程序完成后重建Web UI非常有用。</span></span><br><span class="line">spark.eventLog.enabled <span class="literal">true</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 是否压缩已记录的事件，如果spark.eventLog.enabled为true。压缩将使用spark.io.compression.codec。</span></span><br><span class="line">spark.eventLog.compress <span class="literal">true</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 如果spark.eventLog.enabled为true，则记录Spark事件的基目录。在此基本目录中，Spark为每个应用程序创建一个子目录，并将特定于该应用程序的事件记录在此目录中。用户可能希望将其设置为统一位置（如HDFS目录），以便历史记录服务器可以读取历史记录文件。</span></span><br><span class="line">spark.eventLog.dir hdfs://bigdata:8020/tmp/logs/spark_logs</span><br></pre></td></tr></table></figure>
<h3 id="4-3-编辑slaves"><a href="#4-3-编辑slaves" class="headerlink" title="4.3 编辑slaves"></a>4.3 编辑slaves</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ vim conf/slaves</span><br><span class="line">centos3</span><br><span class="line">centos4</span><br></pre></td></tr></table></figure>
<h3 id="4-4-启动集群"><a href="#4-4-启动集群" class="headerlink" title="4.4 启动集群"></a>4.4 启动集群</h3><p>复制spark到其它节点。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># start master and workers from centos1</span></span><br><span class="line">[centos1] $ sbin/start-all.sh</span><br><span class="line">[centos2] $ sbin/start-master.sh</span><br><span class="line"><span class="comment"># test </span></span><br><span class="line">[centos1] $ bin/spark-shell</span><br><span class="line"><span class="comment"># test cluster</span></span><br><span class="line">[centos1] $ bin/spark-shell --master yarn --deploy-mode client</span><br></pre></td></tr></table></figure>
<h2 id="5-安装HBase-2-0-5"><a href="#5-安装HBase-2-0-5" class="headerlink" title="5. 安装HBase 2.0.5"></a>5. 安装HBase 2.0.5</h2><h3 id="5-1-修改hbase-site-xml"><a href="#5-1-修改hbase-site-xml" class="headerlink" title="5.1 修改hbase-site.xml"></a>5.1 修改hbase-site.xml</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>hbase.rootdir<span class="tag">&lt;/<span class="name">name</span>&gt;</span> <span class="comment">&lt;!-- hbase存放数据目录 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>hdfs://bigdata:8020/hbase/hbase_db<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">description</span>&gt;</span>端口要和Hadoop的fs.defaultFS端口一致<span class="tag">&lt;/<span class="name">description</span>&gt;</span></span><br><span class="line">　　<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">　　<span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">　　　　<span class="tag">&lt;<span class="name">name</span>&gt;</span>hbase.cluster.distributed<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">　　　　<span class="tag">&lt;<span class="name">value</span>&gt;</span>true<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">description</span>&gt;</span>集群将处于的模式。可能的值是对于独立模式为false，对于分布式模式为true<span class="tag">&lt;/<span class="name">description</span>&gt;</span></span><br><span class="line">　　<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">　　<span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">　　　　<span class="tag">&lt;<span class="name">name</span>&gt;</span>hbase.zookeeper.quorum<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">　　　　<span class="tag">&lt;<span class="name">value</span>&gt;</span>centos1,centos2<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">description</span>&gt;</span>逗号分隔的ZooKeeper集合中的服务器列表个<span class="tag">&lt;/<span class="name">description</span>&gt;</span></span><br><span class="line">　　<span class="tag">&lt;/<span class="name">property</span>&gt;</span> 　　　</span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>hbase.zookeeper.property.dataDir<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>/home/hadoop/data/hbase-2.0.5<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">description</span>&gt;</span>zookooper配置、日志等的存储位置，必须为以存在<span class="tag">&lt;/<span class="name">description</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>hbase.master.port<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>16000<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">description</span>&gt;</span>HBase Master应绑定的端口<span class="tag">&lt;/<span class="name">description</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>hbase.master.info.port<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>16010<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">description</span>&gt;</span>hbase web 端口<span class="tag">&lt;/<span class="name">description</span>&gt;</span></span><br><span class="line">　　<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">　　<span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>hbase.unsafe.stream.capability.enforce<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>false<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>hbase.wal.provider<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>filesystem<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="5-2-编辑hbase-env-sh"><a href="#5-2-编辑hbase-env-sh" class="headerlink" title="5.2 编辑hbase-env.sh"></a>5.2 编辑hbase-env.sh</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">export</span> JAVA_HOME=/home/hadoop/.jabba/jdk/adopt@1.8.202-08</span><br><span class="line"></span><br><span class="line">$ <span class="built_in">export</span> HBASE_CLASSPATH=/home/hadoop/app/hadoop-3.1.2/etc/hadoop</span><br><span class="line"></span><br><span class="line">$ <span class="built_in">export</span> HBASE_OPTS=<span class="string">"<span class="variable">$HBASE_OPTS</span> -XX:+UseConcMarkSweepGC"</span></span><br><span class="line"></span><br><span class="line">$ <span class="built_in">export</span> HBASE_LOG_DIR=/home/hadoop/logs/hbase-2.1.4</span><br><span class="line"><span class="comment"># zookeeper is not managed by hbase.</span></span><br><span class="line">$ <span class="built_in">export</span> HBASE_MANAGES_ZK=<span class="literal">false</span></span><br></pre></td></tr></table></figure>
<h3 id="5-3-编辑slaves"><a href="#5-3-编辑slaves" class="headerlink" title="5.3 编辑slaves"></a>5.3 编辑slaves</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ vim conf/regionservers</span><br><span class="line">centos3</span><br><span class="line">centos4</span><br></pre></td></tr></table></figure>
<h3 id="5-4-启动集群"><a href="#5-4-启动集群" class="headerlink" title="5.4 启动集群"></a>5.4 启动集群</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># start HMaster and all HRigeonServers</span></span><br><span class="line">[centos1] $ bin/start-hbase.sh</span><br><span class="line"><span class="comment"># start backup HMaster</span></span><br><span class="line">[centos2] $ bin/start-hbase.sh</span><br><span class="line"><span class="comment"># test at centos1</span></span><br><span class="line">[centos1] <span class="comment"># bin/hbase shell</span></span><br><span class="line">&gt;list</span><br><span class="line">&gt;version</span><br><span class="line">&gt;quit</span><br></pre></td></tr></table></figure>
<h2 id="6-安装Phoenix-5-0-0-HBase-2-0"><a href="#6-安装Phoenix-5-0-0-HBase-2-0" class="headerlink" title="6. 安装Phoenix_5.0.0_HBase_2.0"></a>6. 安装Phoenix_5.0.0_HBase_2.0</h2><h3 id="6-1-设置jars"><a href="#6-1-设置jars" class="headerlink" title="6.1 设置jars"></a>6.1 设置jars</h3><p>拷贝Phoenix目录下的phoenix-core-5.0.0-HBase-2.0.jar, phoenix-5.0.0-HBase-2.0-server.jar到Hbase Server的lib目录下，将phoenix-5.0.0-HBase-2.0-client.jar拷贝到客户端。</p>
<h3 id="6-2-在bin目录下创建hadoop-core-site-xml-hdfs-site-xml以及hbase-site-xml的符号连接"><a href="#6-2-在bin目录下创建hadoop-core-site-xml-hdfs-site-xml以及hbase-site-xml的符号连接" class="headerlink" title="6.2 在bin目录下创建hadoop core-site.xml hdfs-site.xml以及hbase-site.xml的符号连接"></a>6.2 在bin目录下创建hadoop core-site.xml hdfs-site.xml以及hbase-site.xml的符号连接</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">cd</span> <span class="variable">$PHOENIX_HOME</span>/bin</span><br><span class="line">$ ln -s /home/hadoop/app/hadoop-3.1.2/etc/hadoop/core-site.xml ./core-site.xml</span><br><span class="line">$ ln -s /home/hadoop/app/hadoop-3.1.2/etc/hadoop/hdfs-site.xml ./hdfs-site.xml</span><br><span class="line">$ ln -s /home/hadop/app/hbase-2.0.5/conf/hbase-site.xml ./hbase-site.xml</span><br></pre></td></tr></table></figure>
<h3 id="6-3-重新启动HBase集群，并测试phoenix"><a href="#6-3-重新启动HBase集群，并测试phoenix" class="headerlink" title="6.3 重新启动HBase集群，并测试phoenix"></a>6.3 重新启动HBase集群，并测试phoenix</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ bin/sqlline.py centos1,centos2:2181</span><br><span class="line">&gt; !tables</span><br><span class="line">&gt; !<span class="built_in">exit</span></span><br><span class="line"><span class="comment"># create table and import data from csv</span></span><br><span class="line">$ bin/psql.py centos1,centos2:2181 create_table.sql table_data.csv table_query.sql</span><br></pre></td></tr></table></figure>
        </div>

        
            <div class="article-tags tags">
                
                    <a href="/tags/BigData/"><i class="fa fa-tag fa-fw" aria-hidden="true"></i>&nbsp;BigData</a>
                
                    <a href="/tags/Hadoop/"><i class="fa fa-tag fa-fw" aria-hidden="true"></i>&nbsp;Hadoop</a>
                
            </div>
        

        
            <div class="prev-next">
                
                
                    <section class="next">
                        <span class="art-item-right" aria-hidden="true">
                            <h6>下一篇&nbsp;<i class="fa fa-chevron-right" aria-hidden="true"></i></h6>
                            <h4>
                                <a href="/2018/10/14/Angular-7-新特性/" rel="prev" title="Angular 7 新特性">
                                    
                                        Angular 7 新特性
                                    
                                </a>
                            </h4>
                            
                                <h6 class="tags">
                                    
                                        <i class="fa fa-tag fa-fw"></i>前端
                                    
                                        <i class="fa fa-tag fa-fw"></i>Angular
                                    
                                </h6>
                            
                        </span>
                    </section>
                
            </div>
        

    </section>

</article>

<br>

<!-- 显示推荐文章和评论 -->

    <article class="post white-box comments">
        <section class="article typo">

            
                

    <div class="recommended_posts">
        <h4><i class="fa fa-bookmark fa-fw" aria-hidden="true"></i>&nbsp;你可能感兴趣的文章</h4>
        <ul>
            
                <li><a href="https://autumntail.github.io/2018/10/14/Angular-7-新特性/">Angular 7 新特性</a></li>
            
                <li><a href="https://autumntail.github.io/2018/09/20/大白话解析模拟退火算法/">大白话解析模拟退火算法</a></li>
            
                <li><a href="https://autumntail.github.io/2018/02/26/维修墙内水管/">维修墙内水管</a></li>
            
                <li><a href="https://autumntail.github.io/2018/02/14/善用Markdown-轻松写文章/">善用Markdown,轻松写文章</a></li>
            
                <li><a href="https://autumntail.github.io/2018/01/18/给空调更换Ecobee智能温控器/">给空调更换Ecobee智能温控器</a></li>
            
        </ul>
    </div>
    <script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script>


            

            

                

                

                
                    
                        <h4><i class="fa fa-comments fa-fw" aria-hidden="true"></i>&nbsp;Valine评论</h4>
                        <section id="comments">
                            <div id="valine_container" class="valine_thread">
                                </i><i class="fa fa-spinner fa-spin fa-fw"></i>
                            </div>
                        </section>
                        <script src="//unpkg.com/valine/dist/Valine.min.js"></script>
                    
                
            

        </section>
    </article>


<script>
    window.subData = {
        title: 'Hadoop 3.1.2 + Zookeeper 3.4.14 + Spark 2.4.1 + HBase 2.0.5 + Phoenix 5.0.0 高可用集群部署',
        tools: true
    }
</script>


        </div>
        <aside class='l_side'>
            
    
        
    <section class='m_widget author'>
        
            <div class='header'>
                <img class='avatar' src='/images/linchong3.png' />
            </div>
        
        <div class='content'>
            
                <h2>秋·无痕</h2>
            
            
                <div>
                    <i class="fa fa-quote-left fa-3x fa-pull-left" aria-hidden="true"></i>
                    电工、木匠、程序员……
                </div>
            
        </div>
        
            <div class="social-wrapper">
              
                
                    <a href="mailto:richard.wu78@gmail.com" class="social flat-box" target="_blank" rel="external"><i class="social fa fa-envelope" aria-hidden="true"></i></a>
                
              
                
                    <a href="https://github.com/autumntail" class="social flat-box" target="_blank" rel="external"><i class="social fa fa-github" aria-hidden="true"></i></a>
                
              
                
              
                
              
                
              
                
              
                
                    <a href="atom" class="social flat-box" target="_blank" rel="external"><i class="social fa fa-rss" aria-hidden="true"></i></a>
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
            </div>
        
    </section>


    
    
        <section class='m_widget categories'>
    <div class='header'><i class="fa fa-sitemap fa-fw" aria-hidden="true"></i>&nbsp;&nbsp;分类</div>
    <div class='content'>
        
            <ul class="entry">
                
                    <li><a class="flat-box" href="/categories/生活DIY/"><div class='name'>生活DIY</div><div class='badge'>15</div></a></li>
                
                    <li><a class="flat-box" href="/categories/计算机技术/"><div class='name'>计算机技术</div><div class='badge'>5</div></a></li>
                
            </ul>
        
    </div>
</section>

    
    
        
    <section class='m_widget tagcloud'>
        <div class="header"><i class="fa fa-tags fa-fw" aria-hidden="true"></i>&nbsp;&nbsp;标签</div>
        <div class='content'>
            <a href="/tags/Angular/" style="font-size: 14px; color: #999">Angular</a> <a href="/tags/BigData/" style="font-size: 14px; color: #999">BigData</a> <a href="/tags/Hadoop/" style="font-size: 14px; color: #999">Hadoop</a> <a href="/tags/前端/" style="font-size: 14px; color: #999">前端</a> <a href="/tags/建筑/" style="font-size: 22px; color: #636363">建筑</a> <a href="/tags/木工/" style="font-size: 18px; color: #7e7e7e">木工</a> <a href="/tags/机械/" style="font-size: 16px; color: #8b8b8b">机械</a> <a href="/tags/水/" style="font-size: 24px; color: #555">水</a> <a href="/tags/电/" style="font-size: 20px; color: #707070">电</a> <a href="/tags/空调/" style="font-size: 16px; color: #8b8b8b">空调</a> <a href="/tags/算法/" style="font-size: 14px; color: #999">算法</a> <a href="/tags/网络/" style="font-size: 16px; color: #8b8b8b">网络</a> <a href="/tags/车/" style="font-size: 18px; color: #7e7e7e">车</a>
        </div>
    </section>


    
    
    
    
        
    <section class='m_widget toc-wrapper'>
        <div class="header"><i class="fa fa-list fa-fw" aria-hidden="true"></i>&nbsp;&nbsp;目录</div>
        <div class='content'>
            <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-集群环境：采用4台主机，其中101，102为HA主节点。可采用VMWare模拟。"><span class="toc-text">1. 集群环境：采用4台主机，其中101，102为HA主节点。可采用VMWare模拟。</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-1-用VMWare-Workstation准备一个虚拟环境，安装CentOS-7-6"><span class="toc-text">1.1 用VMWare Workstation准备一个虚拟环境，安装CentOS 7.6</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-1-1-配置主机名、IP"><span class="toc-text">1.1.1 配置主机名、IP</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-1-2-安装基础包"><span class="toc-text">1.1.2 安装基础包</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-1-3-安装-JDK-1-8"><span class="toc-text">1.1.3 安装 JDK 1.8</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-1-4-安装Scala"><span class="toc-text">1.1.4 安装Scala</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-1-5-关闭防火墙"><span class="toc-text">1.1.5 关闭防火墙</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-1-6-关闭Swap"><span class="toc-text">1.1.6 关闭Swap</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-1-7-禁用SELinux"><span class="toc-text">1.1.7 禁用SELinux</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-1-8-设置环境变量"><span class="toc-text">1.1.8 设置环境变量</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-2-Clone三个新的镜像"><span class="toc-text">1.2 Clone三个新的镜像</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-3-更改新镜像的IP-hostname"><span class="toc-text">1.3 更改新镜像的IP, hostname</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-4-设置SSH免登录"><span class="toc-text">1.4 设置SSH免登录</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-4-1-生成公钥"><span class="toc-text">1.4.1 生成公钥</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-4-2-分发公钥"><span class="toc-text">1.4.2 分发公钥</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-4-3-在其它主机上执行同样步骤"><span class="toc-text">1.4.3 在其它主机上执行同样步骤</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-5-创建相关目录"><span class="toc-text">1.5 创建相关目录</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-6-设置环境变量"><span class="toc-text">1.6 设置环境变量</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-安装zookeeper"><span class="toc-text">2. 安装zookeeper</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#2-1-创建配置文件zoo-cfg"><span class="toc-text">2.1 创建配置文件zoo.cfg</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-2-为每台服务器创建身份标识"><span class="toc-text">2.2 为每台服务器创建身份标识</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-3-在所有节点上启动zookeeper"><span class="toc-text">2.3 在所有节点上启动zookeeper</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-4-查看zookeeper运行状态"><span class="toc-text">2.4 查看zookeeper运行状态</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-安装hadoop"><span class="toc-text">3. 安装hadoop</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#3-1-修改配置文件"><span class="toc-text">3.1 修改配置文件</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#3-1-1-编辑-HADOOP-HOME-etc-hadoop-core-site-xml"><span class="toc-text">3.1.1 编辑 $HADOOP_HOME/etc/hadoop/core-site.xml</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-1-2-编辑-HADOOP-HOME-etc-hadoop-hdfs-site-xml"><span class="toc-text">3.1.2 编辑$HADOOP_HOME/etc/hadoop/hdfs-site.xml</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-1-3-mapred-site-xml"><span class="toc-text">3.1.3 mapred.site.xml</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-1-4-capacity-scheduler-xml"><span class="toc-text">3.1.4 capacity-scheduler.xml</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-1-5-yarn-site-xml"><span class="toc-text">3.1.5 yarn-site.xml</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-1-6-hadoop-env-sh"><span class="toc-text">3.1.6 hadoop-env.sh</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-1-7-修改workers"><span class="toc-text">3.1.7 修改workers</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-2-启动Hadoop"><span class="toc-text">3.2 启动Hadoop</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#3-2-1-启动JournalNode集群"><span class="toc-text">3.2.1 启动JournalNode集群</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-2-2-格式化NameNode"><span class="toc-text">3.2.2 格式化NameNode</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-2-3-启动zookeeper故障转移控制器，格式化zookeeper"><span class="toc-text">3.2.3 启动zookeeper故障转移控制器，格式化zookeeper</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-2-4-启动NameNode"><span class="toc-text">3.2.4 启动NameNode</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-2-5-验证高可用性"><span class="toc-text">3.2.5 验证高可用性</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-安装Spark-2-4-1"><span class="toc-text">4. 安装Spark 2.4.1</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#4-1-编辑spark-env-sh"><span class="toc-text">4.1 编辑spark-env.sh</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-2-编辑spark-defaults-conf"><span class="toc-text">4.2 编辑spark-defaults.conf</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-3-编辑slaves"><span class="toc-text">4.3 编辑slaves</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-4-启动集群"><span class="toc-text">4.4 启动集群</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5-安装HBase-2-0-5"><span class="toc-text">5. 安装HBase 2.0.5</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#5-1-修改hbase-site-xml"><span class="toc-text">5.1 修改hbase-site.xml</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-2-编辑hbase-env-sh"><span class="toc-text">5.2 编辑hbase-env.sh</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-3-编辑slaves"><span class="toc-text">5.3 编辑slaves</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-4-启动集群"><span class="toc-text">5.4 启动集群</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#6-安装Phoenix-5-0-0-HBase-2-0"><span class="toc-text">6. 安装Phoenix_5.0.0_HBase_2.0</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#6-1-设置jars"><span class="toc-text">6.1 设置jars</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-2-在bin目录下创建hadoop-core-site-xml-hdfs-site-xml以及hbase-site-xml的符号连接"><span class="toc-text">6.2 在bin目录下创建hadoop core-site.xml hdfs-site.xml以及hbase-site.xml的符号连接</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-3-重新启动HBase集群，并测试phoenix"><span class="toc-text">6.3 重新启动HBase集群，并测试phoenix</span></a></li></ol></li></ol>
        </div>
    </section>


    


        </aside>
        <script>setLoadingBarProgress(60);</script>
    </div>
    </div>
    <footer id="footer" class="clearfix">
    
        <div class="social-wrapper">
          
              
                  <a href="mailto:richard.wu78@gmail.com" class="social fa fa-envelope flat-box" target="_blank" rel="external"></a>
              
          
              
                  <a href="https://github.com/autumntail" class="social fa fa-github flat-box" target="_blank" rel="external"></a>
              
          
              
          
              
          
              
          
              
          
              
                  <a href="atom" class="social fa fa-rss flat-box" target="_blank" rel="external"></a>
              
          
              
          
              
          
              
          
              
          
              
          
              
          
              
          
              
          
              
          
              
          
              
          
              
          
        </div>
    
    <br>
    <div>博客内容遵循 <a target="_blank" href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh" class="licenses">知识共享 署名 - 非商业性 - 相同方式共享 4.0 国际协议</a></div>
    <div>本站使用 <a href="https://github.com/xaoxuu/hexo-theme-material-x" target="_blank" class="codename">Material X</a> 作为主题，
		总访问量为 <span id="busuanzi_value_site_pv"><i class="fa fa-spinner fa-spin fa-fw" aria-hidden="true"></i></span> 次。
    </div>
</footer>
<!-- 根据页面mathjax变量决定是否加载MathJax数学公式js -->


    <script>setLoadingBarProgress(80);</script>
    <script src="//apps.bdimg.com/libs/jquery/2.1.4/jquery.min.js"></script>
<script src='//cdn.bootcss.com/node-waves/0.7.5/waves.min.js'></script>
<script src="//cdn.bootcss.com/scrollReveal.js/3.3.2/scrollreveal.min.js"></script>
<!-- 访问统计 -->
<script async src="//dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script>


<script src="/js/jquery.fitvids.js"></script>

<script src="/js/search.js"></script>
<script src="/js/app.js"></script>


    
    
    
        
            <script>
            var GUEST_INFO = ['nick','mail','link'];
            var guest_info = 'nick,mail,link'.split(',').filter(function(item){
                return GUEST_INFO.indexOf(item) > -1
            });
            var notify = 'false' == true;
            var verify = 'false' == true;
            var valine = new Valine();
            valine.init({
                el: '#valine_container',
                notify: notify,
                verify: verify,
                guest_info: guest_info,
                appId: "gCJbBBdtAgP8I77vcMrbq3zY-MdYXbMMI",
                appKey: "qybpLw2rpeFwRHbUFb8dciYs",
                placeholder: "欢迎留下你的脚印",
                pageSize:'10',
                avatar:'mp',
                lang:'zh-cn'
            })
            </script>
        
    


    <script>setLoadingBarProgress(100);</script>
</body>
