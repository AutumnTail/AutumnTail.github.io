<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>人似秋鸿来有信，事如春梦了无痕</title>
  
  <subtitle>一个技术宅的博客</subtitle>
  <link href="/atom.xml" rel="self"/>
  
  <link href="https://autumntail.github.io/"/>
  <updated>2019-04-23T03:31:44.307Z</updated>
  <id>https://autumntail.github.io/</id>
  
  <author>
    <name>秋·无痕</name>
    
  </author>
  
  <generator uri="http://hexo.io/">Hexo</generator>
  
  <entry>
    <title>Hadoop 3.1.2 + Zookeeper 3.4.14 + Spark 2.4.1 + HBase 2.0.5 + Phoenix 5.0.0 高可用集群部署</title>
    <link href="https://autumntail.github.io/2019/04/22/hadoop-ha-cluster/"/>
    <id>https://autumntail.github.io/2019/04/22/hadoop-ha-cluster/</id>
    <published>2019-04-23T03:00:02.000Z</published>
    <updated>2019-04-23T03:31:44.307Z</updated>
    
    <content type="html"><![CDATA[<p>本文记录梳理一下手动布署hadoop集群具体步骤，在相互兼容的基础上，选择了目前为止各个组件的最新版。所以请不要询问为什么是这几个版本，因为作者已经花了大量的时间尝试过。</p><a id="more"></a><h2 id="1-集群环境：采用4台主机，其中101，102为HA主节点。可采用VMWare模拟。"><a href="#1-集群环境：采用4台主机，其中101，102为HA主节点。可采用VMWare模拟。" class="headerlink" title="1. 集群环境：采用4台主机，其中101，102为HA主节点。可采用VMWare模拟。"></a>1. 集群环境：采用4台主机，其中101，102为HA主节点。可采用VMWare模拟。</h2><table><thead><tr><th style="text-align:center">IP地址</th><th style="text-align:center">主机名</th><th style="text-align:center">Hadoop</th><th style="text-align:center">Spark</th><th style="text-align:center">HBase</th><th style="text-align:center">Phoenix</th></tr></thead><tbody><tr><td style="text-align:center">192.168.80.101</td><td style="text-align:center">centos1</td><td style="text-align:center">namenode</td><td style="text-align:center">Master</td><td style="text-align:center">HMaster</td><td style="text-align:center">Server/Client</td></tr><tr><td style="text-align:center">192.168.80.102</td><td style="text-align:center">centos2</td><td style="text-align:center">namenode</td><td style="text-align:center">Master</td><td style="text-align:center">HMaster</td><td style="text-align:center">Server</td></tr><tr><td style="text-align:center">192.168.80.103</td><td style="text-align:center">centos3</td><td style="text-align:center">datanode</td><td style="text-align:center">Worker</td><td style="text-align:center">HRigeonServer</td><td style="text-align:center">Server</td></tr><tr><td style="text-align:center">192.168.80.104</td><td style="text-align:center">centos4</td><td style="text-align:center">datanode</td><td style="text-align:center">Worker</td><td style="text-align:center">HRigeonServer</td><td style="text-align:center">Server</td></tr></tbody></table><h3 id="1-1-用VMWare-Workstation准备一个虚拟环境，安装CentOS-7-6"><a href="#1-1-用VMWare-Workstation准备一个虚拟环境，安装CentOS-7-6" class="headerlink" title="1.1 用VMWare Workstation准备一个虚拟环境，安装CentOS 7.6"></a>1.1 用VMWare Workstation准备一个虚拟环境，安装CentOS 7.6</h3><h4 id="1-1-1-配置主机名、IP"><a href="#1-1-1-配置主机名、IP" class="headerlink" title="1.1.1 配置主机名、IP"></a>1.1.1 配置主机名、IP</h4><p>编辑/etc/hostname</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ vim /etc/hostname</span><br><span class="line">centos1</span><br></pre></td></tr></table></figure><p>编辑/etc/hosts<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$ vim /etc/hosts</span><br><span class="line">127.0.0.1   localhost localhost.localdomain localhost4 ocalhost4.localdomain4</span><br><span class="line">::1         localhost localhost.localdomain localhost6 localhost6.localdomain6</span><br><span class="line">192.168.80.101 centos1</span><br><span class="line">192.168.80.102 centos2</span><br><span class="line">192.168.80.103 centos3</span><br><span class="line">192.168.80.104 centos4</span><br></pre></td></tr></table></figure></p><p>设置IP路由等，编辑/etc/sysconfig/network-scripts/ifcfg-eth0</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">$ vim /etc/sysconfig/network-scripts/ifcfg-ens33</span><br><span class="line">TYPE=Ethernet</span><br><span class="line">PROXY_METHOD=none</span><br><span class="line">BROWSER_ONLY=no</span><br><span class="line">BOOTPROTO=none</span><br><span class="line">DEFROUTE=yes</span><br><span class="line">IPV4_FAILURE_FATAL=no</span><br><span class="line">IPV6INIT=yes</span><br><span class="line">IPV6_AUTOCONF=yes</span><br><span class="line">IPV6_DEFROUTE=yes</span><br><span class="line">IPV6_FAILURE_FATAL=no</span><br><span class="line">IPV6_ADDR_GEN_MODE=stable-privacy</span><br><span class="line">NAME=ens33</span><br><span class="line">UUID=2d111847-e946-496c-918d-49815fcd251b</span><br><span class="line">DEVICE=ens33</span><br><span class="line">ONBOOT=yes</span><br><span class="line">IPADDR=192.168.80.101</span><br><span class="line">PREFIX=24</span><br><span class="line">GATEWAY=192.168.80.2</span><br><span class="line">DNS1=192.168.80.2</span><br><span class="line">IPV6_PRIVACY=no</span><br></pre></td></tr></table></figure><p>重启网络</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo systemctl restart network</span><br></pre></td></tr></table></figure><h4 id="1-1-2-安装基础包"><a href="#1-1-2-安装基础包" class="headerlink" title="1.1.2 安装基础包"></a>1.1.2 安装基础包</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ sudo yum install gcc openssh openssl-devel bzip2-devel libffi-devel ntp -y</span><br><span class="line">$ sudo yum install net-tools checkpolicy dkms foomatic bash-completion psmisc -y</span><br></pre></td></tr></table></figure><h4 id="1-1-3-安装-JDK-1-8"><a href="#1-1-3-安装-JDK-1-8" class="headerlink" title="1.1.3 安装 JDK 1.8"></a>1.1.3 安装 JDK 1.8</h4><p>可直接安装Open JDK或者通过包管理工具Jabba安装。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">$ curl -sL https://github.com/shyiko/jabba/raw/master/install.sh | bash &amp;&amp; . ~/.jabba/jabba.sh</span><br><span class="line"><span class="comment"># list available JDK's</span></span><br><span class="line">$ jabba ls-remote</span><br><span class="line"><span class="comment"># install Oracle 1.8</span></span><br><span class="line">$ jabba install 1.8</span><br><span class="line"><span class="comment"># or install Adopt OpenJDK (Hotspot)</span></span><br><span class="line">$ jabba install adopt@1.8.0</span><br><span class="line"><span class="comment"># switch to </span></span><br><span class="line">$ jabba use adopt@1.8.0</span><br><span class="line"><span class="comment"># set default</span></span><br><span class="line">$ jabba <span class="built_in">alias</span> default adopt@1.8.0</span><br></pre></td></tr></table></figure><h4 id="1-1-4-安装Scala"><a href="#1-1-4-安装Scala" class="headerlink" title="1.1.4 安装Scala"></a>1.1.4 安装Scala</h4><p>可通过sdkman安装scala</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ curl -s <span class="string">"https://get.sdkman.io"</span> | bash</span><br><span class="line">$ sdk install scala</span><br></pre></td></tr></table></figure><h4 id="1-1-5-关闭防火墙"><a href="#1-1-5-关闭防火墙" class="headerlink" title="1.1.5 关闭防火墙"></a>1.1.5 关闭防火墙</h4><p>在开始安装集群前，最好先关闭防火墙，否则后续会出现很多异常问题。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo systemctl stop firewalld &amp; systemctl <span class="built_in">disable</span> firewalld</span><br></pre></td></tr></table></figure><h4 id="1-1-6-关闭Swap"><a href="#1-1-6-关闭Swap" class="headerlink" title="1.1.6 关闭Swap"></a>1.1.6 关闭Swap</h4><ul><li>执行swapoff -a临时关闭，但系统重启后恢复</li><li>编辑/etc/fstab，注释掉包含swap的行后，重启</li></ul><h4 id="1-1-7-禁用SELinux"><a href="#1-1-7-禁用SELinux" class="headerlink" title="1.1.7 禁用SELinux"></a>1.1.7 禁用SELinux</h4><p>编辑/etc/selinux/config，更改SELINUX=disabled，重启。检查状态</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sestatus</span><br></pre></td></tr></table></figure><h4 id="1-1-8-设置环境变量"><a href="#1-1-8-设置环境变量" class="headerlink" title="1.1.8 设置环境变量"></a>1.1.8 设置环境变量</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">$ sudo vim /etc/profile</span><br><span class="line"></span><br><span class="line"><span class="comment"># java</span></span><br><span class="line"><span class="comment"># export JAVA_HOME=/home/richard/.jabba/jdk/adopt@1.8.202-08</span></span><br><span class="line"><span class="built_in">export</span> JRE_HOME=/home/richard/.jabba/jdk/adopt@1.8.202-08/jre</span><br><span class="line"></span><br><span class="line"><span class="comment"># scala</span></span><br><span class="line"><span class="built_in">export</span> SCALA_HOME=/home/richard/hadoop/app/scala-2.12.8</span><br><span class="line"><span class="built_in">export</span> PATH=<span class="variable">$PATH</span>:<span class="variable">$JRM_HOME</span>/bin:<span class="variable">$SCALA_HOME</span>/bin</span><br><span class="line"><span class="comment"># export PATH=$PATH:$JAVA_HOME/bin:$JRE_HOME/bin:$SCALA_HOME/bin</span></span><br></pre></td></tr></table></figure><h3 id="1-2-Clone三个新的镜像"><a href="#1-2-Clone三个新的镜像" class="headerlink" title="1.2 Clone三个新的镜像"></a>1.2 Clone三个新的镜像</h3><p><img src="/images/clone-vm-image.png" alt=""></p><h3 id="1-3-更改新镜像的IP-hostname"><a href="#1-3-更改新镜像的IP-hostname" class="headerlink" title="1.3 更改新镜像的IP, hostname"></a>1.3 更改新镜像的IP, hostname</h3><h3 id="1-4-设置SSH免登录"><a href="#1-4-设置SSH免登录" class="headerlink" title="1.4 设置SSH免登录"></a>1.4 设置SSH免登录</h3><h4 id="1-4-1-生成公钥"><a href="#1-4-1-生成公钥" class="headerlink" title="1.4.1 生成公钥"></a>1.4.1 生成公钥</h4><p>在centos1上执行</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ ssh-keygen -t rsa</span><br></pre></td></tr></table></figure><p>一路回车，默认值。</p><h4 id="1-4-2-分发公钥"><a href="#1-4-2-分发公钥" class="headerlink" title="1.4.2 分发公钥"></a>1.4.2 分发公钥</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ ssh-copy-id centos1</span><br><span class="line">$ ssh-copy-id centos2</span><br><span class="line">$ ssh-copy-id centos3</span><br><span class="line">$ ssh-copy-id centos4</span><br></pre></td></tr></table></figure><h4 id="1-4-3-在其它主机上执行同样步骤"><a href="#1-4-3-在其它主机上执行同样步骤" class="headerlink" title="1.4.3 在其它主机上执行同样步骤"></a>1.4.3 在其它主机上执行同样步骤</h4><h3 id="1-5-创建相关目录"><a href="#1-5-创建相关目录" class="headerlink" title="1.5 创建相关目录"></a>1.5 创建相关目录</h3><p>相关文件目录都在~/hadoop下，~/hadoop/src放置源码，程序安装到~/hadoop/app，数据放在~/hadoop/data，日志在~/hadoop/logs</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="keyword">for</span> N <span class="keyword">in</span> $(seq 1 4); <span class="keyword">do</span> ssh centos<span class="variable">$N</span> sudo yum install ntp -y; <span class="keyword">done</span></span><br><span class="line"><span class="comment"># 创建 Hadoop3.1.2 和 Zookeeper3.4.14 需要的目录</span></span><br><span class="line">$ <span class="keyword">for</span> N <span class="keyword">in</span> $(seq 1 4); <span class="keyword">do</span> ssh centos<span class="variable">$N</span> mkdir /home/hadoop/&#123;src,app,logs,data&#125; -p; <span class="keyword">done</span>;</span><br><span class="line">$ <span class="keyword">for</span> N <span class="keyword">in</span> $(seq 1 4); <span class="keyword">do</span> ssh centos<span class="variable">$N</span> mkdir /home/hadoop/data/&#123;hadoop-3.1.2,zookeeper-3.4.14&#125; -p; <span class="keyword">done</span>;</span><br><span class="line">$ <span class="keyword">for</span> N <span class="keyword">in</span> $(seq 1 4); <span class="keyword">do</span> ssh centos<span class="variable">$N</span> mkdir /home/hadoop/logs/&#123;hadoop-3.1.2,zookeeper-3.4.14&#125; -p; <span class="keyword">done</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">## 在 Hadoop3.1.2 的 NameNode 上创建 HA 共享目录</span></span><br><span class="line">$ <span class="keyword">for</span> N <span class="keyword">in</span> $(seq 1 4); <span class="keyword">do</span> ssh centos<span class="variable">$N</span> mkdir /home/hadoop/data/hadoop-3.1.2/&#123;journalnode,ha-name-dir-shared&#125; -p; <span class="keyword">done</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建 Hbase2.0.5 需要的目录</span></span><br><span class="line">$ <span class="keyword">for</span> N <span class="keyword">in</span> $(seq 1 4); <span class="keyword">do</span> ssh centos<span class="variable">$N</span> mkdir /home/hadoop/logs/hbase-2.0.5 -p; <span class="keyword">done</span>;</span><br><span class="line">$ <span class="keyword">for</span> N <span class="keyword">in</span> $(seq 1 4); <span class="keyword">do</span> ssh centos<span class="variable">$N</span> mkdir /home/hadoop/data/hbase-2.0.5 -p; <span class="keyword">done</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建 Spark2.4.1 需要的目录</span></span><br><span class="line">$ <span class="keyword">for</span> N <span class="keyword">in</span> $(seq 1 4); <span class="keyword">do</span> ssh centos<span class="variable">$N</span> mkdir /home/hadoop/data/spark-2.4.1 -p; <span class="keyword">done</span>;</span><br><span class="line">$ <span class="keyword">for</span> N <span class="keyword">in</span> $(seq 1 4); <span class="keyword">do</span> ssh centos<span class="variable">$N</span> mkdir /home/hadoop/logs/spark-2.4.1 -p; <span class="keyword">done</span>;</span><br></pre></td></tr></table></figure><h3 id="1-6-设置环境变量"><a href="#1-6-设置环境变量" class="headerlink" title="1.6 设置环境变量"></a>1.6 设置环境变量</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">$ sudo vim /etc/profile</span><br><span class="line"><span class="comment"># hadoop</span></span><br><span class="line"><span class="built_in">export</span> HADOOP_HOME=/home/richard/hadoop/app/hadoop-3.1.2</span><br><span class="line"><span class="built_in">export</span> HADOOP_CONF_DIR=<span class="variable">$HADOOP_HOME</span>/etc/hadoop</span><br><span class="line"><span class="built_in">export</span> HADOOP_LOG_DIR=/home/richard/hadoop/logs/hadoop-3.1.2</span><br><span class="line"><span class="built_in">export</span> PATH=<span class="variable">$PATH</span>:<span class="variable">$HADOOP_HOME</span>/sbin:<span class="variable">$HADOOP_HOME</span>/bin</span><br><span class="line"></span><br><span class="line"><span class="comment"># zookepper</span></span><br><span class="line"><span class="built_in">export</span> ZOOKEEPER_HOME=/home/richard/hadoop/app/zookeeper-3.4.14</span><br><span class="line"><span class="built_in">export</span> PATH=<span class="variable">$PATH</span>:<span class="variable">$ZOOKEEPER_HOME</span>/bin</span><br><span class="line"></span><br><span class="line"><span class="comment"># hbase</span></span><br><span class="line"><span class="built_in">export</span> HBASE_HOME=/home/richard/hadoop/app/hbase-2.0.5</span><br><span class="line"><span class="built_in">export</span> PATH=<span class="variable">$PATH</span>:<span class="variable">$HBASE_HOME</span>/bin</span><br><span class="line"></span><br><span class="line"><span class="comment"># phoenix for hbase</span></span><br><span class="line"><span class="built_in">export</span> PHOENIX_HOME=/home/richard/hadoop/app/phoenix-5.0.0-HBase-2.0</span><br><span class="line"><span class="built_in">export</span> PHOENIX_CLASSPATH=<span class="variable">$PHOENIX_HOME</span></span><br><span class="line"><span class="built_in">export</span> PATH=<span class="variable">$PATH</span>:<span class="variable">$PHOENIX_HOME</span>/bin</span><br><span class="line"></span><br><span class="line"><span class="comment"># spark</span></span><br><span class="line"><span class="built_in">export</span> SPARK_HOME=/home/richard/hadoop/app/spark-2.4.1</span><br><span class="line"><span class="built_in">export</span> PATH=<span class="variable">$PATH</span>:<span class="variable">$SPARK_HOME</span>/bin:<span class="variable">$SPARK_HOME</span>/sbin</span><br><span class="line"></span><br><span class="line">$ <span class="built_in">source</span> /etc/profile</span><br></pre></td></tr></table></figure><h2 id="2-安装zookeeper"><a href="#2-安装zookeeper" class="headerlink" title="2. 安装zookeeper"></a>2. 安装zookeeper</h2><h3 id="2-1-创建配置文件zoo-cfg"><a href="#2-1-创建配置文件zoo-cfg" class="headerlink" title="2.1 创建配置文件zoo.cfg"></a>2.1 创建配置文件zoo.cfg</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">cd</span> <span class="variable">$ZOOKEEPER_HOME</span>/conf</span><br><span class="line">$ cp zoo-sample.cfg zoo.cfg</span><br><span class="line">$ vim zoo.cfg</span><br><span class="line"><span class="comment"># ZooKeeper使用的基本时间单位（以毫秒为单位）。它用于做心跳，最小会话超时将是tickTime的两倍。</span></span><br><span class="line">tickTime=200</span><br><span class="line"></span><br><span class="line"><span class="comment"># 存储内存数据库快照的位置，除非另有说明，否则指向数据库更新的事务日志。</span></span><br><span class="line">dataDir=/home/work/_data/zookeeper-3.4.13</span><br><span class="line"></span><br><span class="line"><span class="comment"># 用于事务日志的不同目录。</span></span><br><span class="line">dataLogDir=/home/work/_logs/zookeeper-3.4.13</span><br><span class="line"></span><br><span class="line"><span class="comment"># 侦听客户端连接的端口</span></span><br><span class="line">clientPort=2181</span><br><span class="line"></span><br><span class="line"><span class="comment"># 表示在leader选举结束后，followers与leader同步需要的时间，如果followers比较多或者说leader的数据灰常多时，同步时间相应可能会增加，那么这个值也需要相应增加。当然，这个值也是follower和observer在开始同步leader的数据时的最大等待时间(setSoTimeout)</span></span><br><span class="line">initLimit=5</span><br><span class="line"></span><br><span class="line"><span class="comment"># 表示follower和observer与leader交互时的最大等待时间，只不过是在与leader同步完毕之后，进入正常请求转发或ping等消息交互时的超时时间。</span></span><br><span class="line">syncLimit=2</span><br><span class="line"></span><br><span class="line"><span class="comment"># server.serverid=host:tickpot:electionport</span></span><br><span class="line"><span class="comment"># server：固定写法</span></span><br><span class="line"><span class="comment"># serverid：每个服务器的指定ID（必须处于1-255之间，必须每一台机器不能重复）</span></span><br><span class="line"><span class="comment"># host：主机名</span></span><br><span class="line"><span class="comment"># tickpot：心跳通信端口</span></span><br><span class="line"><span class="comment"># electionport：选举端口</span></span><br><span class="line">server.1=centos1:2888:3888</span><br><span class="line">server.2=centos2:2888:3888</span><br><span class="line">server.3=centos3:2888:3888</span><br><span class="line">server.4=centos4:2888:3888</span><br></pre></td></tr></table></figure><p>复制zookeeper到其它机器上</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="keyword">for</span> N <span class="keyword">in</span> $(seq 2 4); <span class="keyword">do</span> scp -r /home/hadoop/app/zookeeper-3.4.14 centos<span class="variable">$N</span>:/home/hadoop/app/; <span class="keyword">done</span>;</span><br></pre></td></tr></table></figure><h3 id="2-2-为每台服务器创建身份标识"><a href="#2-2-为每台服务器创建身份标识" class="headerlink" title="2.2 为每台服务器创建身份标识"></a>2.2 为每台服务器创建身份标识</h3><p>通过创建名为 myid 的文件将每台服务器标识身份，每个服务器对应一个文件，用于服务器快速选举，该文件位于配置文件 /home/hadoop/app/zookeeper-3.4.14/conf/zoo.cfg 中的 dataDir 配置项中。<br>  <br>接下来，我们在配置文件 /home/hadoop/app/zookeeper-3.4.14/conf/zoo.cfg 中配置的 dataDir 目录，创建 myid 文件，内容为 server. 后面的数字，记住只能是数字：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># centos1</span></span><br><span class="line">$ <span class="built_in">echo</span> 1 &gt; /home/hadoop/data/zookeeper-3.4.14/myid</span><br><span class="line"></span><br><span class="line"><span class="comment"># centos2</span></span><br><span class="line">$ <span class="built_in">echo</span> 2 &gt; /home/hadoop/data/zookeeper-3.4.14/myid</span><br><span class="line"></span><br><span class="line"><span class="comment"># centos3</span></span><br><span class="line">$ <span class="built_in">echo</span> 3 &gt; /home/hadoop/data/zookeeper-3.4.14/myid</span><br><span class="line"></span><br><span class="line"><span class="comment"># centos4</span></span><br><span class="line">$ <span class="built_in">echo</span> 4 &gt; /home/hadoop/data/zookeeper-3.4.14/myid</span><br></pre></td></tr></table></figure><h3 id="2-3-在所有节点上启动zookeeper"><a href="#2-3-在所有节点上启动zookeeper" class="headerlink" title="2.3 在所有节点上启动zookeeper"></a>2.3 在所有节点上启动zookeeper</h3><p>在所有机器上运行 zkServer.sh start 命令启动服务，然后输入 JPS 命令，在所有节点中，您将看到 QuorumPeerMain 服务。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="keyword">for</span> N <span class="keyword">in</span> $(seq 1 4); <span class="keyword">do</span> ssh centos<span class="variable">$N</span> /home/hadoop/app/bin/zkServer.sh start; <span class="keyword">done</span>;</span><br><span class="line"><span class="comment"># check if success</span></span><br><span class="line">$ <span class="keyword">for</span> N <span class="keyword">in</span> $(seq 1 4); <span class="keyword">do</span> ssh centos<span class="variable">$N</span> jps; <span class="keyword">done</span>;</span><br><span class="line">44861 Jps</span><br><span class="line">12143 QuorumPeerMain</span><br></pre></td></tr></table></figure><h3 id="2-4-查看zookeeper运行状态"><a href="#2-4-查看zookeeper运行状态" class="headerlink" title="2.4 查看zookeeper运行状态"></a>2.4 查看zookeeper运行状态</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># will see only one as leader, and others as followers</span></span><br><span class="line">$ zkServer.sh status</span><br><span class="line"><span class="comment"># check if zookeeper is installed correctly by zk cli</span></span><br><span class="line">$ zkCli.sh</span><br><span class="line">...</span><br><span class="line">ls /</span><br><span class="line">[zookeeper]</span><br></pre></td></tr></table></figure><h2 id="3-安装hadoop"><a href="#3-安装hadoop" class="headerlink" title="3. 安装hadoop"></a>3. 安装hadoop</h2><h3 id="3-1-修改配置文件"><a href="#3-1-修改配置文件" class="headerlink" title="3.1 修改配置文件"></a>3.1 修改配置文件</h3><h4 id="3-1-1-编辑-HADOOP-HOME-etc-hadoop-core-site-xml"><a href="#3-1-1-编辑-HADOOP-HOME-etc-hadoop-core-site-xml" class="headerlink" title="3.1.1 编辑 $HADOOP_HOME/etc/hadoop/core-site.xml"></a>3.1.1 编辑 $HADOOP_HOME/etc/hadoop/core-site.xml</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span><br><span class="line">&lt;?xml-stylesheet type="text/xsl" href="configuration.xsl"?&gt;</span><br><span class="line"><span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>fs.defaultFS<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>hdfs://bigdata<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">description</span>&gt;</span>默认文件系统的名称。一个URI，其方案和权限决定了FileSystem的实现。<span class="tag">&lt;/<span class="name">description</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>ha.zookeeper.quorum<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>centos1:2181,centos2:2181,centos3:2181,centos4:2181<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">description</span>&gt;</span>由逗号分隔的ZooKeeper服务器地址列表，由ZKFailoverController在自动故障转移中使用。<span class="tag">&lt;/<span class="name">description</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>hadoop.tmp.dir<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>/home/hadoop/data/hadoop-3.1.2<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">description</span>&gt;</span>数据目录目录<span class="tag">&lt;/<span class="name">description</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>dfs.ha.fencing.methods<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>sshfence<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">description</span>&gt;</span>用于服务防护的防护方法列表。可能包含内置方法（例如shell和sshfence）或用户定义的方法。<span class="tag">&lt;/<span class="name">description</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>dfs.ha.fencing.ssh.private-key-files<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>/root/.ssh/id_rsa<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">description</span>&gt;</span>用于内置sshfence fencer的SSH私钥文件。<span class="tag">&lt;/<span class="name">description</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>io.file.buffer.size<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>131072<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">description</span>&gt;</span>SequenceFiles中使用的读/写缓冲区的大小。<span class="tag">&lt;/<span class="name">description</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>ipc.client.connect.max.retries<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>100<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">description</span>&gt;</span>客户端为建立服务器连接而重试的次数。<span class="tag">&lt;/<span class="name">description</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>ipc.client.connect.retry.interval<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>10000<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">description</span>&gt;</span>客户端在重试建立服务器连接之前将等待的毫秒数。<span class="tag">&lt;/<span class="name">description</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br></pre></td></tr></table></figure><h4 id="3-1-2-编辑-HADOOP-HOME-etc-hadoop-hdfs-site-xml"><a href="#3-1-2-编辑-HADOOP-HOME-etc-hadoop-hdfs-site-xml" class="headerlink" title="3.1.2 编辑$HADOOP_HOME/etc/hadoop/hdfs-site.xml"></a>3.1.2 编辑$HADOOP_HOME/etc/hadoop/hdfs-site.xml</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span><br><span class="line">&lt;?xml-stylesheet type="text/xsl" href="configuration.xsl"?&gt;</span><br><span class="line"><span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>dfs.nameservices<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>bigdata<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>dfs.ha.namenodes.bigdata<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>centos1,centos2<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">description</span>&gt;</span>给定名称服务的前缀包含给定名称服务的逗号分隔的名称节点列表。<span class="tag">&lt;/<span class="name">description</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>dfs.namenode.rpc-address.bigdata.centos1<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>centos1:8020<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>dfs.namenode.rpc-address.bigdata.centos2<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>centos2:8020<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>dfs.namenode.http-address.bigdata.centos1<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>centos1:50070<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>dfs.namenode.http-address.bigdata.centos2<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>centos2:50070<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>dfs.namenode.shared.edits.dir<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>qjournal://centos1:8485;centos2:8485/bigdata<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">description</span>&gt;</span>HA群集中多个名称节点之间的共享存储上的目录。此目录将由活动写入并由备用数据库读取，以保持命名空间同步。<span class="tag">&lt;/<span class="name">description</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>dfs.client.failover.proxy.provider.bigdata<span class="tag">&lt;/<span class="name">name</span>&gt;</span>       <span class="tag">&lt;<span class="name">value</span>&gt;</span>org.apache.hadoop.hdfs.server.namenode.ha.ConfiguredFailoverProxyProvider<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">description</span>&gt;</span>配置Java类的名称，DFS客户端将使用该名称来确定哪个NameNode是当前的Active，以及哪个NameNode当前正在为客户端请求提供服务。<span class="tag">&lt;/<span class="name">description</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>dfs.ha.automatic-failover.enabled<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>true<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">description</span>&gt;</span>是否启用自动故障转移。<span class="tag">&lt;/<span class="name">description</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>dfs.replication<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>3<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>dfs.permissions.enabled<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>false<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">description</span>&gt;</span>如果为“true”，则启用HDFS中的权限检查。如果为“false”，则关闭权限检查，但所有其他行为都保持不变。<span class="tag">&lt;/<span class="name">description</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>dfs.journalnode.edits.dir<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>$&#123;hadoop.tmp.dir&#125;/journalnode<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">description</span>&gt;</span>指定JournalNode在本地磁盘存放数据的位置<span class="tag">&lt;/<span class="name">description</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>dfs.namenode.name.dir<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>file://$&#123;hadoop.tmp.dir&#125;/namenode<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">description</span>&gt;</span>设置namenode存放路径<span class="tag">&lt;/<span class="name">description</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>dfs.datanode.data.dir<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>file://$&#123;hadoop.tmp.dir&#125;/datanode<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">description</span>&gt;</span>设置datanode存放径路<span class="tag">&lt;/<span class="name">description</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>dfs.blocksize<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>268435456<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">description</span>&gt;</span>大型文件系统的HDFS块大小为256MB。<span class="tag">&lt;/<span class="name">description</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>dfs.namenode.handler.count<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>100<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">description</span>&gt;</span>namenode的服务器线程数<span class="tag">&lt;/<span class="name">description</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br></pre></td></tr></table></figure><h4 id="3-1-3-mapred-site-xml"><a href="#3-1-3-mapred-site-xml" class="headerlink" title="3.1.3 mapred.site.xml"></a>3.1.3 mapred.site.xml</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version="1.0"?&gt;</span><br><span class="line">&lt;?xml-stylesheet type="text/xsl" href="configuration.xsl"?&gt;</span><br><span class="line"><span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>mapreduce.framework.name<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>yarn<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">description</span>&gt;</span>指定mr框架为yarn方式<span class="tag">&lt;/<span class="name">description</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span>&gt;</span> </span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>mapreduce.map.memory.mb<span class="tag">&lt;/<span class="name">name</span>&gt;</span> </span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>512<span class="tag">&lt;/<span class="name">value</span>&gt;</span> </span><br><span class="line">        <span class="tag">&lt;<span class="name">description</span>&gt;</span>每个Map任务的物理内存限制<span class="tag">&lt;/<span class="name">description</span>&gt;</span> </span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span>&gt;</span> </span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>mapreduce.reduce.memory.mb<span class="tag">&lt;/<span class="name">name</span>&gt;</span> </span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>512<span class="tag">&lt;/<span class="name">value</span>&gt;</span> </span><br><span class="line">        <span class="tag">&lt;<span class="name">description</span>&gt;</span>每个Reduce任务的物理内存限制<span class="tag">&lt;/<span class="name">description</span>&gt;</span> </span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span> </span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>mapreduce.jobhistory.address<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>0.0.0.0:10020<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">description</span>&gt;</span>MapReduce JobHistory服务器IPC主机：端口<span class="tag">&lt;/<span class="name">description</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>mapreduce.jobhistory.webapp.address<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>0.0.0.0:19888<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">description</span>&gt;</span>MapReduce JobHistory服务器Web浏览时的主机：端口<span class="tag">&lt;/<span class="name">description</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>mapreduce.application.classpath<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span></span><br><span class="line">          /home/hadoop/app/hadoop-3.1.2/etc/hadoop,</span><br><span class="line">          /home/hadoop/app/hadoop-3.1.2/share/hadoop/common/*,</span><br><span class="line">          /home/hadoop/app/hadoop-3.1.2/share/hadoop/common/lib/*,</span><br><span class="line">          /home/hadoop/app/hadoop-3.1.2/share/hadoop/hdfs/*,</span><br><span class="line">          /home/hadoop/app/hadoop-3.1.2/share/hadoop/hdfs/lib/*,</span><br><span class="line">          /home/hadoop/app/hadoop-3.1.2/share/hadoop/mapreduce/*,</span><br><span class="line">          /home/hadoop/app/hadoop-3.1.2/share/hadoop/mapreduce/lib/*,</span><br><span class="line">          /home/hadoop/app/hadoop-3.1.2/share/hadoop/yarn/*,</span><br><span class="line">          /home/hadoop/app/hadoop-3.1.2/share/hadoop/yarn/lib/*        </span><br><span class="line">        <span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br></pre></td></tr></table></figure><h4 id="3-1-4-capacity-scheduler-xml"><a href="#3-1-4-capacity-scheduler-xml" class="headerlink" title="3.1.4 capacity-scheduler.xml"></a>3.1.4 capacity-scheduler.xml</h4><h4 id="3-1-5-yarn-site-xml"><a href="#3-1-5-yarn-site-xml" class="headerlink" title="3.1.5 yarn-site.xml"></a>3.1.5 yarn-site.xml</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version="1.0"?&gt;</span><br><span class="line"><span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- Site specific YARN configuration properties--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>yarn.resourcemanager.recovery.enabled<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>true<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">description</span>&gt;</span>启动后启用RM以恢复状态。如果为true，则必须指定yarn.resourcemanager.store.class。<span class="tag">&lt;/<span class="name">description</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>yarn.resourcemanager.store.class<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>org.apache.hadoop.yarn.server.resourcemanager.recovery.ZKRMStateStore<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">description</span>&gt;</span>用作持久存储的类。<span class="tag">&lt;/<span class="name">description</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>yarn.resourcemanager.zk-address<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>centos1:2181,centos2:2181<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">description</span>&gt;</span>ZooKeeper服务的地址，多个地址使用逗号隔开<span class="tag">&lt;/<span class="name">description</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>yarn.resourcemanager.ha.enabled<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>true<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">description</span>&gt;</span>启用RM高可用性。启用时，（1）默认情况下，RM以待机模式启动，并在提示时转换为活动模式。（2）RM集合中的节点列在yarn.resourcemanager.ha.rm-ids中（3）如果明确指定了yarn.resourcemanager.ha.id，则每个RM的id来自yarn.resourcemanager.ha.id或者可以通过匹配yarn.resourcemanager.address。<span class="tag">&lt;/<span class="name">description</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>yarn.resourcemanager.ha.rm-ids<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>rm1,rm2<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">description</span>&gt;</span>启用HA时群集中的RM节点列表。最少2个<span class="tag">&lt;/<span class="name">description</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>yarn.resourcemanager.webapp.address.rm1<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>centos1:8088<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>yarn.resourcemanager.webapp.address.rm2<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>centos2:8088<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>yarn.resourcemanager.cluster-id<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>bd-yarn-ha<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">description</span>&gt;</span>集群HA的id，用于在ZooKeeper上创建节点，区分使用同一个ZooKeeper集群的不同Hadoop集群<span class="tag">&lt;/<span class="name">description</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>yarn.resourcemanager.hostname.rm1<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>centos1<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">description</span>&gt;</span>主机名<span class="tag">&lt;/<span class="name">description</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>yarn.resourcemanager.hostname.rm2<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>centos2<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">description</span>&gt;</span>主机名<span class="tag">&lt;/<span class="name">description</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>yarn.nodemanager.aux-services<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>mapreduce_shuffle<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">description</span>&gt;</span>reducer取数据的方式是mapreduce_shuffle<span class="tag">&lt;/<span class="name">description</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span>&gt;</span>  </span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>yarn.nodemanager.resource.memory-mb<span class="tag">&lt;/<span class="name">name</span>&gt;</span>  </span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>2048<span class="tag">&lt;/<span class="name">value</span>&gt;</span>  </span><br><span class="line">        <span class="tag">&lt;<span class="name">discription</span>&gt;</span>每个节点可用内存,单位MB<span class="tag">&lt;/<span class="name">discription</span>&gt;</span>  </span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span> </span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span>&gt;</span>  </span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>yarn.nodemanager.resource.cpu-vcores<span class="tag">&lt;/<span class="name">name</span>&gt;</span>  </span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>2<span class="tag">&lt;/<span class="name">value</span>&gt;</span>  </span><br><span class="line">        <span class="tag">&lt;<span class="name">discription</span>&gt;</span>每个节点可用cpu<span class="tag">&lt;/<span class="name">discription</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span>   </span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span>&gt;</span>  </span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>yarn.scheduler.minimum-allocation-mb<span class="tag">&lt;/<span class="name">name</span>&gt;</span>  </span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>512<span class="tag">&lt;/<span class="name">value</span>&gt;</span>  </span><br><span class="line">        <span class="tag">&lt;<span class="name">discription</span>&gt;</span>单个任务可申请最少内存，默认1024MB<span class="tag">&lt;/<span class="name">discription</span>&gt;</span>  </span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span>  </span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span>&gt;</span>  </span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>yarn.scheduler.maximum-allocation-mb<span class="tag">&lt;/<span class="name">name</span>&gt;</span>  </span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>1024<span class="tag">&lt;/<span class="name">value</span>&gt;</span>  </span><br><span class="line">        <span class="tag">&lt;<span class="name">discription</span>&gt;</span>单个任务可申请最大内存，默认8192MB<span class="tag">&lt;/<span class="name">discription</span>&gt;</span>  </span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span> </span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span>&gt;</span>  </span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>yarn.scheduler.minimum-allocation-vcores<span class="tag">&lt;/<span class="name">name</span>&gt;</span>  </span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>1<span class="tag">&lt;/<span class="name">value</span>&gt;</span>  </span><br><span class="line">        <span class="tag">&lt;<span class="name">discription</span>&gt;</span>最小的cores 1 个，默认的就是一个<span class="tag">&lt;/<span class="name">discription</span>&gt;</span>  </span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span> </span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span>&gt;</span>  </span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>yarn.scheduler.minimum-allocation-vcores<span class="tag">&lt;/<span class="name">name</span>&gt;</span>  </span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>2<span class="tag">&lt;/<span class="name">value</span>&gt;</span>  </span><br><span class="line">        <span class="tag">&lt;<span class="name">discription</span>&gt;</span>最多可分配的cores 2 个<span class="tag">&lt;/<span class="name">discription</span>&gt;</span>  </span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span> </span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>yarn.nodemanager.pmem-check-enabled<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>false<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>yarn.nodemanager.vmem-check-enabled<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>false<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>yarn.log-aggregation-enable<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>true<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">discription</span>&gt;</span>是否开启聚合日志<span class="tag">&lt;/<span class="name">discription</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>yarn.nodemanager.log-aggregation.roll-monitoring-interval-seconds<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>-1<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">discription</span>&gt;</span>定义NM唤醒上载日志文件的频率。默认值为-1。默认情况下，应用程序完成后将上载日志。通过设置此配置，可以在应用程序运行时定期上载日志。可设置的最小滚动间隔秒数为3600。<span class="tag">&lt;/<span class="name">discription</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>yarn.log.server.url<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>http://c0:19888/jobhistory/logs<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">discription</span>&gt;</span> 配置日志服务器的地址<span class="tag">&lt;/<span class="name">discription</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>yarn.log-aggregation.retain-seconds<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>-1<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">discription</span>&gt;</span> 在删除聚合日志之前保留多长时间。-1禁用。单位是秒<span class="tag">&lt;/<span class="name">discription</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>yarn.nodemanager.log-dirs<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>/home/hadoop/data/hadoop-3.1.2/yarn/container-logs/<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">discription</span>&gt;</span>nodemanager存放container日志的本地路径<span class="tag">&lt;/<span class="name">discription</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>yarn.nodemanager.remote-app-log-dir<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>/tmp/logs<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">discription</span>&gt;</span>nodemanager存放container日志的本地路径<span class="tag">&lt;/<span class="name">discription</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br></pre></td></tr></table></figure><h4 id="3-1-6-hadoop-env-sh"><a href="#3-1-6-hadoop-env-sh" class="headerlink" title="3.1.6 hadoop-env.sh"></a>3.1.6 hadoop-env.sh</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">export</span> JAVA_HOME=/home/richard/.jabba/jdk/adopt@1.8.202-08</span><br><span class="line"></span><br><span class="line">HDFS_DATANODE_USER=hadoop</span><br><span class="line"><span class="comment"># HDFS_DATANODE_SECURE_USER=</span></span><br><span class="line">HDFS_ZKFC_USER=hadoop</span><br><span class="line">HDFS_JOURNALNODE_USER=hadoop</span><br><span class="line">HDFS_NAMENODE_USER=hadoop</span><br><span class="line">HDFS_SECONDARYNAMENODE_USER=hadoop</span><br><span class="line"></span><br><span class="line">YARN_RESOURCEMANAGER_USER=hadoop</span><br><span class="line">YARN_NODEMANAGER_USER=hadoop</span><br></pre></td></tr></table></figure><h4 id="3-1-7-修改workers"><a href="#3-1-7-修改workers" class="headerlink" title="3.1.7 修改workers"></a>3.1.7 修改workers</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ vim /home/hadoop/app/hadoop-3.1.2/etc/hadoop/workers</span><br><span class="line">centos3</span><br><span class="line">centos4</span><br></pre></td></tr></table></figure><h3 id="3-2-启动Hadoop"><a href="#3-2-启动Hadoop" class="headerlink" title="3.2 启动Hadoop"></a>3.2 启动Hadoop</h3><h4 id="3-2-1-启动JournalNode集群"><a href="#3-2-1-启动JournalNode集群" class="headerlink" title="3.2.1 启动JournalNode集群"></a>3.2.1 启动JournalNode集群</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="keyword">for</span> N <span class="keyword">in</span> $(seq 1 4); <span class="keyword">do</span> ssh centos<span class="variable">$N</span> hdfs --daemon start journalnode;jps; <span class="keyword">done</span>;</span><br></pre></td></tr></table></figure><h4 id="3-2-2-格式化NameNode"><a href="#3-2-2-格式化NameNode" class="headerlink" title="3.2.2 格式化NameNode"></a>3.2.2 格式化NameNode</h4><p>在centos1上</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hdfs namenode -format</span><br></pre></td></tr></table></figure><h4 id="3-2-3-启动zookeeper故障转移控制器，格式化zookeeper"><a href="#3-2-3-启动zookeeper故障转移控制器，格式化zookeeper" class="headerlink" title="3.2.3 启动zookeeper故障转移控制器，格式化zookeeper"></a>3.2.3 启动zookeeper故障转移控制器，格式化zookeeper</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ hdfs zkfc -formatZK</span><br><span class="line"><span class="comment"># check if zkfc success, whill see hadoop-ha at ls /</span></span><br><span class="line">$ zkCli.sh</span><br><span class="line">ls /</span><br><span class="line">[zookper, hadoop-ha]</span><br></pre></td></tr></table></figure><h4 id="3-2-4-启动NameNode"><a href="#3-2-4-启动NameNode" class="headerlink" title="3.2.4 启动NameNode"></a>3.2.4 启动NameNode</h4><p>在centos1上</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">$ hdfs --daemon start namenode</span><br><span class="line"><span class="comment"># run at centos2 to copy namenode to backup</span></span><br><span class="line">$ hdfs namenode -bootstrapStandby</span><br><span class="line">$ hdfs --daemon start namenode</span><br><span class="line"><span class="comment"># start hdfs at centos1</span></span><br><span class="line">$ sbin/start-dfs.sh</span><br><span class="line"><span class="comment"># check status</span></span><br><span class="line">$ hdfs haadmin --getAllServiceState</span><br><span class="line"><span class="comment"># start YARN from centos1</span></span><br><span class="line">$ sbin/start-yarn.sh</span><br></pre></td></tr></table></figure><h4 id="3-2-5-验证高可用性"><a href="#3-2-5-验证高可用性" class="headerlink" title="3.2.5 验证高可用性"></a>3.2.5 验证高可用性</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">[centos1]$ hdfs haadmin -getAllServiceState</span><br><span class="line">centos1:8020standby</span><br><span class="line">centos2:8020active</span><br><span class="line"><span class="comment"># kill namenode from centos2</span></span><br><span class="line">[centos2]$ jps</span><br><span class="line">11954 NameNode</span><br><span class="line">[centos2]$ <span class="built_in">kill</span> -9 11954</span><br><span class="line">[centos1]$ hdfs haadmin -getAllServiceState</span><br><span class="line">centos1:8020active</span><br><span class="line">centos2:8020failed to connect...</span><br></pre></td></tr></table></figure><h2 id="4-安装Spark-2-4-1"><a href="#4-安装Spark-2-4-1" class="headerlink" title="4. 安装Spark 2.4.1"></a>4. 安装Spark 2.4.1</h2><h3 id="4-1-编辑spark-env-sh"><a href="#4-1-编辑spark-env-sh" class="headerlink" title="4.1 编辑spark-env.sh"></a>4.1 编辑spark-env.sh</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">$ vim conf/spark-env.sh</span><br><span class="line"><span class="built_in">export</span> SPARK_DAEMON_JAVA_OPTS=<span class="string">"-Dspark.deploy.recoveryMode=ZOOKEEPER -Dspark.deploy.zookeeper.url=ccentos1:2181,centos2:2181,centos3:2181,centos4:2181 -Dspark.deploy.zookeeper.dir=/spark-2.4.1"</span></span><br><span class="line"><span class="built_in">export</span> SPARK_LOG_DIR=/home/hadoop/logs/spark-2.4.0-bin-hadoop2.7</span><br><span class="line"></span><br><span class="line"><span class="comment"># Spark Work内存使用量</span></span><br><span class="line"><span class="built_in">export</span> SPARK_WORKER_MEMORY=512M</span><br><span class="line"></span><br><span class="line"><span class="comment"># 该参数决定了yarn集群中，最多能够同时启动的EXECUTOR的实例个数。</span></span><br><span class="line"><span class="built_in">export</span> SPARK_EXECUTOR_INSTANCES=3</span><br><span class="line"></span><br><span class="line"><span class="comment"># 设置每个EXECUTOR能够使用的CPU core的数量。</span></span><br><span class="line"><span class="built_in">export</span> SPARK_EXECUTOR_CORES=3</span><br><span class="line"></span><br><span class="line"><span class="comment"># 该参数设置的是每个EXECUTOR分配的内存的数量</span></span><br><span class="line"><span class="built_in">export</span> SPARK_EXECUTOR_MEMORY=512M</span><br><span class="line"></span><br><span class="line"><span class="comment">#该参数设置的是DRIVER分配的内存的大小</span></span><br><span class="line"><span class="built_in">export</span> SPARK_DRIVER_MEMORY=1G</span><br><span class="line"></span><br><span class="line"><span class="comment"># Spark Application在Yarn中的名字</span></span><br><span class="line"><span class="built_in">export</span> SPARK_YARN_APP_NAME=<span class="string">"lion.Spark-2.4.1"</span></span><br></pre></td></tr></table></figure><h3 id="4-2-编辑spark-defaults-conf"><a href="#4-2-编辑spark-defaults-conf" class="headerlink" title="4.2 编辑spark-defaults.conf"></a>4.2 编辑spark-defaults.conf</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">$ vim conf/spark-defaults.conf</span><br><span class="line"><span class="comment"># 如果没有适合当前本地性要求的任务可供运行，将跑得慢的任务在空闲计算资源上再度调度的行为,这个参数会引发一些tmp文件被删除的问题，一般设置为false</span></span><br><span class="line">spark.speculation        <span class="literal">false</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 如果设置为true,前台用jdbc方式连接，显示的会是乱码</span></span><br><span class="line">spark.sql.hive.convertMetastoreParquet  <span class="literal">false</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 应用程序上载到HDFS的复制份数</span></span><br><span class="line">spark.yarn.submit.file.replication 3</span><br><span class="line"></span><br><span class="line"><span class="comment"># Spark application master给YARN ResourceManager 发送心跳的时间间隔（ms）</span></span><br><span class="line">spark.yarn.scheduler.heartbeat.interal-ms  5000</span><br><span class="line"></span><br><span class="line"><span class="comment"># 仅适用于HashShuffleMananger的实现，同样是为了解决生成过多文件的问题，采用的方式是在不同批次运行的Map任务之间重用Shuffle输出文件，也就是说合并的是不同批次的Map任务的输出数据，但是每个Map任务所需要的文件还是取决于Reduce分区的数量，因此，它并不减少同时打开的输出文件的数量，因此对内存使用量的减少并没有帮助。只是HashShuffleManager里的一个折中的解决方案。</span></span><br><span class="line">spark.shuffle.consolidateFiles  <span class="literal">true</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 一个partition对应着一个task,如果数据量过大，可以调整次参数来减少每个task所需消耗的内存.</span></span><br><span class="line">spark.sql.shuffle.partitions 100</span><br><span class="line"></span><br><span class="line"><span class="comment"># Spark SQL在每次执行次，先把SQL查询编译JAVA字节码。针对执行时间长的SQL查询或频繁执行的SQL查询，此配置能加快查询速度，因为它产生特殊的字节码去执行。但是针对很短的查询，可能会增加开销，因为它必须先编译每一个查询</span></span><br><span class="line">spark.sql.codegen <span class="literal">true</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 我们都知道shuffle默认情况下的文件数据为map tasks * reduce tasks,通过设置其为true,可以使spark合并shuffle的中间文件为reduce的tasks数目。</span></span><br><span class="line">spark.shuffle.consolidateFiles <span class="literal">true</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 是否记录Spark事件，对于在应用程序完成后重建Web UI非常有用。</span></span><br><span class="line">spark.eventLog.enabled <span class="literal">true</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 是否压缩已记录的事件，如果spark.eventLog.enabled为true。压缩将使用spark.io.compression.codec。</span></span><br><span class="line">spark.eventLog.compress <span class="literal">true</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 如果spark.eventLog.enabled为true，则记录Spark事件的基目录。在此基本目录中，Spark为每个应用程序创建一个子目录，并将特定于该应用程序的事件记录在此目录中。用户可能希望将其设置为统一位置（如HDFS目录），以便历史记录服务器可以读取历史记录文件。</span></span><br><span class="line">spark.eventLog.dir hdfs://bigdata:8020/tmp/logs/spark_logs</span><br></pre></td></tr></table></figure><h3 id="4-3-编辑slaves"><a href="#4-3-编辑slaves" class="headerlink" title="4.3 编辑slaves"></a>4.3 编辑slaves</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ vim conf/slaves</span><br><span class="line">centos3</span><br><span class="line">centos4</span><br></pre></td></tr></table></figure><h3 id="4-4-启动集群"><a href="#4-4-启动集群" class="headerlink" title="4.4 启动集群"></a>4.4 启动集群</h3><p>复制spark到其它节点。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># start master and workers from centos1</span></span><br><span class="line">[centos1] $ sbin/start-all.sh</span><br><span class="line">[centos2] $ sbin/start-master.sh</span><br><span class="line"><span class="comment"># test </span></span><br><span class="line">[centos1] $ bin/spark-shell</span><br><span class="line"><span class="comment"># test cluster</span></span><br><span class="line">[centos1] $ bin/spark-shell --master yarn --deploy-mode client</span><br></pre></td></tr></table></figure><h2 id="5-安装HBase-2-0-5"><a href="#5-安装HBase-2-0-5" class="headerlink" title="5. 安装HBase 2.0.5"></a>5. 安装HBase 2.0.5</h2><h3 id="5-1-修改hbase-site-xml"><a href="#5-1-修改hbase-site-xml" class="headerlink" title="5.1 修改hbase-site.xml"></a>5.1 修改hbase-site.xml</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>hbase.rootdir<span class="tag">&lt;/<span class="name">name</span>&gt;</span> <span class="comment">&lt;!-- hbase存放数据目录 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>hdfs://bigdata:8020/hbase/hbase_db<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">description</span>&gt;</span>端口要和Hadoop的fs.defaultFS端口一致<span class="tag">&lt;/<span class="name">description</span>&gt;</span></span><br><span class="line">　　<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">　　<span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">　　　　<span class="tag">&lt;<span class="name">name</span>&gt;</span>hbase.cluster.distributed<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">　　　　<span class="tag">&lt;<span class="name">value</span>&gt;</span>true<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">description</span>&gt;</span>集群将处于的模式。可能的值是对于独立模式为false，对于分布式模式为true<span class="tag">&lt;/<span class="name">description</span>&gt;</span></span><br><span class="line">　　<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">　　<span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">　　　　<span class="tag">&lt;<span class="name">name</span>&gt;</span>hbase.zookeeper.quorum<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">　　　　<span class="tag">&lt;<span class="name">value</span>&gt;</span>centos1,centos2<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">description</span>&gt;</span>逗号分隔的ZooKeeper集合中的服务器列表个<span class="tag">&lt;/<span class="name">description</span>&gt;</span></span><br><span class="line">　　<span class="tag">&lt;/<span class="name">property</span>&gt;</span> 　　　</span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>hbase.zookeeper.property.dataDir<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>/home/hadoop/data/hbase-2.0.5<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">description</span>&gt;</span>zookooper配置、日志等的存储位置，必须为以存在<span class="tag">&lt;/<span class="name">description</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>hbase.master.port<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>16000<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">description</span>&gt;</span>HBase Master应绑定的端口<span class="tag">&lt;/<span class="name">description</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>hbase.master.info.port<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>16010<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">description</span>&gt;</span>hbase web 端口<span class="tag">&lt;/<span class="name">description</span>&gt;</span></span><br><span class="line">　　<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">　　<span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>hbase.unsafe.stream.capability.enforce<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>false<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>hbase.wal.provider<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>filesystem<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="5-2-编辑hbase-env-sh"><a href="#5-2-编辑hbase-env-sh" class="headerlink" title="5.2 编辑hbase-env.sh"></a>5.2 编辑hbase-env.sh</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">export</span> JAVA_HOME=/home/hadoop/.jabba/jdk/adopt@1.8.202-08</span><br><span class="line"></span><br><span class="line">$ <span class="built_in">export</span> HBASE_CLASSPATH=/home/hadoop/app/hadoop-3.1.2/etc/hadoop</span><br><span class="line"></span><br><span class="line">$ <span class="built_in">export</span> HBASE_OPTS=<span class="string">"<span class="variable">$HBASE_OPTS</span> -XX:+UseConcMarkSweepGC"</span></span><br><span class="line"></span><br><span class="line">$ <span class="built_in">export</span> HBASE_LOG_DIR=/home/hadoop/logs/hbase-2.1.4</span><br><span class="line"><span class="comment"># zookeeper is not managed by hbase.</span></span><br><span class="line">$ <span class="built_in">export</span> HBASE_MANAGES_ZK=<span class="literal">false</span></span><br></pre></td></tr></table></figure><h3 id="5-3-编辑slaves"><a href="#5-3-编辑slaves" class="headerlink" title="5.3 编辑slaves"></a>5.3 编辑slaves</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ vim conf/regionservers</span><br><span class="line">centos3</span><br><span class="line">centos4</span><br></pre></td></tr></table></figure><h3 id="5-4-启动集群"><a href="#5-4-启动集群" class="headerlink" title="5.4 启动集群"></a>5.4 启动集群</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># start HMaster and all HRigeonServers</span></span><br><span class="line">[centos1] $ bin/start-hbase.sh</span><br><span class="line"><span class="comment"># start backup HMaster</span></span><br><span class="line">[centos2] $ bin/start-hbase.sh</span><br><span class="line"><span class="comment"># test at centos1</span></span><br><span class="line">[centos1] <span class="comment"># bin/hbase shell</span></span><br><span class="line">&gt;list</span><br><span class="line">&gt;version</span><br><span class="line">&gt;quit</span><br></pre></td></tr></table></figure><h2 id="6-安装Phoenix-5-0-0-HBase-2-0"><a href="#6-安装Phoenix-5-0-0-HBase-2-0" class="headerlink" title="6. 安装Phoenix_5.0.0_HBase_2.0"></a>6. 安装Phoenix_5.0.0_HBase_2.0</h2><h3 id="6-1-设置jars"><a href="#6-1-设置jars" class="headerlink" title="6.1 设置jars"></a>6.1 设置jars</h3><p>拷贝Phoenix目录下的phoenix-core-5.0.0-HBase-2.0.jar, phoenix-5.0.0-HBase-2.0-server.jar到Hbase Server的lib目录下，将phoenix-5.0.0-HBase-2.0-client.jar拷贝到客户端。</p><h3 id="6-2-在bin目录下创建hadoop-core-site-xml-hdfs-site-xml以及hbase-site-xml的符号连接"><a href="#6-2-在bin目录下创建hadoop-core-site-xml-hdfs-site-xml以及hbase-site-xml的符号连接" class="headerlink" title="6.2 在bin目录下创建hadoop core-site.xml hdfs-site.xml以及hbase-site.xml的符号连接"></a>6.2 在bin目录下创建hadoop core-site.xml hdfs-site.xml以及hbase-site.xml的符号连接</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">cd</span> <span class="variable">$PHOENIX_HOME</span>/bin</span><br><span class="line">$ ln -s /home/hadoop/app/hadoop-3.1.2/etc/hadoop/core-site.xml ./core-site.xml</span><br><span class="line">$ ln -s /home/hadoop/app/hadoop-3.1.2/etc/hadoop/hdfs-site.xml ./hdfs-site.xml</span><br><span class="line">$ ln -s /home/hadop/app/hbase-2.0.5/conf/hbase-site.xml ./hbase-site.xml</span><br></pre></td></tr></table></figure><h3 id="6-3-重新启动HBase集群，并测试phoenix"><a href="#6-3-重新启动HBase集群，并测试phoenix" class="headerlink" title="6.3 重新启动HBase集群，并测试phoenix"></a>6.3 重新启动HBase集群，并测试phoenix</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ bin/sqlline.py centos1,centos2:2181</span><br><span class="line">&gt; !tables</span><br><span class="line">&gt; !<span class="built_in">exit</span></span><br><span class="line"><span class="comment"># create table and import data from csv</span></span><br><span class="line">$ bin/psql.py centos1,centos2:2181 create_table.sql table_data.csv table_query.sql</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;本文记录梳理一下手动布署hadoop集群具体步骤，在相互兼容的基础上，选择了目前为止各个组件的最新版。所以请不要询问为什么是这几个版本，因为作者已经花了大量的时间尝试过。&lt;/p&gt;
    
    </summary>
    
      <category term="计算机技术" scheme="https://autumntail.github.io/categories/%E8%AE%A1%E7%AE%97%E6%9C%BA%E6%8A%80%E6%9C%AF/"/>
    
    
      <category term="BigData" scheme="https://autumntail.github.io/tags/BigData/"/>
    
      <category term="Hadoop" scheme="https://autumntail.github.io/tags/Hadoop/"/>
    
  </entry>
  
  <entry>
    <title>Angular 7 新特性</title>
    <link href="https://autumntail.github.io/2018/10/14/Angular-7-%E6%96%B0%E7%89%B9%E6%80%A7/"/>
    <id>https://autumntail.github.io/2018/10/14/Angular-7-新特性/</id>
    <published>2018-10-14T13:56:46.000Z</published>
    <updated>2018-10-15T05:20:23.881Z</updated>
    
    <content type="html"><![CDATA[<p>Angular 7已经进入RC了，马上就要release了。都有哪些值得期待的新特性呢？</p><a id="more"></a><ol><li><p>通过自动添加或移除 <a href="https://www.jianshu.com/p/653bce04db0b" target="_blank" rel="noopener">Reflect Metadata</a>，可以使程序更小，性能更好。</p></li><li><p>由于Angular默认为前端路由，单页面应用，因此程序首次加载后偏慢。因此Angular 7默认编译后的主程序超过2MB会警告，超过5MB会报错。</p></li><li><p>CLI功能增强，更多交互，帮助用户利用CLI创建合适的组件。</p></li><li><p>支持TypeScript 2.9+。</p></li><li><p>Material Design 2018动态加载，提升性能。</p></li></ol><p>… …</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;Angular 7已经进入RC了，马上就要release了。都有哪些值得期待的新特性呢？&lt;/p&gt;
    
    </summary>
    
      <category term="计算机技术" scheme="https://autumntail.github.io/categories/%E8%AE%A1%E7%AE%97%E6%9C%BA%E6%8A%80%E6%9C%AF/"/>
    
    
      <category term="前端" scheme="https://autumntail.github.io/tags/%E5%89%8D%E7%AB%AF/"/>
    
      <category term="Angular" scheme="https://autumntail.github.io/tags/Angular/"/>
    
  </entry>
  
  <entry>
    <title>大白话解析模拟退火算法</title>
    <link href="https://autumntail.github.io/2018/09/20/%E5%A4%A7%E7%99%BD%E8%AF%9D%E8%A7%A3%E6%9E%90%E6%A8%A1%E6%8B%9F%E9%80%80%E7%81%AB%E7%AE%97%E6%B3%95/"/>
    <id>https://autumntail.github.io/2018/09/20/大白话解析模拟退火算法/</id>
    <published>2018-09-21T04:27:44.000Z</published>
    <updated>2018-09-21T05:00:21.075Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>兔子喝醉了。它随机地跳了很长时间。这期间，它可能走向高处，也可能踏入平地。但是，它渐渐清醒了并朝最高方向跳去。这就是模拟退火。<br>Reference: <a href="http://www.cnblogs.com/heaad/" target="_blank" rel="noopener">http://www.cnblogs.com/heaad/</a></p></blockquote><p>系里host一个Big Data的国际会议，俺也被叫去打杂：审几篇计算机相关的稿子。其中一篇讲的是咋能更好地在组织内实施Agile开发（如何更加高效的“压榨”程序员？^-^）。顺便俺也回忆一下大学计算机老师讲的一些算法。</p><a id="more"></a><p>这篇《大白话模拟退火算法》，讲得真挺白话，俺一下子就看懂了，嘿嘿。转过来留个记录。</p><h2 id="一-爬山算法-Hill-Climbing"><a href="#一-爬山算法-Hill-Climbing" class="headerlink" title="一. 爬山算法 ( Hill Climbing )"></a>一. 爬山算法 ( Hill Climbing )</h2><p>介绍模拟退火前，先介绍爬山算法。爬山算法是一种简单的贪心搜索算法，该算法每次从当前解的临近解空间中选择一个最优解作为当前解，直到达到一个局部最优解。</p><p>爬山算法实现很简单，其主要缺点是会陷入局部最优解，而不一定能搜索到全局最优解。如图1所示：假设C点为当前解，爬山算法搜索到A点这个局部最优解就会停止搜索，因为在A点无论向那个方向小幅度移动都不能得到更优的解。</p><p><img src="https://pic002.cnblogs.com/images/2010/63234/2010122016525713.png" alt="图1"> </p><h2 id="二-模拟退火-SA-Simulated-Annealing-思想"><a href="#二-模拟退火-SA-Simulated-Annealing-思想" class="headerlink" title="二. 模拟退火(SA,Simulated Annealing)思想"></a>二. 模拟退火(SA,Simulated Annealing)思想</h2><p>爬山法是完完全全的贪心法，每次都鼠目寸光的选择一个当前最优解，因此只能搜索到局部的最优值。模拟退火其实也是一种贪心算法，但是它的搜索过程引入了随机因素。模拟退火算法<strong>以一定的概率</strong>来接受一个比当前解要差的解，因此<strong>有可能</strong>会跳出这个局部的最优解，达到全局的最优解。以图1为例，模拟退火算法在搜索到局部最优解A后，会<strong>以一定的概率</strong>接受到E的移动。也许经过几次这样的不是局部最优的移动后会到达D点，于是就跳出了局部最大值A。</p><h3 id="模拟退火算法描述："><a href="#模拟退火算法描述：" class="headerlink" title="模拟退火算法描述："></a>模拟退火算法描述：</h3><p>若J( Y(i+1) )&gt;= J( Y(i) )  (即移动后得到更优解)，则总是接受该移动</p><p>若J( Y(i+1) )&lt; J( Y(i) )  (即移动后的解比当前解要差)，则<strong>以一定的概率接受移动，而且这个概率随着时间推移逐渐降低（逐渐降低才能趋向稳定）</strong></p><p>这里的“一定的概率”的计算参考了金属冶炼的退火过程，这也是模拟退火算法名称的由来。</p><p>根据热力学的原理，在温度为T时，出现能量差为dE的降温的概率为P(dE)，表示为：</p><p>　　　　P(dE) = exp( dE/(kT) )</p><p>其中k是一个常数，exp表示自然指数，且dE&lt;0。这条公式说白了就是：温度越高，出现一次能量差为dE的降温的概率就越大；温度越低，则出现降温的概率就越小。又由于dE总是小于0（否则就不叫退火了），因此dE/kT &lt; 0 ，所以P(dE)的函数取值范围是(0,1) 。</p><p>随着温度T的降低，P(dE)会逐渐降低。</p><p>我们将一次向较差解的移动看做一次温度跳变过程，我们以概率P(dE)来接受这样的移动。</p><p>关于爬山算法与模拟退火，有一个有趣的比喻：</p><p><strong>爬山算法</strong>：兔子朝着比现在高的地方跳去。它找到了不远处的最高山峰。但是这座山不一定是珠穆朗玛峰。这就是爬山算法，它不能保证局部最优值就是全局最优值。</p><p><strong>模拟退火</strong>：兔子喝醉了。它随机地跳了很长时间。这期间，它可能走向高处，也可能踏入平地。但是，它渐渐清醒了并朝最高方向跳去。这就是模拟退火。</p><p>下面给出模拟退火的伪代码表示。</p><h2 id="三-模拟退火算法伪代码"><a href="#三-模拟退火算法伪代码" class="headerlink" title="三. 模拟退火算法伪代码"></a>三. 模拟退火算法伪代码</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">/*</span><br><span class="line">* J(y)：在状态y时的评价函数值</span><br><span class="line">* Y(i)：表示当前状态</span><br><span class="line">* Y(i+1)：表示新的状态</span><br><span class="line">* r： 用于控制降温的快慢</span><br><span class="line">* T： 系统的温度，系统初始应该要处于一个高温的状态</span><br><span class="line">* T_min ：温度的下限，若温度T达到T_min，则停止搜索</span><br><span class="line">*/</span><br><span class="line">while( T &gt; T_min )</span><br><span class="line">&#123;</span><br><span class="line">　　dE = J( Y(i+1) ) - J( Y(i) ) ; </span><br><span class="line"></span><br><span class="line">　　if ( dE &gt;=0 ) &#123;//表达移动后得到更优解，则总是接受移动</span><br><span class="line">Y(i+1) = Y(i) ; //接受从Y(i)到Y(i+1)的移动</span><br><span class="line">&#125; else &#123;</span><br><span class="line">        // 函数exp( dE/T )的取值范围是(0,1) ，dE/T越大，则exp( dE/T )也</span><br><span class="line">        if ( exp( dE/T ) &gt; random( 0 , 1 ) )</span><br><span class="line">        Y(i+1) = Y(i) ; //接受从Y(i)到Y(i+1)的移动</span><br><span class="line">　　&#125;</span><br><span class="line">　　T = r * T ; //降温退火 ，0&lt;r&lt;1 。r越大，降温越慢；r越小，降温越快</span><br><span class="line">　　/*</span><br><span class="line">　　* 若r过大，则搜索到全局最优解的可能会较高，但搜索的过程也就较长。若r过小，则搜索的过程会很快，但最终可能会达到一个局部最优值</span><br><span class="line">　　*/</span><br><span class="line">　　i ++ ;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="四-使用模拟退火算法解决旅行商问题"><a href="#四-使用模拟退火算法解决旅行商问题" class="headerlink" title="四. 使用模拟退火算法解决旅行商问题"></a>四. 使用模拟退火算法解决旅行商问题</h2><p>旅行商问题 ( TSP , Traveling Salesman Problem ) ：有N个城市，要求从其中某个问题出发，唯一遍历所有城市，再回到出发的城市，求最短的路线。</p><p>旅行商问题属于所谓的NP完全问题，精确的解决TSP只能通过穷举所有的路径组合，其时间复杂度是O(N!) 。</p><p>使用模拟退火算法可以比较快的求出TSP的一条近似最优路径。（使用遗传算法也是可以的，我将在下一篇文章中介绍）模拟退火解决TSP的思路：</p><ol><li><p>产生一条新的遍历路径P(i+1)，计算路径P(i+1)的长度L( P(i+1) )</p></li><li><p>若L(P(i+1)) &lt; L(P(i))，则接受P(i+1)为新的路径，否则以模拟退火的那个概率接受P(i+1) ，然后降温</p></li><li><p>重复步骤1，2直到满足退出条件</p></li></ol><p>产生新的遍历路径的方法有很多，下面列举其中3种：</p><ol><li><p>随机选择2个节点，交换路径中的这2个节点的顺序。</p></li><li><p>随机选择2个节点，将路径中这2个节点间的节点顺序逆转。</p></li><li><p>随机选择3个节点m，n，k，然后将节点m与n间的节点移位到节点k后面。</p></li></ol><h2 id="五-算法评价"><a href="#五-算法评价" class="headerlink" title="五. 算法评价"></a>五. 算法评价</h2><p>模拟退火算法是一种随机算法，并不一定能找到全局的最优解，可以比较快的找到问题的近似最优解。 如果参数设置得当，模拟退火算法搜索效率比穷举法要高。</p>]]></content>
    
    <summary type="html">
    
      &lt;blockquote&gt;
&lt;p&gt;兔子喝醉了。它随机地跳了很长时间。这期间，它可能走向高处，也可能踏入平地。但是，它渐渐清醒了并朝最高方向跳去。这就是模拟退火。&lt;br&gt;Reference: &lt;a href=&quot;http://www.cnblogs.com/heaad/&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;http://www.cnblogs.com/heaad/&lt;/a&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;系里host一个Big Data的国际会议，俺也被叫去打杂：审几篇计算机相关的稿子。其中一篇讲的是咋能更好地在组织内实施Agile开发（如何更加高效的“压榨”程序员？^-^）。顺便俺也回忆一下大学计算机老师讲的一些算法。&lt;/p&gt;
    
    </summary>
    
      <category term="计算机技术" scheme="https://autumntail.github.io/categories/%E8%AE%A1%E7%AE%97%E6%9C%BA%E6%8A%80%E6%9C%AF/"/>
    
    
      <category term="算法" scheme="https://autumntail.github.io/tags/%E7%AE%97%E6%B3%95/"/>
    
  </entry>
  
  <entry>
    <title>维修墙内水管</title>
    <link href="https://autumntail.github.io/2018/02/26/%E7%BB%B4%E4%BF%AE%E5%A2%99%E5%86%85%E6%B0%B4%E7%AE%A1/"/>
    <id>https://autumntail.github.io/2018/02/26/维修墙内水管/</id>
    <published>2018-02-26T18:26:43.000Z</published>
    <updated>2018-09-01T06:37:22.478Z</updated>
    
    <content type="html"><![CDATA[<p>“全球变暖”这一命题发展到现在，有了新的含义：异常天气增多，气候出现剧烈波动。对咱休斯敦来说，那就是，哈维来袭，冬天冰冻。</p><a id="more"></a><p>俺家的墙内水管，不幸的在去年的某一个时刻中了个小招：铜管跟CPVC水管连接处的CPVC转接头裂了个小缝，水就开始一滴滴慢慢的落在墙里，湿润了保温棉，饱合了临近的木头，腐烂了baseboard，最后，泡涨了最外面的地板… …直到有一天，小女儿好奇的问，为啥这块地板不一样？</p><h2 id="开墙"><a href="#开墙" class="headerlink" title="开墙"></a>开墙</h2><p>俺推开钢琴，移开书架，发现了惨不忍睹的现场。欲哭无泪啊，赶紧拆、拆、拆。拆开墙，找到了罪魁祸首，真还不如水管直接破了呢，至少可以马上发现问题，及时维修。</p><p><img src="http://upload-images.jianshu.io/upload_images/5067306-43e8c2a845ae61e5.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="leaking-pipe.jpg"></p><h2 id="修水管"><a href="#修水管" class="headerlink" title="修水管"></a>修水管</h2><p>找到漏水的位置，根据不同情况，维修的方法不一。俺的因为是铜管跟CPVC管的连接处，需要换掉连接处的接头。接头是这样的。</p><p><img src="http://upload-images.jianshu.io/upload_images/5067306-79dde7a7c275ef4f.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="genova-products-couplings-adaptors-57607s-64_1000.jpg"></p><p>先去<strong>关掉进水的阀门</strong>，才能进行下一步。</p><p>要拧下旧接头，需要先切断CPVC的部分，然后用两个wrench朝相反方向拧，不然可能弄坏铁管。俺的这个接头年头已久，拧不下来，最后用了一个socket，加1/2’’的socket wrench才弄下来。</p><p><img src="http://upload-images.jianshu.io/upload_images/5067306-d6c0fb42de70737a.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="IMG_20180209_213927.jpg"></p><p>然后用pipe compound拧上新的接头，用胶水粘上新的CPVC管子。</p><p><img src="http://upload-images.jianshu.io/upload_images/5067306-68dfa476d7c663fb.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="IMG_20180210_081128.jpg"></p><h2 id="除湿，杀霉菌"><a href="#除湿，杀霉菌" class="headerlink" title="除湿，杀霉菌"></a>除湿，杀霉菌</h2><p>管子修好，在补墙前，要先去除墙内的湿气。等湿气去了，木头都干了，可以刷层mold free的primer，这样即可以杀掉木头里的霉菌，又可以保护木头。</p><p><img src="http://upload-images.jianshu.io/upload_images/5067306-224b928e08b88c62.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="IMG_20180214_203232.jpg"></p><p>俺的木板因为泡的时间太久，有些腐烂。俺又新加了几块板固定。</p><p><img src="http://upload-images.jianshu.io/upload_images/5067306-ff4733dc2889ff69.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="wx_camera_1519081498289.jpg"></p><p>然后，把保温棉放回去，把管子包起来。</p><p><img src="http://upload-images.jianshu.io/upload_images/5067306-2cda4dc36952c156.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="wx_camera_1519083131836.jpg"></p><h2 id="补墙"><a href="#补墙" class="headerlink" title="补墙"></a>补墙</h2><p>把厚度合适的drywall切成需要的尺寸，钉到开好的洞上。</p><p><img src="http://upload-images.jianshu.io/upload_images/5067306-5c63ad86f1224376.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="IMG_20180219_185827.jpg"></p><p>全钉好后，用drywall compund抹平。</p><p><img src="http://upload-images.jianshu.io/upload_images/5067306-548d1855f5c737c3.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="IMG_20180221_234320.jpg"></p><p>磨平，喷上纹理。</p><p><img src="http://upload-images.jianshu.io/upload_images/5067306-536a2027e7cff031.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="IMG_20180223_140256.jpg"></p><h2 id="刷漆"><a href="#刷漆" class="headerlink" title="刷漆"></a>刷漆</h2><p>拿着样本去店里配同样颜色的漆，或者家里有现成的最好。用刷子或者滚子把漆刷上去，等干了后，基本就恢复原样了。</p><p><img src="http://upload-images.jianshu.io/upload_images/5067306-4fb77f15bc9b0fac.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="IMG_20180224_195129.jpg"></p><h2 id="工具"><a href="#工具" class="headerlink" title="工具"></a>工具</h2><p>俺用到了下面这些工具，给大家参考下。</p><p><img src="http://upload-images.jianshu.io/upload_images/5067306-be97e5f7e7faf952.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="tools-list.png"></p><h2 id="未完的故事"><a href="#未完的故事" class="headerlink" title="未完的故事"></a>未完的故事</h2><p>俺的地板也被泡了一部分，只能换掉了，那又是另外一个很长的故事了。</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;“全球变暖”这一命题发展到现在，有了新的含义：异常天气增多，气候出现剧烈波动。对咱休斯敦来说，那就是，哈维来袭，冬天冰冻。&lt;/p&gt;
    
    </summary>
    
      <category term="生活DIY" scheme="https://autumntail.github.io/categories/%E7%94%9F%E6%B4%BBDIY/"/>
    
    
      <category term="木工" scheme="https://autumntail.github.io/tags/%E6%9C%A8%E5%B7%A5/"/>
    
      <category term="水" scheme="https://autumntail.github.io/tags/%E6%B0%B4/"/>
    
      <category term="建筑" scheme="https://autumntail.github.io/tags/%E5%BB%BA%E7%AD%91/"/>
    
  </entry>
  
  <entry>
    <title>善用Markdown,轻松写文章</title>
    <link href="https://autumntail.github.io/2018/02/14/%E5%96%84%E7%94%A8Markdown-%E8%BD%BB%E6%9D%BE%E5%86%99%E6%96%87%E7%AB%A0/"/>
    <id>https://autumntail.github.io/2018/02/14/善用Markdown-轻松写文章/</id>
    <published>2018-02-14T18:24:39.000Z</published>
    <updated>2018-09-01T06:37:22.475Z</updated>
    
    <content type="html"><![CDATA[<p>自从有了微博，微信，简书等各种在线平台，自媒体如雨后春笋般，漫山遍野的发芽、生长。但是各个平台，文章发布有自己的工具，格式各不相同，对于咱这种半调子技术，又想在多个平台分享自己的想法，心得的个人，怎么才能简单的写文章，然后发布成一样的格式呢？</p><a id="more"></a><h2 id="真命天子MarkDown"><a href="#真命天子MarkDown" class="headerlink" title="真命天子MarkDown"></a>真命天子MarkDown</h2><p>俺经过一番调查研究，发现目前非常流行的文本格式Markdown非常适合咱小白使用。</p><p>Markdown类似于HTML，Latex，是一种格式化文本，用一些特殊的符号表示文章的不同部分。比如，标题用#表示，可以用1-6个#号表示后面的文字是1至6级标题；*包围号表示加粗强读；>表示引用；前置*号表示无序列表，数字表示有序列表。</p><p><img src="http://upload-images.jianshu.io/upload_images/5067306-91c22ff537ba6213.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p><p>有人总结了几句顺口溜，帮助大家记住常用的语法（不过俺觉的语法其实非常简单了，不大需要记）。</p><blockquote><p>井号代表是标题<br>一个六个随你意<br>星号表示要强调<br>一斜二粗三合体<br>加减都可设列表<br>后面空格别忘记<br>“&gt;”表示要引用<br>回车一行算另起<br>还有中小俩括号<br>超级链接很容易</p></blockquote><p>有了Markdown，咱就可以借助各种编辑器（比如简书，MPEditor,atom, sublime, Ulysses, Typora等），编写好markdown文本，然后利用Markdown Here插件来实现在线自动转换成HTML。</p><h2 id="Markdown-Here的操作流程"><a href="#Markdown-Here的操作流程" class="headerlink" title="Markdown Here的操作流程"></a>Markdown Here的操作流程</h2><blockquote><ol><li>在Chrome, Firefox等支持扩展的浏览器中安装Markdown here 插件。</li><li>配置Markdown Here Option，自定义CSS，插件默认的格式是发布到github的，俺做了一些修改。大家也可以到网上搜索一下别人弄好的格式。<br><img src="http://upload-images.jianshu.io/upload_images/5067306-5990700126050f6a.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="2018-01-09_163902.jpg"></li><li>在Markdown编辑器中写文章。</li><li>把Markdown格式的文本拷贝到微信公众号，简书都的HTML编辑器中。</li><li>点击浏览器中的Markdown Here图标。</li><li>如果需要，适当修改。  </li></ol></blockquote><p>如果遇到需要上传图片的情况，可以考虑第三方图床，或者在各平台对应的编辑器中插入图片。比如简书，把图片位置留好，然后直接把图片从本地拖放到相应位置，更改说明即可。</p><h2 id="实际效果展示"><a href="#实际效果展示" class="headerlink" title="实际效果展示"></a>实际效果展示</h2><p>下面是俺在Typora中用CSS样式排好的版。不过简书貌似不允许自己定义CSS样式，估计是为了所有简书的文章看起来比较一致。</p><p><img src="http://upload-images.jianshu.io/upload_images/5067306-12d208d496959f06.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p><p>最后，祝大家都能轻松排出图文并茂的文章。</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;自从有了微博，微信，简书等各种在线平台，自媒体如雨后春笋般，漫山遍野的发芽、生长。但是各个平台，文章发布有自己的工具，格式各不相同，对于咱这种半调子技术，又想在多个平台分享自己的想法，心得的个人，怎么才能简单的写文章，然后发布成一样的格式呢？&lt;/p&gt;
    
    </summary>
    
      <category term="计算机技术" scheme="https://autumntail.github.io/categories/%E8%AE%A1%E7%AE%97%E6%9C%BA%E6%8A%80%E6%9C%AF/"/>
    
    
      <category term="网络" scheme="https://autumntail.github.io/tags/%E7%BD%91%E7%BB%9C/"/>
    
  </entry>
  
  <entry>
    <title>给空调更换Ecobee智能温控器</title>
    <link href="https://autumntail.github.io/2018/01/18/%E7%BB%99%E7%A9%BA%E8%B0%83%E6%9B%B4%E6%8D%A2Ecobee%E6%99%BA%E8%83%BD%E6%B8%A9%E6%8E%A7%E5%99%A8/"/>
    <id>https://autumntail.github.io/2018/01/18/给空调更换Ecobee智能温控器/</id>
    <published>2018-01-18T19:47:15.000Z</published>
    <updated>2018-09-01T06:37:22.477Z</updated>
    
    <content type="html"><![CDATA[<p>美国的独立屋，很多是分层式结构，客厅高顶设计，即视觉感受上高大上，又利于采光，很受华人家庭喜欢。不过，这种结构有一个温控上的问题，就是二楼的空调温控一般都习惯性的放在楼梯口，由于高顶客厅的开放式设计使上下楼空气流通顺畅，会导致房间内温度还没达到理想温度，对应的空调已经停止工作了。</p><a id="more"></a><p>现在的智能温控器选择越来越多，ecobee就是其中比较有特点的一个，它的思路是：除了主温控，还可以在不同的房间附带安装多个温度传感器，然后根据不同房间里有没有人，或者手动选择不同的温度传感器来控制空调的开关，从而达到最优化的温度调节。这个思路似乎可以解决上面咱说到的难题。于是，在休斯敦这百年难遇的冷冻天气，俺们公司的高总决定吃螃蟹了。</p><p><img src="http://upload-images.jianshu.io/upload_images/5067306-5c783fc155069672.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p><p>这是原来的老式温控器，首先去阁楼里或者配电箱断掉Furnace的电源。</p><p><img src="http://upload-images.jianshu.io/upload_images/5067306-722544d7595391fe.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p><p>取下旧的温控器面板，把线断开。</p><p><img src="http://upload-images.jianshu.io/upload_images/5067306-6d60737450e11884.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p><p>给线做一下label，免得接错（老司机请自动略过）。</p><p><img src="http://upload-images.jianshu.io/upload_images/5067306-50c5cb7b0a95d59f.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p><p>然后开始安装ecobee的底座。底座上有个小的水平仪可以调节水平。</p><p><img src="http://upload-images.jianshu.io/upload_images/5067306-13a294391a130174.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p><p><img src="http://upload-images.jianshu.io/upload_images/5067306-bfd2d032b77f069a.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p><p>把label好的线接到对应的插孔里，如果墙内的线只有4根（缺common线），需要安装ecobee附带的供电模块，新的房子一般不需要。接线的时候，红线在老式的温控里是接在Rc/Rh两端上的，但是在ecobee里，可以随便接在Rc，Rh或者两者都接上。</p><p><img src="http://upload-images.jianshu.io/upload_images/5067306-9378230cb4dc799f.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p><p>接好线，插上ecobee的面板，就可以打开电源了。</p><p><img src="http://upload-images.jianshu.io/upload_images/5067306-b6b467bc91d75e1f.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p><p>Ecobee会自动检测接通的线。一路Next，注册设备到ecobee的服务器，完成设置。然后配对独立的温度传感器，并把传感器放到希望可以控温的房间里去。接下来就可以在ecobee的程序里设置schedule，或者随时开关某个温度传感器，ecobee会根据工作传感器的温度智能（平均，屋里有没有人等）调节空调的开关。</p><p><img src="http://upload-images.jianshu.io/upload_images/5067306-4f2bc0b86139938a.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p><p><img src="http://upload-images.jianshu.io/upload_images/5067306-356055e5adbac60b.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p><p>这个温控器的功能挺多。可以用android，也可以用apple的Homekit进行连接，还可以通过IFFFT和SmartThings与其它智能设备一起，互相配合，实现真正的家庭物联，智能家居。咱今天抛砖引玉，大家自行引申发掘吧。</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;美国的独立屋，很多是分层式结构，客厅高顶设计，即视觉感受上高大上，又利于采光，很受华人家庭喜欢。不过，这种结构有一个温控上的问题，就是二楼的空调温控一般都习惯性的放在楼梯口，由于高顶客厅的开放式设计使上下楼空气流通顺畅，会导致房间内温度还没达到理想温度，对应的空调已经停止工作了。&lt;/p&gt;
    
    </summary>
    
      <category term="生活DIY" scheme="https://autumntail.github.io/categories/%E7%94%9F%E6%B4%BBDIY/"/>
    
    
      <category term="空调" scheme="https://autumntail.github.io/tags/%E7%A9%BA%E8%B0%83/"/>
    
      <category term="电" scheme="https://autumntail.github.io/tags/%E7%94%B5/"/>
    
  </entry>
  
  <entry>
    <title>荧光灯的LED改造</title>
    <link href="https://autumntail.github.io/2018/01/05/%E8%8D%A7%E5%85%89%E7%81%AF%E7%9A%84LED%E6%94%B9%E9%80%A0/"/>
    <id>https://autumntail.github.io/2018/01/05/荧光灯的LED改造/</id>
    <published>2018-01-05T20:02:20.000Z</published>
    <updated>2018-09-01T06:37:22.479Z</updated>
    
    <content type="html"><![CDATA[<p>俺的厨房原先有8根T12荧光灯管，镇流器都先后坏掉了，去店里看了下，镇流器也不便宜，索性还是上LED灯管了。</p><a id="more"></a><p><img src="http://upload-images.jianshu.io/upload_images/5067306-91dbda2f8beba87b.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="24-fluorescent-light-fixture.jpg"></p><p>目前LED灯管有三种选择：一是灯管跟基座整合在一起，回头坏掉的话得整个一起换掉，而且要拆掉旧的基座，工程大，成本高；二是换跟镇流器兼容的灯管，好处是即插即用，跟换荧光灯管一个步骤，坏处是如果镇流器坏了，还是需要买个新镇流器换上。第三种是利用原有的基座，拆掉镇流器，重新接一下线，这个方案比较符合俺的情形。</p><p>要把荧光灯管的基座改造成LED灯管兼容的灯座，很可能需要换掉头上的socket。ballast bypass的LED灯管目前电源接线有两种情形：一种是两极在一端；一种在两端。一端的接线简单些，俺就是买的这种。而这种两极在一端的LED灯管需要non shunted的socket配合，如果不确定，最好先用欧姆表量量socket的两个头电阻，如果是电阻很小，那需要换掉，成本大概5毛一个。线接好后，如图所示的样子。灯管另一端的socket只要把电源线剪掉就行，不用管是不是non shunted的。</p><p><img src="http://upload-images.jianshu.io/upload_images/5067306-6e04e08a40e882a2.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="non shunted vs shunted socket"></p><p>如果需要几根灯管并联在一起，接线如下图。</p><p><img src="http://upload-images.jianshu.io/upload_images/5067306-e3e9e9a03ac83cec.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="并联接线"></p><p>俺买了8根1800流明4000k的LED灯管，每根9块，装上发现太亮，留了4根。</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;俺的厨房原先有8根T12荧光灯管，镇流器都先后坏掉了，去店里看了下，镇流器也不便宜，索性还是上LED灯管了。&lt;/p&gt;
    
    </summary>
    
      <category term="生活DIY" scheme="https://autumntail.github.io/categories/%E7%94%9F%E6%B4%BBDIY/"/>
    
    
      <category term="电" scheme="https://autumntail.github.io/tags/%E7%94%B5/"/>
    
  </entry>
  
  <entry>
    <title>智能马桶盖，土豪们都喜欢</title>
    <link href="https://autumntail.github.io/2017/10/09/%E6%99%BA%E8%83%BD%E9%A9%AC%E6%A1%B6%E7%9B%96%EF%BC%8C%E5%9C%9F%E8%B1%AA%E4%BB%AC%E9%83%BD%E5%96%9C%E6%AC%A2/"/>
    <id>https://autumntail.github.io/2017/10/09/智能马桶盖，土豪们都喜欢/</id>
    <published>2017-10-09T19:00:46.000Z</published>
    <updated>2018-09-13T05:21:08.488Z</updated>
    
    <content type="html"><![CDATA[<p>记得曾经看到一则新闻，说上海的土豪到日本旅行，带了个马桶回国。这虽是一则笑谈，但是据调查：用过智能马桶系统的都说好。具体咋个好法，咱今天就不细表了，咱今天说的是如何从无到有的安装一个智能马桶盖。</p><a id="more"></a><p><img src="http://upload-images.jianshu.io/upload_images/5067306-0a80ad5c42add34a.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="智能马桶盖"></p><p><img src="http://upload-images.jianshu.io/upload_images/5067306-a57503fc5e18f7a4.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="智能马桶盖的构造"></p><p>安装智能马桶盖，最主要的是附近有需要的电源插座。而一般厕所插座不是造房子的标准配置，需要花钱请建筑商升级，或者像俺一样，自己动手扩展一个。</p><p>要扩展插座，两种情形最常见。</p><p>一种是旁边的墙上有灯的开关，那么，可以把灯的开关换成开关、插座二合一的面板。</p><p><img src="http://upload-images.jianshu.io/upload_images/5067306-29dc7e1ac4c2f43d.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="插座开关二合一"></p><p>第二种情形复杂些，附近的电源比较远，那就得想办法扯根电源线过来，做一个新的插座。比如像俺家楼上某厕所。</p><p><img src="http://upload-images.jianshu.io/upload_images/5067306-b44990f21175e0ec.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="墙徒四壁"></p><p>左边的墙后是淋浴喷头，肯定很多水管，不能动。后边或右边墙都可以动。经过调查，发现右边墙上方距离可用的电源比较近。</p><p>首先用stud finder在墙上找出木梁的位置，贴在木梁旁边开一个比插座盒略小的洞。</p><p><img src="http://upload-images.jianshu.io/upload_images/5067306-46a35fb6409022f7.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="outlet.hole.png"></p><p>然后可以用flex camera系统查看一下墙内有没有管道。确保安全。</p><p><img src="http://upload-images.jianshu.io/upload_images/5067306-f2070ea2027c9ad4.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="camera.with.remote.png"></p><p>接下来用长的cable bit在墙里打出一条走线的通道。</p><p><img src="http://upload-images.jianshu.io/upload_images/5067306-96d45fc9dccabe81.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="cable.bit.jpg"></p><p><img src="http://upload-images.jianshu.io/upload_images/5067306-9eb4c8514309ad1c.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="drill.hole.jpg"></p><p>用fishing tool把电线拉到墙里。</p><p><img src="http://upload-images.jianshu.io/upload_images/5067306-fabdc906035217f3.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="fishing.tool.jpg"></p><p><img src="http://upload-images.jianshu.io/upload_images/5067306-b85e1b143535cbe1.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="7.fishing.cable.jpg"></p><p><img src="http://upload-images.jianshu.io/upload_images/5067306-b40785f95ef316db.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="install.outlet.jpg"></p><p>装好插座，接通电源。</p><p><img src="http://upload-images.jianshu.io/upload_images/5067306-91a7ea8f7a26a407.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="power.to.source.jpg"></p><p><img src="http://upload-images.jianshu.io/upload_images/5067306-0f6aa4a32a8bc60e.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="installed.surge.protector.png"></p><p>最后，把买好的智能马桶盖装上，厕所马上高大上了，有没有？</p><p>特别要提醒的是，在墙里打洞，一定要确定好周围没有水管，电线，空调管，等等一切会被搞坏的东西。不然，损坏了维修很麻烦。</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;记得曾经看到一则新闻，说上海的土豪到日本旅行，带了个马桶回国。这虽是一则笑谈，但是据调查：用过智能马桶系统的都说好。具体咋个好法，咱今天就不细表了，咱今天说的是如何从无到有的安装一个智能马桶盖。&lt;/p&gt;
    
    </summary>
    
      <category term="生活DIY" scheme="https://autumntail.github.io/categories/%E7%94%9F%E6%B4%BBDIY/"/>
    
    
      <category term="水" scheme="https://autumntail.github.io/tags/%E6%B0%B4/"/>
    
      <category term="建筑" scheme="https://autumntail.github.io/tags/%E5%BB%BA%E7%AD%91/"/>
    
  </entry>
  
  <entry>
    <title>屋顶漏水维修</title>
    <link href="https://autumntail.github.io/2017/09/18/%E5%B1%8B%E9%A1%B6%E6%BC%8F%E6%B0%B4%E7%BB%B4%E4%BF%AE/"/>
    <id>https://autumntail.github.io/2017/09/18/屋顶漏水维修/</id>
    <published>2017-09-18T18:59:41.000Z</published>
    <updated>2018-09-01T06:37:22.476Z</updated>
    
    <content type="html"><![CDATA[<p>800年不遇的飓风暴雨光顾了俺们村，很多朋友的屋顶都出现了不同程度的漏水，以致Roofer们都忙不过来了。如果不是那种很严重，需要更换屋顶的情形，可以像俺一样展开自救。</p><a id="more"></a><p>俺家的情形是阁楼里暖气炉子边上出现了一滩水。</p><p><img src="http://upload-images.jianshu.io/upload_images/5067306-c8a9175cec3a71d3.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="roof_leaking.jpg"></p><p>经过观察，发现水是从炉子的废气管道进来的。</p><p><img src="http://upload-images.jianshu.io/upload_images/5067306-259bdfafc9a54cc1.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="IMG_20170826_215507.jpg"></p><p>另外，有几个卫生间的排气管道也出现了一些水滴。</p><p><img src="http://upload-images.jianshu.io/upload_images/5067306-01b12707e6f947a5.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="IMG_20170826_215646.jpg"></p><p>这几个漏水应该都是屋顶上对应的vent密封出问题了，维修比较简单。主要的困难是怎么上屋顶。</p><p>如果房子是1层的，那太幸运了，几乎屋顶的任何角落，大可去得。如果是2层的房子，那困难级别可就指数上升了：一是因为太高，不经常上去的人难免有不同程度的恐惧心理，二是2层的房子占地面积小，屋顶的坡度一般会大些，有些坡还特别大，没有特别的安全辅助措施，是不可能直接走上去的。</p><p>上2层屋顶，需要一个很高的梯子，为了安全，梯子要架得比屋檐高几尺。高梯子会很重，架起来的时候需要小心，别弄坏了窗户啥的，就得不偿失了。</p><p>俺调研不够，买了一个28尺的fiberglass的extension ladder，非常的重，俺一个人根本无法把它架起来。如果俺再有一次选择的机会，俺会选择一个24尺左右的铝制梯子。</p><p><img src="http://upload-images.jianshu.io/upload_images/5067306-a6fbf1bc9e7717f4.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="at_ladder.jpg"></p><p>如果屋檐上有gutter，梯子不能直接放在屋檐上，需要一个叫ladder stabilizer的附件。</p><p><img src="http://upload-images.jianshu.io/upload_images/5067306-fdc06f22674169d6.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="ladder_stablizer.jpg"></p><p>上二楼屋顶，最好能穿一双专门的软底防划的鞋子。</p><p><img src="http://upload-images.jianshu.io/upload_images/5067306-6427b894106a0b4a.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="roof_boots.jpg"></p><p>俺没有，就挑选了一双最软，最防滑的运动鞋代替。</p><p>为了防止在屋顶走动的时候滑，俺选了从烟囱旁边上去，从烟囱上方爬到屋脊上，然后再去需要的地方。</p><p>俺家的暖气vent在这个位置。</p><p><img src="http://upload-images.jianshu.io/upload_images/5067306-78c9bf6890e2bed5.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="roof_vent.jpg"></p><p>坡度太大，只能从屋脊那边访问。这种vent的结构是这样的。</p><p><img src="http://upload-images.jianshu.io/upload_images/5067306-9ff51eae4235e312.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="DSC00131b.jpg"></p><p>除了flashing跟屋顶结合处的钉子，最大的漏点就是storm collar上方那一圈sealant，大风刮过，日晒老化，都会造成漏水。因为是废气的管道，温度比较高，俺买了下面这种专用caulk。</p><p><img src="http://upload-images.jianshu.io/upload_images/5067306-0e99377c4117aca6.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="ruterland_caulk.jpg"></p><p>用caulk gun重新涂抹一下collar周围的缝隙就可以收工了。是不是很简单？</p><p>老话说得好，上山容易下山难。最后从屋顶下来的时候一定要更加小心。</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;800年不遇的飓风暴雨光顾了俺们村，很多朋友的屋顶都出现了不同程度的漏水，以致Roofer们都忙不过来了。如果不是那种很严重，需要更换屋顶的情形，可以像俺一样展开自救。&lt;/p&gt;
    
    </summary>
    
      <category term="生活DIY" scheme="https://autumntail.github.io/categories/%E7%94%9F%E6%B4%BBDIY/"/>
    
    
      <category term="水" scheme="https://autumntail.github.io/tags/%E6%B0%B4/"/>
    
      <category term="建筑" scheme="https://autumntail.github.io/tags/%E5%BB%BA%E7%AD%91/"/>
    
  </entry>
  
  <entry>
    <title>360度无死角无线网络</title>
    <link href="https://autumntail.github.io/2017/06/21/360%E5%BA%A6%E6%97%A0%E6%AD%BB%E8%A7%92%E6%97%A0%E7%BA%BF%E7%BD%91%E7%BB%9C/"/>
    <id>https://autumntail.github.io/2017/06/21/360度无死角无线网络/</id>
    <published>2017-06-21T18:58:11.000Z</published>
    <updated>2018-09-01T06:37:22.474Z</updated>
    
    <content type="html"><![CDATA[<p>现在家用无线网络越来越普及了，而且比起造房子让builder铺设有线，造价实在是便宜太多了。但是，目前无线路由器的覆盖，信号衰减问题还比较突出。常常出现家里某些角落没有信号或者信号很弱。现在很多商家都推出了智能WiFi系统，一个package里有好几个路由，放在家里的各个地方，保证不出现信号死角。但是，目前，市场上的这类产品都偏贵，而且华而不实。</p><a id="more"></a><p>几年前，华硕家出了一款号称“神由“的无线路由器，AC68，可以自己刷第三方的固件，当然，它家自己的固件，也相当的不错。</p><p><img src="http://upload-images.jianshu.io/upload_images/5067306-7b830468fbbc2bdb.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="AC68.png"></p><p>后来，TMobile家定制了这个路由，免费送给它家电话用户，再后来，以$59的价格卖给非它家用户。绝对无愧物美价廉的”神由“称号。俺买了俩，组建了俺家的无线网路。它的规格直到目前，都是很高的：2.4GHz跟5GHz两个频段同时工作，2.4GHz最高速度600Mbps，5GHz最高速度1300Mbps，有4个千兆局域网口，一个千兆广域网口，2个USB（USB2.0 + USB3.0)接口。</p><p>多个路由组合在一去，拓扑结构是这样的。</p><p><img src="http://upload-images.jianshu.io/upload_images/5067306-5c530db3ae1ff46a.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="repeater2.png"></p><p>一个路由为主路由，通过modem接入互联网，其它的路由通过有线或者无线的连接跟主路由组合在一起，通过设置共用的DHCP分配客户端网址，就可以实现局域网所有的客户端无障碍互相访问；而通过设置无线服务公用一个SSID，可以实现无线网络的无缝接入。</p><p>俺的ASUS AC68是这样设置的：主路由设置为AP模式，设置IP地址为192.168.10.1，开启DHCP服务，分配网址范围192.168.10.101~192.168.10.255，2.5GHz跟5GHz各设置一个SSID（随便起名字）。</p><p><img src="http://upload-images.jianshu.io/upload_images/5067306-dcd66cf833b50a80.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="ap1.jpg"></p><p>副路由设置为Repeater模式，设置IP为192.168.10.2，关闭DHCP，通过5GHz跟主路由相连，其两个服务SSID跟主路由相同。</p><p><img src="http://upload-images.jianshu.io/upload_images/5067306-18251965c08ab978.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="ap2.jpg"></p><p>连通后，副路由状态显示：</p><p><img src="http://upload-images.jianshu.io/upload_images/5067306-8e4fb130cae37929.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="ap2_status.jpg"></p><p>然后，把家里的有线客户端连到就近的路由上。比如，俺的NAS (文件服务器)，打印机，书房工作电脑都靠近副路由，就通过有线接到副路由上；而楼下接电视的HDPC靠近主路由，通过有线接在主路由上。其它的机器，两不靠的，就通过无线网卡连接（因为SSID相同，不用区分主副路由，会自动切换）。</p><p><img src="http://upload-images.jianshu.io/upload_images/5067306-e9d07e401890f008.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="wifi_card.png"></p><p>俺对局域网里不同连接的机器分别做了速度测试，以到NAS的连接速度为测试标准。</p><p>俺的跟NAS同在一个路由下有线连接的机器，速度能到千兆网的极限。</p><p><img src="http://upload-images.jianshu.io/upload_images/5067306-ebcdb24ea34c8a89.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="NAS_wired.png"></p><p>楼下的HDPC，通过有线连接到主路由，跟NAS之间是通过两个路由之间的无线信号连接的。速度打了很大折扣，不过也能测到近600Mbps的速度。</p><p><img src="http://upload-images.jianshu.io/upload_images/5067306-bbe72fcebb8b6c6f.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="lan_udp.jpg"></p><p>Ftp测试位于NAS上的文件传输。</p><p><img src="http://upload-images.jianshu.io/upload_images/5067306-79ff78618a56effc.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="lan_transfer.jpg"></p><p>观看位于NAS上的4K高清测试片，清晰流畅不卡顿。</p><p><img src="http://upload-images.jianshu.io/upload_images/5067306-9698ebe52ed55e32.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="lan_movie.jpg"></p><p>不同位置，不同网卡的无线速度测试。</p><p><img src="http://upload-images.jianshu.io/upload_images/5067306-e0715a7cf6a33df7.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="wifi_test_1.jpg"></p><p><img src="http://upload-images.jianshu.io/upload_images/5067306-86675951cd8eb955.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="wifi2.jpg"></p><p>俺的Andoid手机速度测试。</p><p><img src="http://upload-images.jianshu.io/upload_images/5067306-9fb314ff721f6aea.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="android_iperf.png"></p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;现在家用无线网络越来越普及了，而且比起造房子让builder铺设有线，造价实在是便宜太多了。但是，目前无线路由器的覆盖，信号衰减问题还比较突出。常常出现家里某些角落没有信号或者信号很弱。现在很多商家都推出了智能WiFi系统，一个package里有好几个路由，放在家里的各个地方，保证不出现信号死角。但是，目前，市场上的这类产品都偏贵，而且华而不实。&lt;/p&gt;
    
    </summary>
    
      <category term="计算机技术" scheme="https://autumntail.github.io/categories/%E8%AE%A1%E7%AE%97%E6%9C%BA%E6%8A%80%E6%9C%AF/"/>
    
    
      <category term="网络" scheme="https://autumntail.github.io/tags/%E7%BD%91%E7%BB%9C/"/>
    
  </entry>
  
  <entry>
    <title>割草机维修之点火时序</title>
    <link href="https://autumntail.github.io/2017/06/15/%E5%89%B2%E8%8D%89%E6%9C%BA%E7%BB%B4%E4%BF%AE%E4%B9%8B%E7%82%B9%E7%81%AB%E6%97%B6%E5%BA%8F/"/>
    <id>https://autumntail.github.io/2017/06/15/割草机维修之点火时序/</id>
    <published>2017-06-15T18:57:10.000Z</published>
    <updated>2018-09-01T06:37:22.475Z</updated>
    
    <content type="html"><![CDATA[<p>割草机上的汽油发动机虽小，也五脏俱全。前面的文章里咱已经了解了割草机最主要的故障来源–油路。另外还有一个相对次要，但是不注意也会发生故障的地方–点火系统。</p><a id="more"></a><p>割草机的点火系统有这么几部分：spark plug，cable，flywheel跟flywheel key。其中flywheel和flywheel key负责在合适的时刻产生一个电压传送给spark plug，产生火花，点燃汽化的油。当运转中的割草机刀片打到大石头，水泥地等阻力非常大的地方的时候，阻力会传导给flywheel跟key，产生物理损坏，接下来，打火的时序就会发生紊乱，忽快忽慢，声音无力，积炭，等等。严重的也会打不着火。</p><p>今天，俺就分享一下俺更换flywheel key的过程。首先把启动的线断开。<br><img src="http://upload-images.jianshu.io/upload_images/5067306-3390e6a018a7e7c3.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="IMG_20170613_192932.jpg"></p><p> 定位并拧下flywheel cover的盖子。</p><p><img src="http://upload-images.jianshu.io/upload_images/5067306-3df3150b10f909e5.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="IMG_20170613_192936.jpg"></p><p><img src="http://upload-images.jianshu.io/upload_images/5067306-a247c7bab649a714.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="IMG_20170613_193032.jpg"></p><p><img src="http://upload-images.jianshu.io/upload_images/5067306-76a1df1d211ddab9.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="IMG_20170613_193136.jpg"></p><p>拧下固定flywheel的大螺丝，这个大螺丝可能不太好拧，需要先找块木头固定一下底下的刀片。</p><p><img src="http://upload-images.jianshu.io/upload_images/5067306-410623ece3385021.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="IMG_20170613_193726.jpg"></p><p>拧下螺丝，并不意味着flywheel能很容易的取下来，特别是对于比较旧的机器，可能还是粘的很牢。这时候，可能需要一个叫flywheel puller的工具。</p><p><img src="http://upload-images.jianshu.io/upload_images/5067306-8cc27d4c39be48ab.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="flywheel puller.jpg"></p><p>不过鉴于这个工具不是很常用，俺没有买，而是用橡皮锤从各个方向敲了几下，然后就可以取下了。大家不防一试，但是千万不要用金属的锤子敲，把flywheel敲坏了就得不偿失了。</p><p><img src="http://upload-images.jianshu.io/upload_images/5067306-ca206ef1618296f4.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="rubber_hammer.jpg"></p><p><img src="http://upload-images.jianshu.io/upload_images/5067306-8ffa05ecf8628254.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="IMG_20170614_190137.jpg"></p><p>然后就可以拿出flywheel key了。</p><p><img src="http://upload-images.jianshu.io/upload_images/5067306-a4a579c82496771c.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="IMG_20170614_190147.jpg"></p><p>检察一下是不是有物理损坏，买个一样的key换上。flywheel如果损坏了，也建议更换，不过flywheel贵一些。</p><p><img src="http://upload-images.jianshu.io/upload_images/5067306-cc17acd8446c728b.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="IMG_20170614_191117.jpg"></p><p>把固定的螺丝拧回去，大概50lbft的力钜。按相反的装回去。试启动，机器的突突声又变得均匀有力了。</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;割草机上的汽油发动机虽小，也五脏俱全。前面的文章里咱已经了解了割草机最主要的故障来源–油路。另外还有一个相对次要，但是不注意也会发生故障的地方–点火系统。&lt;/p&gt;
    
    </summary>
    
      <category term="生活DIY" scheme="https://autumntail.github.io/categories/%E7%94%9F%E6%B4%BBDIY/"/>
    
    
      <category term="机械" scheme="https://autumntail.github.io/tags/%E6%9C%BA%E6%A2%B0/"/>
    
      <category term="车" scheme="https://autumntail.github.io/tags/%E8%BD%A6/"/>
    
  </entry>
  
  <entry>
    <title>维修割草机</title>
    <link href="https://autumntail.github.io/2017/05/30/%E7%BB%B4%E4%BF%AE%E5%89%B2%E8%8D%89%E6%9C%BA/"/>
    <id>https://autumntail.github.io/2017/05/30/维修割草机/</id>
    <published>2017-05-30T18:53:23.000Z</published>
    <updated>2018-09-01T06:37:22.478Z</updated>
    
    <content type="html"><![CDATA[<p>要想草坪长得好，浇水施肥勤割草。</p><p>然而烧汽油的割草机，是需要定期维护的。不然，时间久了，就会出现各种故障，比如打不着火、无力、声音时高时低… …</p><a id="more"></a><p>造成这些故障的主要原因，就是油路不畅或堵塞。正好长周末，俺跟老周一起，给老周的百年老割草机来了次大手术。</p><p>割草机油路里的易堵部件，叫化油器，顾名思义，就是用来把油雾化的零件。为了要雾化，里面有很多迷宫一样的小孔，随着割草时的草屑，灰尘进入，这些小孔很有可能堵住。</p><p>清洗化油器，需要先买瓶cleaner。</p><p><img src="http://upload-images.jianshu.io/upload_images/5067306-caf316da090adc7e.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="mmexport1496154010278.jpg"></p><p>找到割草机的空气过滤器，化油器紧挨着它。回头顺便把过滤器也换了。</p><p><img src="http://upload-images.jianshu.io/upload_images/5067306-9cf252b7739ffd6c.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="mmexport1496154012575.jpg"></p><p><img src="http://upload-images.jianshu.io/upload_images/5067306-bf6ff2f271ede9a3.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="mmexport1496154012491.jpg"></p><p><img src="http://upload-images.jianshu.io/upload_images/5067306-909138a0c500d022.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="mmexport1496154012406.jpg"></p><p>取下空气过滤器的house，就可以看到一个圆柱状的零件，各种化油器大同小异，都会有这么一个结构。</p><p><img src="http://upload-images.jianshu.io/upload_images/5067306-4868fea159ab566f.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="mmexport1496154012325.jpg"></p><p>圆柱体上方可以看到节气门，节气门旁边的管子，是汽油的入口。取下化油器的固定螺丝，就可以把化油器拿下来。把油管分离，如果油箱里有汽油，把油管堵一下。化油器上一般会有些弹簧跟机器连着，用来调节节气门，小心的把这些弹簧取下，记得要先拍几张照片，免得回头装不回去了。</p><p><img src="http://upload-images.jianshu.io/upload_images/5067306-9a0f66a2bc3762c9.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="mmexport1496154012151.jpg"></p><p><img src="http://upload-images.jianshu.io/upload_images/5067306-ca3a9f69e7d2b00f.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="mmexport1496154011831.jpg"></p><p>把圆柱状的结构拆下来，就能看到化油器内部的各种小孔了。</p><p><img src="http://upload-images.jianshu.io/upload_images/5067306-202f5571b923f0d6.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="IMG_20170505_223542.jpg"></p><p><img src="http://upload-images.jianshu.io/upload_images/5067306-45dba94e58a974a9.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="IMG_20170505_223608.jpg"></p><p>圆柱结构的固定螺丝上，有几个小孔，都要检查一下有没有堵。然后是内部的小孔，都要检查清洗一下。</p><p><img src="http://upload-images.jianshu.io/upload_images/5067306-cbe10cbd41fcfb0f.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="mmexport1496154011484.jpg"></p><p><img src="http://upload-images.jianshu.io/upload_images/5067306-01b2c0b180b34810.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="mmexport1496154011307.jpg"></p><p><img src="http://upload-images.jianshu.io/upload_images/5067306-f1bde4461497be5b.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="mmexport1496154011141.jpg"></p><p><img src="http://upload-images.jianshu.io/upload_images/5067306-7fa237d40bbc0dbe.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="mmexport1496154011068.jpg"></p><p>清洗干净了，把化油器组装好。</p><p><img src="http://upload-images.jianshu.io/upload_images/5067306-1c221373306866f0.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="mmexport1496154010566.jpg"></p><p>原样装回去。</p><p><img src="http://upload-images.jianshu.io/upload_images/5067306-9892dbe56fc8f6b2.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="mmexport1496154010722.jpg"></p><p>然后把火花塞也换一下。</p><p><img src="http://upload-images.jianshu.io/upload_images/5067306-b2041f81b3704b38.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="mmexport1496154010395.jpg"></p><p>最后，把机油换一下，检查下刀片是不是需要换或者磨。百年老机器又可以再用30年。</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;要想草坪长得好，浇水施肥勤割草。&lt;/p&gt;
&lt;p&gt;然而烧汽油的割草机，是需要定期维护的。不然，时间久了，就会出现各种故障，比如打不着火、无力、声音时高时低… …&lt;/p&gt;
    
    </summary>
    
      <category term="生活DIY" scheme="https://autumntail.github.io/categories/%E7%94%9F%E6%B4%BBDIY/"/>
    
    
      <category term="机械" scheme="https://autumntail.github.io/tags/%E6%9C%BA%E6%A2%B0/"/>
    
      <category term="车" scheme="https://autumntail.github.io/tags/%E8%BD%A6/"/>
    
  </entry>
  
  <entry>
    <title>修条小路通后院</title>
    <link href="https://autumntail.github.io/2017/04/26/%E4%BF%AE%E6%9D%A1%E5%B0%8F%E8%B7%AF%E9%80%9A%E5%90%8E%E9%99%A2/"/>
    <id>https://autumntail.github.io/2017/04/26/修条小路通后院/</id>
    <published>2017-04-26T18:52:04.000Z</published>
    <updated>2018-09-01T06:37:22.474Z</updated>
    
    <content type="html"><![CDATA[<p>庭院深深不知去，小路幽幽通何处。</p><a id="more"></a><p>连绵滂沱的大雨完全不顾及矗立在德州这片粘土地上的一幢幢独立屋的感受，随时而来，悄然而去。然后，房子边上就这样了。</p><p><img src="http://upload-images.jianshu.io/upload_images/5067306-501f0a6e69888282.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="muddy_sidewalk.jpg"></p><p>这积在房子边上的水，既让人无法下脚，又在潜移默化的影响着房子的地基。后果十分严重。</p><p>好在俺们与天斗的勇气是无比磅礴的。经过几番热烈的家庭民主会议讨论，形成了修一条水泥小路的最终决策：项目执行人“石头”，项目监督兼后勤保障“石头LD“。</p><p>要做水泥工程，需要几样简单的工具。</p><p><img src="http://upload-images.jianshu.io/upload_images/5067306-27abbb300f49af06.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="concrete_tools.jpg"></p><p>水泥俺选的是HD的Quickrete Mix，这种水泥里已经混合了石子跟强化纤维，直接加水拌匀就可以使用，可承受4000PSI的压力。60lbs的比较容易搬。60lbs的一包混合后体积是0.45立方尺。俺粗略计算了需要的量，订购了一批，让HD直接送到家。</p><p>材料齐备，可以开工了。</p><p>首先要把地面草皮铲掉，用tamper（工具1-3）把土压实。再用2x4‘’的木头做框架。如果水泥路是弯弯曲曲的，可以用hard board，HD也有的卖。搭框架的时候，要用level控制一下水泥的坡度，让水朝向远离地基的方向流。</p><p><img src="http://upload-images.jianshu.io/upload_images/5067306-c823f8fdb4d5a0e0.JPG?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="framing.JPG"></p><p>根据要做成水泥块的大小，中间用1x4的PT木头或者专门的strip隔开。一块水泥的长度尽量不要超过30’。</p><p><img src="http://upload-images.jianshu.io/upload_images/5067306-ea21803b508693d7.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="FH00MAY_SIDEWK_25.jpg"></p><p>然后在底下铺上石子，上面铺上rebar或者remesh，用来加固水泥。</p><p>接下来，就可以和水泥了。俺力气比较小，一次就和一包。把水泥倒进小推车里，加合适比例的水，用锹搅拌均匀，倒进框架里。框架里水泥满了，就可以摊匀，抹平。</p><p><img src="http://upload-images.jianshu.io/upload_images/5067306-789ece02d356e12e.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="FH00MAY_SIDEWK_19.jpg"></p><p>一般，每隔5’左右，要用groover做一条control joint，防止水泥裂缝。</p><p><img src="http://upload-images.jianshu.io/upload_images/5067306-2a5b464c3eb4b7b3.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="joint.jpg"></p><p>用edger把边缘弄平滑，防止硬化的水泥伤人。</p><p><img src="http://upload-images.jianshu.io/upload_images/5067306-0dc49a5648a5d9f5.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="edger.jpg"></p><p>做好的水泥，如果天气太热或者可能下雨，用塑料布，盖一下。以便水泥有充分的时间硬化。一般24小时以后就不怕雨浇坏水泥了，7天后，就可以拆掉框架。</p><p><img src="http://upload-images.jianshu.io/upload_images/5067306-d9e46a000c6211c9.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="IMG_20150518_083258.jpg"></p><p><img src="http://upload-images.jianshu.io/upload_images/5067306-2941de4e62e523b6.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="IMG_20150519_074159-small.jpg"></p><p><img src="http://upload-images.jianshu.io/upload_images/5067306-906558e95db9dc8a.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="IMG_20150519_074159_1.jpg"></p><p>俺的小路直接通到后院的屋门口。从此，再也不怕泥泞的草地了。地基亦无忧矣。</p><p><img src="http://upload-images.jianshu.io/upload_images/5067306-5d15d3fb8740c6f2.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="road-granie..jpg"></p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;庭院深深不知去，小路幽幽通何处。&lt;/p&gt;
    
    </summary>
    
      <category term="生活DIY" scheme="https://autumntail.github.io/categories/%E7%94%9F%E6%B4%BBDIY/"/>
    
    
      <category term="水" scheme="https://autumntail.github.io/tags/%E6%B0%B4/"/>
    
      <category term="建筑" scheme="https://autumntail.github.io/tags/%E5%BB%BA%E7%AD%91/"/>
    
  </entry>
  
  <entry>
    <title>自己装gutter</title>
    <link href="https://autumntail.github.io/2017/04/19/%E8%87%AA%E5%B7%B1%E8%A3%85gutter/"/>
    <id>https://autumntail.github.io/2017/04/19/自己装gutter/</id>
    <published>2017-04-19T18:50:11.000Z</published>
    <updated>2018-09-01T06:37:22.479Z</updated>
    
    <content type="html"><![CDATA[<p>休斯敦的春夏之交，雨水多，而且还时不时来场大雨。有朋友就问，能不能自己装gutter？俺的经验是，能装。但是不见得能省很多钱。</p><a id="more"></a><p>请人装的话，专业人士多半是装那种无缝的，一个大车开来，现场测量长度，现场做成，即省时间，又省人力。而如果要自己做的话，只能是买固定长度的，按照需要拼接起来。</p><p>所以，如果家里要装的gutter很长，那就请人装。如果只是一小段，可以自己尝试一下。除了需要梯子跟人搭把手之外，没有特别复杂的工序。今天，俺就跟大家分享下怎么自己装gutter。</p><p>俺先列一下需要的工具。</p><p><img src="http://upload-images.jianshu.io/upload_images/5067306-d7c274f732896a7c.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="gutter_tools.jpg"></p><p>首先，要量一下屋檐的长度，店里买到的现成的铝制gutter一般是10’长，可能会需要切割或者拼接。切割可以用hack saw或者cutter，拼接则需要用到rivet跟对应的rivet gun，就是图里面第二排第一个。拼接前先要用cutter剪掉约6’’边缘。</p><p><img src="http://upload-images.jianshu.io/upload_images/5067306-f1b0f5a6e65b3a17.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="gutter_link.jpg"></p><p>然后把两段套起来，用1/8’’的drill打几个小孔，把rivet装进去。</p><p><img src="http://upload-images.jianshu.io/upload_images/5067306-f7540c37bb4c8d7f.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="revit_1v8.jpg"></p><p><img src="http://upload-images.jianshu.io/upload_images/5067306-9fd71c4634004c9d.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="guter_revet.jpg"></p><p>最后抹一些sealant。</p><p><img src="http://upload-images.jianshu.io/upload_images/5067306-3dc3f20afbd57d8d.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="sealant.jpg"></p><p>如果需要拐角，连接的方法跟上面类似。连接好了需要的gutter，用end cap把两头封起来，卡住end cap有一个专门的工具，叫snap lock punch，是工具那张图上第二排第二个。</p><p><img src="http://upload-images.jianshu.io/upload_images/5067306-c929ea20370bba6f.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="end_cap.jpg"></p><p>在安装gutter之前，还需要把downspout的接头连上去。</p><p><img src="http://upload-images.jianshu.io/upload_images/5067306-91f8e83d2ddf4fcc.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="outlet.jpg"></p><p><img src="http://upload-images.jianshu.io/upload_images/5067306-ba701fed193d9964.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="install_outlet.jpg"><br>然后就是把装配好的gutter订到屋檐下。Gutter跟屋檐的相对关系是这样的。</p><p><img src="http://upload-images.jianshu.io/upload_images/5067306-7b1bf0cc0c420128.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="Gutter_Pitch_020c.jpg"><br>为了让gutter里面的水流向downspout，gutter顺着屋檐有一定的角度，一般每20’下降1’’。摆好gutter的位置，用drill driver把hanger订进屋檐的fascia board里。</p><p><img src="http://upload-images.jianshu.io/upload_images/5067306-1158721bcffe00a8.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="install_gutter_hanger.jpg"><br>为了防止下雨时雨水顺着gutter内侧的fascia board流下来（就是大家常见的gutter漏水，这一步经常被“专业人士”们省略，俺也不知道为什么），最好是装一个gutter flash。</p><p><img src="http://upload-images.jianshu.io/upload_images/5067306-4a84068d21ebf522.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="gutter_flash.jpg"></p><p>最后，就是把downspout装上去，一般两头要先装拐角。然后在墙上装上固定的clip，根据墙的不同材料，固定clip的办法也不一样：siding board简单些，砖墙复杂些，要先打个孔，再用膨胀螺丝钉。</p><p><img src="http://upload-images.jianshu.io/upload_images/5067306-c07063840c9f744a.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="downspout_clip.jpg"><br>装好了是这样子的。</p><p><img src="http://upload-images.jianshu.io/upload_images/5067306-c5ace9512a1f92f6.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="patio&amp;gutter.png"></p><p>如果地面是草地，可能还需要这个，叫downspout splash block。</p><p><img src="http://upload-images.jianshu.io/upload_images/5067306-59b58bde4d62a1ba.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="downspout_splash_block.jpg"></p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;休斯敦的春夏之交，雨水多，而且还时不时来场大雨。有朋友就问，能不能自己装gutter？俺的经验是，能装。但是不见得能省很多钱。&lt;/p&gt;
    
    </summary>
    
      <category term="生活DIY" scheme="https://autumntail.github.io/categories/%E7%94%9F%E6%B4%BBDIY/"/>
    
    
      <category term="水" scheme="https://autumntail.github.io/tags/%E6%B0%B4/"/>
    
      <category term="建筑" scheme="https://autumntail.github.io/tags/%E5%BB%BA%E7%AD%91/"/>
    
  </entry>
  
  <entry>
    <title>选择安装行车记录仪</title>
    <link href="https://autumntail.github.io/2017/04/07/%E9%80%89%E6%8B%A9%E5%AE%89%E8%A3%85%E8%A1%8C%E8%BD%A6%E8%AE%B0%E5%BD%95%E4%BB%AA/"/>
    <id>https://autumntail.github.io/2017/04/07/选择安装行车记录仪/</id>
    <published>2017-04-07T18:46:37.000Z</published>
    <updated>2018-09-01T06:37:22.480Z</updated>
    
    <content type="html"><![CDATA[<p>休斯敦的警察们每天都忙碌着应付杀人放火的大案要案，对于车子之间你蹭我，我磕你，多半是“俺们公仆都很忙，这种小case你们自己解决得了“。所以，安装一个可靠的行车记录仪，留下现场的证据，对于后面的保险维修，防止被人讹诈，还是很有用的。</p><a id="more"></a><p>行车记录仪经过几年的大发展，价格已经是非常亲民了。俺装第一个BlackVue的时候，要200多一个。而现在，一个山寨2K分辨率，60Hz录像频率的机器，也不过100块左右，什么GPS啊，G sensor啊，换道提醒，防撞提醒之类的听起来眼花缭乱的feature，一应俱全。真是”只有想不到的，没有寨厂们做不出来的”。</p><p>面对这么眼花缭乱的产品，选啥好呢？其实虽然品牌很多，但内部的主控芯片，就那么几家做，安霸跟联咏的比较多。休斯敦的天气比较热，选择的时候尽量避开用电池供电的。俺曾经买过两个网上很多人推崇的Mini 0806，结果很不稳定，它有个很脑残的设计：外接电源只是负责给电池充电，系统工作则从电池取电。这带来一个很严重的后果，就是一旦电池故障，机器就废了。好的设计应该是外接电源来供电，而电池或者电容起到备用跟缓冲的作用。最后，不要买山寨厂家推出的最新产品。无论这个产品吹得多么的天花乱坠。尽量选择那些已经上市一段时间，经过市场反馈检验过的产品。</p><p>好，选好了一款记录仪，接下来就是安装了。很多人可能就直接接到车上的12V点烟口或者USB口上。不过，有些车型（比如福特家的）车上的点烟口在车熄火后仍然是有电的，如果忘记关掉接在上面的行车记录仪，可能会把电池耗光。又或者，有些人希望可以把线隐藏起来，让车内部显得干净整洁一些。下面俺就说说这种情况怎么接线。</p><p>这时候，可以选择把线接到passenger座位下面的fuse box里。这需要一个Add A Circuit，一个fuse，或者还需要一个12V的Adaptor。</p><p><img src="http://upload-images.jianshu.io/upload_images/5067306-9e9851ec2aff2bc5.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="materials.png"></p><p>用万用表或者电笔找一个可以用的停车断电的fuse，把供电线的正极连到Add A Circuit上，把记录仪线路的fuse跟原来车上对应的fuse都装到Add A Circuit上。记录仪的负极线接到车体的金属上。这样可以在选定的fuse位置加上一个并联电路，既不影响原来线路的工作，又给记录仪加了一个保护fuse。</p><p><img src="http://upload-images.jianshu.io/upload_images/5067306-8baabeafb4b076f2.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="add_circuit_fuse.jpg"></p><p>记录仪的走线，可以这样。</p><p><img src="http://upload-images.jianshu.io/upload_images/5067306-83e9a5d6670e7b93.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="blackview-install.jpg"></p><p>也可以直接从A柱下来，从车门边上的seal条里进入下面的fuse box。俺抛砖引玉，大家因车制宜。</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;休斯敦的警察们每天都忙碌着应付杀人放火的大案要案，对于车子之间你蹭我，我磕你，多半是“俺们公仆都很忙，这种小case你们自己解决得了“。所以，安装一个可靠的行车记录仪，留下现场的证据，对于后面的保险维修，防止被人讹诈，还是很有用的。&lt;/p&gt;
    
    </summary>
    
      <category term="生活DIY" scheme="https://autumntail.github.io/categories/%E7%94%9F%E6%B4%BBDIY/"/>
    
    
      <category term="车" scheme="https://autumntail.github.io/tags/%E8%BD%A6/"/>
    
      <category term="电" scheme="https://autumntail.github.io/tags/%E7%94%B5/"/>
    
  </entry>
  
  <entry>
    <title>安装厨房纯净水系统</title>
    <link href="https://autumntail.github.io/2017/04/03/%E5%AE%89%E8%A3%85%E5%8E%A8%E6%88%BF%E7%BA%AF%E5%87%80%E6%B0%B4%E7%B3%BB%E7%BB%9F/"/>
    <id>https://autumntail.github.io/2017/04/03/安装厨房纯净水系统/</id>
    <published>2017-04-03T18:40:14.000Z</published>
    <updated>2018-09-01T06:37:22.475Z</updated>
    
    <content type="html"><![CDATA[<p>刚来美国的时候，看到周围的同事们口渴了直接打口水龙头就喝，俺就跟乡下人进城一样，顿时无比惊叹美国真不愧是发达国家。生活得久了，各种信息慢慢多起来，美国自来水干净安全的神话就逐渐破灭了。而且，自来水里面用来消毒的氯离子，喝起来味道确实不咋地。</p><a id="more"></a><p>那怎么办？总不能天天去wholesale店里搬纯净水或矿泉水吧。好在，现在过滤水的设备越来越先进，越来越便宜了。最近几年流行的RO（Reverse Osmosis）系统，甚至几乎可以过滤掉水中所有的离子，让过滤后的水接近甚至达到瓶装纯净水的标准。而且，关键的，还挺便宜。于是，特爱动手的俺，有了房子，第一时间就在厨房装了一套。几年下来，使用起来还挺满意的：水可以直接喝了，烧的水也没水垢了，热水器也不用费劲去刷了… …总之，好处很多。</p><p>俺买的是Costco的4-stage的Pure Blue H2O，有四个filter，其中有两个是半年一换，一个一年一换，剩下那个2年一换。<br><img src="http://upload-images.jianshu.io/upload_images/5067306-4205e2e3d9a2734d.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="4-Stage-RO-System-NSF-450x450.jpg"><br>安装的时候需要一些简单的工具跟材料。<br><img src="http://upload-images.jianshu.io/upload_images/5067306-9d74ec5a155de89b.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="materials.jpg"><br>其中，工具3跟4不是必需的。如果厨房水池下面空间狭窄，需要移开下水管进行操作，需要工具3；如果要在水池上打一个孔，需要用到工具4。</p><p>RO系统的连接图是这样的。</p><p><img src="http://upload-images.jianshu.io/upload_images/5067306-f4fee61c322c506f.gif?imageMogr2/auto-orient/strip" alt="ro-install_system-components-diagram.gif"><br>RO系统的进水管可以从自来水的冷水管分出一个接头，这时需要一个Adaptor。</p><p><img src="http://upload-images.jianshu.io/upload_images/5067306-a39deb4d9a83120b.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="cold_water_adaptor.jpg"></p><p>这个Adaptor在俺买的系统里面送了一个塑料的，不过俺强烈建议大家替换成铜的，HD也就几块钱。那个塑料的容易漏水。</p><p>剩下的步骤，就是照上面的示意图或者说明书里的具体说明操作就行。注意在需要seal的地方正确使用seal tape跟plumber putty。</p><p>安装好后，看起来是这样。</p><p><img src="http://upload-images.jianshu.io/upload_images/5067306-3fbe13a114ff4b0b.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="ro_system_installed.jpg"></p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;刚来美国的时候，看到周围的同事们口渴了直接打口水龙头就喝，俺就跟乡下人进城一样，顿时无比惊叹美国真不愧是发达国家。生活得久了，各种信息慢慢多起来，美国自来水干净安全的神话就逐渐破灭了。而且，自来水里面用来消毒的氯离子，喝起来味道确实不咋地。&lt;/p&gt;
    
    </summary>
    
      <category term="生活DIY" scheme="https://autumntail.github.io/categories/%E7%94%9F%E6%B4%BBDIY/"/>
    
    
      <category term="水" scheme="https://autumntail.github.io/tags/%E6%B0%B4/"/>
    
  </entry>
  
  <entry>
    <title>更换浴池排水的Stopper</title>
    <link href="https://autumntail.github.io/2017/03/24/%E6%9B%B4%E6%8D%A2%E6%B5%B4%E6%B1%A0%E6%8E%92%E6%B0%B4%E7%9A%84Stopper/"/>
    <id>https://autumntail.github.io/2017/03/24/更换浴池排水的Stopper/</id>
    <published>2017-03-24T18:37:43.000Z</published>
    <updated>2018-09-01T06:37:22.476Z</updated>
    
    <content type="html"><![CDATA[<p>自从有了房子，生活多了很多乐趣，也多了很多烦心的事。房子，虽然大多数时间都是俺们温暖的港湾，但是有问题的时候还是很烦人的。</p><a id="more"></a><p>房子的问题有大有小。有的很小，处理不当，却可能整成大事故。今天，俺跟大家分享的就是一件很小很小的毛病，但是却有人就搞成了大事故。</p><p>大家的浴池，一般都会有个排水的管子，管子上有个stopper，用来排掉泡澡后的水。全新的stopper，中间会有个十字。一般更换的时候，用俺图中所示的工具1很容易就能拧下来了。</p><p><img src="http://upload-images.jianshu.io/upload_images/5067306-6d06f2287d158301.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="drain-tools.jpg"></p><p>但是时间久了，stopper的中间部分会被腐蚀，像俺的，中间的十字已经完全烂掉。这个时候要再想更换就要有点技巧了，可不能上蛮力硬干。曾经有人用锤子加螺丝刀敲，结果把下面连接的排水PVC管道给敲破了。于是一个几十块钱的小事，变成要把浴池拆开修管子的超大工程。<br><img src="http://upload-images.jianshu.io/upload_images/5067306-6910a9ba22293d39.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="腐蚀烂掉的stopper"><br>这时，大家需要的是俺前面图里的工具2，这个工具HD一般就有。用它 ，配合3/8’’的Socket Driver，用橡皮锤轻轻敲一下，或者试探着用力道下压，同时拧。试几次，就出来了。</p><p><img src="http://upload-images.jianshu.io/upload_images/5067306-99248653802b690d.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="pulled-rusted.jpg"><br>然后安装新的就简单了，抹些Plumer Putty在新的stopper周围，用工具1拧进去就行，别用太大力。</p><p><img src="http://upload-images.jianshu.io/upload_images/5067306-da5bcc82206b11cf.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="plumer_putty.jpg"></p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;自从有了房子，生活多了很多乐趣，也多了很多烦心的事。房子，虽然大多数时间都是俺们温暖的港湾，但是有问题的时候还是很烦人的。&lt;/p&gt;
    
    </summary>
    
      <category term="生活DIY" scheme="https://autumntail.github.io/categories/%E7%94%9F%E6%B4%BBDIY/"/>
    
    
      <category term="水" scheme="https://autumntail.github.io/tags/%E6%B0%B4/"/>
    
  </entry>
  
  <entry>
    <title>Storm Door安装DIY</title>
    <link href="https://autumntail.github.io/2017/03/21/Storm-Door%E5%AE%89%E8%A3%85DIY/"/>
    <id>https://autumntail.github.io/2017/03/21/Storm-Door安装DIY/</id>
    <published>2017-03-21T18:34:38.000Z</published>
    <updated>2018-09-01T06:37:22.474Z</updated>
    
    <content type="html"><![CDATA[<p>前面，俺写了篇《自己动手做Patio》。提到，后院的门跟门框很容易被水弄坏烂掉。可是，造一个Patio Cover是一个很大的工程，很多人自己做不太现实。那怎么办呢？门还是要保护起来的，不然，过几年就换一次门跟门框，也让人受不了。安装一个Storm Door可解。</p><a id="more"></a><p><img src="http://upload-images.jianshu.io/upload_images/5067306-702048632956dd87.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="烂掉的门框"><br>一个铝制的可以自动关门，带伸缩纱窗的Storm Door，在Lowe’s，HD也不过300来块。除了可以防止雨水渗透进门跟门框的缝隙，还可以打开纱窗，帮助房子空气流通；还可以在淘气的孩子们进进出出后自己关上，避免蚊子、苍蝇全飞进屋子。</p><p>相比于造一个Patio，装Storm Door是一件很简单的事情，需要的工具也不多。</p><p><img src="http://upload-images.jianshu.io/upload_images/5067306-bda751973e46700a.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="必要的工具"><br>如果你的门框已经烂掉，需要替换修补，那还需要一些木工工具，比如台锯，还有油漆跟刷漆工具。</p><p>安装之前，要先测量一下你的门框是否是标准门框（32x80’’或36x80’’），有一寸左右的误差没关系。</p><p><img src="http://upload-images.jianshu.io/upload_images/5067306-68d0a5eaa2e81745.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="测量门框"><br>俺买的是Lowe’s的Larson全景铝门，要求门框外的mold trim 1寸厚，而俺的门框trim只有3/4’’，所以俺又重新买了几块3/4’’的PVC trim贴在原来的trim上。PVC的好处是不怕水，无需重新刷漆。</p><p>一般，storm door的把手跟原来门的把手在一边，开门要方便一些。不过，安装的时候要注意把手别被原先的门把手挡住，导致storm door的门无法闭合。</p><p>按照说明书，先安装好顶部挡雨的trim，然后装门，再装另一边带锁孔的边框。带锁孔的边框安装时可以调整跟门框的距离，从而让storm door的锁刚好闭合。安装好锁孔边框后，有可能需要在锁孔的位置挖出一定深度，不然门锁不起来，俺用的是Chisel。</p><p><img src="http://upload-images.jianshu.io/upload_images/5067306-05d6492758b3a469.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="construction-chisel.jpg"></p><p><img src="http://upload-images.jianshu.io/upload_images/5067306-82540c790eb4c624.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="锁孔"></p><p>然后是安装锁，俺的这个锁跟把手是单独买，可以选择不同的颜色。</p><p><img src="http://upload-images.jianshu.io/upload_images/5067306-717a23b1b52f7fdc.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="把手的选择"><br>安装锁的时候，要用到Spade Bit打孔，这个bit在开始的工具列表里有。</p><p>最后，安装自动关门的Pneumatic Closer。</p><p><img src="http://upload-images.jianshu.io/upload_images/5067306-1d4d3f20aae82961.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="self_storing.jpg"><br>中间还有些小步骤，俺就不一一细说了，买的说明书里都有。最后，安装后是这个效果。上半部分是可伸缩的纱窗。</p><p><img src="http://upload-images.jianshu.io/upload_images/5067306-b9a90c3c0eaf92c3.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="IMG_20170315_182018.jpg"></p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;前面，俺写了篇《自己动手做Patio》。提到，后院的门跟门框很容易被水弄坏烂掉。可是，造一个Patio Cover是一个很大的工程，很多人自己做不太现实。那怎么办呢？门还是要保护起来的，不然，过几年就换一次门跟门框，也让人受不了。安装一个Storm Door可解。&lt;/p&gt;
    
    </summary>
    
      <category term="生活DIY" scheme="https://autumntail.github.io/categories/%E7%94%9F%E6%B4%BBDIY/"/>
    
    
      <category term="木工" scheme="https://autumntail.github.io/tags/%E6%9C%A8%E5%B7%A5/"/>
    
      <category term="水" scheme="https://autumntail.github.io/tags/%E6%B0%B4/"/>
    
      <category term="建筑" scheme="https://autumntail.github.io/tags/%E5%BB%BA%E7%AD%91/"/>
    
  </entry>
  
  <entry>
    <title>空调常见问题不求人</title>
    <link href="https://autumntail.github.io/2017/03/16/%E7%A9%BA%E8%B0%83%E5%B8%B8%E8%A7%81%E9%97%AE%E9%A2%98%E4%B8%8D%E6%B1%82%E4%BA%BA/"/>
    <id>https://autumntail.github.io/2017/03/16/空调常见问题不求人/</id>
    <published>2017-03-16T17:50:13.000Z</published>
    <updated>2018-09-01T06:37:22.477Z</updated>
    
    <content type="html"><![CDATA[<p>子在川上曰：”逝者如斯夫，不舍昼夜“。用俺们俗人的大白话说，就是时间如流水。这不，休斯敦的春天才刚迈开自己的脚步，夏天就迫不及待了。夏天到了，你家的中央空调准备好了么？ </p><a id="more"></a><p>美国的家用中央空调，又称为HVAC，主要包含热机跟冷机两个部分，由共用的控制系统，管道连在一起，维持室内舒适怡人的小气候。咱们今天主要说的是制冷的部分。制冷的部分主要由外部压缩机（含散热风扇）跟内部的Evaporator Coil（含内部风扇）。工作原理跟车用空调，窗式空调等一样，不复杂，都是靠制冷剂的循环完成室内室外热交换。但是家用中央空调在美国已经成为一个相对独立的行业，其维修、制造为行业所垄断，相对是比较昂贵的。但是，还是有一些常见的故障可以自己动手。就是自己不能做，略做了解，也不至于被部分黑心的公司/Contractor狠宰。俺今天就把俺维修自己家空调的几个经历结合俺对空调系统的了解跟大家分享一下。</p><p><img src="http://upload-images.jianshu.io/upload_images/5067306-d9007247bebfa78e.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="ac-diagram"> </p><p>在上面的图中，示意了中央空调的构造主要由内外两部分构成，其常见的故障主要就是在这两个点上。一个是外机不工作，最常见的是电容坏掉；一个是内部的coil排水管堵了，导致漏水，严重的会腐蚀coil，造成制冷剂泄露，空调的制冷效果会越来越差。</p><h4 id="1-检查更换空调外机的电容"><a href="#1-检查更换空调外机的电容" class="headerlink" title="1. 检查更换空调外机的电容"></a>1. 检查更换空调外机的电容</h4><p>休斯敦室外酷热的天气，简直就是空调电容的超级杀手。比如俺家的电容，直接爆浆。如果你家的空调启动了，有风吹出，但是风一点都不冷。而外机的风扇和/或压缩机没有启动，那很可能就是电容坏了。</p><p><img src="http://upload-images.jianshu.io/upload_images/5067306-effb7735223d6b50.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="broken_capacitor"></p><p>俺家的这个电容属于极端情况，或者你能看到电容已经鼓起来，都不用专门设备诊断，一看就知道坏了。</p><p><img src="http://upload-images.jianshu.io/upload_images/5067306-170ec9b446d4a4aa.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="bulging capacitor"><br>而如果外观上看不出来，那就需要有一个能测量电容的万用电表。</p><p><img src="http://upload-images.jianshu.io/upload_images/5067306-8fafa2564734688c.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="multimeter"></p><p>电容上一般都会标识容量参数跟误差范围，现在空调常用的是双电容，有三个头，分别连接contactor（C），压缩机（HERM）和风扇（FAN），量一下HERM和FAN跟C之间的电容就可以确定是不是电容坏了。更换是很简单的步骤，照着原来的连线，买个新的一样参数的（可以从Ebay/Amazon购买，或者610跟stella link那边有个Johnson Supply也可以买到，要贵不少）换上就行。需要注意的是，在做电操作时，要关掉相应的电源开关。对外机来说，开关一般在旁边的墙上。如果电容不确定是否损坏，在操作前要对其放电，以免伤到自己。</p><p><img src="http://upload-images.jianshu.io/upload_images/5067306-1ebc0091fab7f4f7.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="HVAC - Run Capacitor (102).jpg"></p><p>因为电容是非常容易损坏的部件，差的可能一两年，好的也不过三几年。因此，家里常备一个电容，很有必要。俺就的电容就是在炎热夏季的周六上午坏掉的，俺到处都没找到电容，以致于晚上都没办法睡觉。</p><h4 id="2-检查Evaporator-Coil排水系统"><a href="#2-检查Evaporator-Coil排水系统" class="headerlink" title="2. 检查Evaporator Coil排水系统"></a>2. 检查Evaporator Coil排水系统</h4><p>Evaporator Coil在热交换的时候，会导致周围空气中的水汽冷凝，需要及时排出。美国家用中央空调一般会有一个主排水管直接将水从包裹coil的容器里排到室外或者直接排到下水道里。如果这条排水管堵塞，水会流到coil下方的接水盘里，再通过一条管道将水从屋檐下的Drain Drip流出。而不幸的，如果备用管道也堵了，或者水流急，接水盘满了，水就会流到房子里，破坏你的房子。因此，如果大家发现自己的屋檐下空调排水管里时不时的流水了，就需要赶紧去疏通主排水管了。主排水管靠近内机，会有一个竖直的管子，是开口的或者只是盖了一个盖子。</p><p><img src="http://upload-images.jianshu.io/upload_images/5067306-a9e7f1aeae2451ed.JPG?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="drain_pan.JPG"></p><p><img src="http://upload-images.jianshu.io/upload_images/5067306-54356b8e28961761.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="drain_at_soffit.jpg"></p><p>打开那个盖子，用干湿两用的ShopVac吸一下，一般就可以把管道里的堵塞物吸出来。</p><p><img src="http://upload-images.jianshu.io/upload_images/5067306-67542c3c07eb188c.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="shopvac.jpg"></p><p>即使你的内外管道都是通畅的，也建议每年春秋两季的时候从那个口里倒一些Bleach进去，防止霉菌在里面安家落户，积累污垢。</p><h4 id="3-更换Zoning-Board"><a href="#3-更换Zoning-Board" class="headerlink" title="3. 更换Zoning Board"></a>3. 更换Zoning Board</h4><p>美国的独立屋（SFH）因为空间比较大，一般都会有分区系统，通过不同的thermostat控制调节不同分区的温度。如果是楼上楼下的空调没有分区，很可能会出现楼上楼下温差10几度的情形，就像俺家曾经经历过的。</p><p>俺家的房子不是很大，由一个5Ton的外机通过分区系统分成楼上楼下两部分。俺在买房的时候，分区控制的Zoning Board坏掉了。卖方Agent自告奋勇推荐了一个AC Contractor上门维修，结果，直到交房的时候，却没发现任何系统改善的迹象。俺跟卖方分别到阁楼查看，发现坏的zoning board还是挂在那儿，而Contractor却给卖方开了一个800多刀的更换账单，黑不黑？房子还要不要过户？这时，卖方agent急了，赶紧联系那边contractor再次上门。这次，<b>似乎</b>是修好了。然而，Contractor干的事是什么呢?仅仅不过是把Zoning Board上的接线都剪断了，把楼下楼上两个温控器的接线全部接到了HVAC的控制板上了，就相当于无论哪个温控工作，都会把屋里所有的管道风门打开，后果就是楼上楼下会差生巨大的温差。这次又是将近300的账单。总之，Contractor上了两次门，废掉了俺房子的分区系统，偷走了原有的高级温控器，却给卖方开出了1000多的账单。而俺，还要继续忍受着楼上楼下的巨大温差。</p><p><img src="http://upload-images.jianshu.io/upload_images/5067306-a9e4150998512641.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="hz432_hires.jpg"></p><p><img src="http://upload-images.jianshu.io/upload_images/5067306-77b8f70980abc6ab.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="control_board_1stage.jpg"></p><p>俺决定还是自己动手了，了解之下，honeywell最新的4区板（还带无线功能，配合外接router，可以连接无线温控器），不到300块就能买到。接线过程就比较简单了，把温控系统的连线，不同分区的管道风门线，各种sensor，理好后连到对应的分区就行。俺用手画了个接线图。</p><p><img src="http://upload-images.jianshu.io/upload_images/5067306-360f49353cca4fa8.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="Zoning-Wiring.jpg"></p><h4 id="4-总结"><a href="#4-总结" class="headerlink" title="4. 总结"></a>4. 总结</h4><p>上面俺总结了俺经历的几个空调常见小故障，抛砖引玉。其实，只要日常维护得当，有些小问题就可以避免，大问题就不会出现，你的空调就能发挥更大的能力，拥有更长的生命周期。</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;子在川上曰：”逝者如斯夫，不舍昼夜“。用俺们俗人的大白话说，就是时间如流水。这不，休斯敦的春天才刚迈开自己的脚步，夏天就迫不及待了。夏天到了，你家的中央空调准备好了么？ &lt;/p&gt;
    
    </summary>
    
      <category term="生活DIY" scheme="https://autumntail.github.io/categories/%E7%94%9F%E6%B4%BBDIY/"/>
    
    
      <category term="空调" scheme="https://autumntail.github.io/tags/%E7%A9%BA%E8%B0%83/"/>
    
      <category term="电" scheme="https://autumntail.github.io/tags/%E7%94%B5/"/>
    
  </entry>
  
  <entry>
    <title>自己动手做一个Covered Patio</title>
    <link href="https://autumntail.github.io/2017/03/05/%E8%87%AA%E5%B7%B1%E5%8A%A8%E6%89%8B%E5%81%9A%E4%B8%80%E4%B8%AACovered-Patio/"/>
    <id>https://autumntail.github.io/2017/03/05/自己动手做一个Covered-Patio/</id>
    <published>2017-03-05T18:58:39.000Z</published>
    <updated>2018-09-01T06:37:22.478Z</updated>
    
    <content type="html"><![CDATA[<h2 id="1-缘起"><a href="#1-缘起" class="headerlink" title="1. 缘起"></a>1. 缘起</h2><p>休斯敦的夏天实在是太长太热了，自从买了房子，俺就长草自己建一个带cover的patio，不光是可以挡风挡雨挡太阳，保护通向后院的房门（因为雨水把原来的房门、门框弄烂了，俺的前房主在卖房之前刚换过房门，修过门框）；而且可以扩大孩子玩耍的空间。</p><a id="more"></a><p>刚开始，俺在yard sale买了个二手的撑起来的棚子。然而有一个晚上，狂风大雨肆虐，把这个临时的小棚子吹得七零八落，连铝制的骨架都吹折了几根，几经尝试都不能修复。于是，建造一个结实的Patio提上了日程。</p><p>俺原先的房后是一个10x10的水泥patio，有点小。</p><p><img src="http://upload-images.jianshu.io/upload_images/5067306-79bb2d18ea7438b2.jpg" alt=""></p><p>在造cover之前，俺决定先扩展一下。整个的结构如下面的草图所示。</p><p><img src="http://upload-images.jianshu.io/upload_images/5067306-4f4d76eeaf8157f3.png" alt=""></p><h2 id="2-水泥地面"><a href="#2-水泥地面" class="headerlink" title="2. 水泥地面"></a>2. 水泥地面</h2><p>扩展水泥地面，要先把地面的草皮挖掉，有足够的深度让铺好的水泥有4寸厚，为了让新的水泥跟旧的不至于因为时间久了产生落差，最好是先在旧的水泥侧面每隔12’’钻一个6’’深的孔，埋入1/2’’的rebar，跟新水泥的remesh绑在一起。不过，俺买了一个专用水泥钻头，用hammer drill试了一下，实在是太费劲了，只好放弃。</p><p><img src="http://upload-images.jianshu.io/upload_images/5067306-a96f99200de4c4c2.JPG" alt=""></p><p>俺在新水泥准备放cover柱子的位置，挖了几个深坑，约12’’，用来承受新造的cover重量。</p><p>水泥俺使用的时Homedepot买的quickrete concrete mix，里面已经混合好了水泥、石子和玻璃纤维，直接加水混合就可使用。60lb一包混合后为0.45 cubic feet，80lb一包混合后为0.55 cubic feet，可以此计算一个工程共需要多少包。</p><p>用2x4的stud订好框架，用水平仪量好角度，以便控制将来水泥地面上的水流向远离房子的方向。把混合好的水泥倒进框架里，抹平，用edger平滑一下边缘。这之间，俺还加了一步，就是埋入cover的archor，如图所示。</p><p><img src="http://upload-images.jianshu.io/upload_images/5067306-e4d362a88a93acb2.jpg" alt=""></p><h2 id="3-搭架子"><a href="#3-搭架子" class="headerlink" title="3. 搭架子"></a>3. 搭架子</h2><p>美国的民居，主要是木制结构，传统的patio cover，也是木制结构。造木制结构的patio cover，其实跟造房子是大致一样的。不一样的是，木制patio cover由于没有墙来抵消水平方向的力，所以容易不稳产生晃动。一般，如果你的patio cover是builder在造房子的时候一起造的，那这个cover会跟你的房体结合在一起，靠房子来固定patio cover。而如果房子造好了，请专业人士来新置一个patio cover，目下的contractor一般会推荐你造一个铝制的，易于维护，结构简单轻便，不怕水，刚性强，不会像木制品在水平力的作用下产生晃动。而如果你坚持请人造一个木制的，那成本会大幅攀升，而且如果contractor不仔细没处理好，还会发生雨水进入你的房体，破坏房子等很严重的后果。</p><p>铝制品的cover，在下雨的时候，雨滴打在上面会产生比较大的噪声，而俺们家有三个卧室靠着后院的墙，下雨的时候会影响某些人的睡眠，被否决了。而为了不影响房子，俺选择让patio cover自己承受自己的重量，有独立的6根桩子，只是跟房子挨在一起。好处是不影响房子，坏处是底下看起来比较拥挤。</p><p>搭框架的过程比较简单。首先把6根PT的木头立起来，保持竖直，用做过防锈处理的钉子跟地面上的archor固定在一起。把前后beam安装上去，俺的beam用两根2x8’’x20’的stud并在一起（友情提醒：beam的宽度、厚度的选择跟柱子的间隔距离有关）。</p><p><img src="http://upload-images.jianshu.io/upload_images/5067306-a7509c9b33e0bd82.jpg" alt=""></p><p>最后，用2x6’’x12’的stud以24’’的间隔把前后两根横梁连起来，每两根stud之间用横木加固。前面跟两侧留出足够的空间安装soffit用来给内部的木头通气。</p><p><img src="http://upload-images.jianshu.io/upload_images/5067306-44fc33d23011253c.jpg" alt=""></p><p><img src="http://upload-images.jianshu.io/upload_images/5067306-49cca7a6b9cbdef4.JPG" alt=""></p><h2 id="4-屋顶"><a href="#4-屋顶" class="headerlink" title="4. 屋顶"></a>4. 屋顶</h2><p>一般木制结构的屋顶会铺上asphalt shingles，有比较好的经济性和耐用性，也可以很好的吸收雨滴的噪声。要铺shingles，屋顶要先铺一层3/4’’的radiant barrier板子（普通的OSB板也一样，前者好多是可以反射部分热量，让阁楼、下方凉快些，毕竟德州的热量，大家都懂的），上面是一层沥青防水材料。为了防止大风吹着雨水进入shingles，不同的屋顶倾角铺设沥青防水层的步骤略有不同。对于小于4/12的屋顶，沥青防水层按照下面图示的方法铺。</p><p><img src="http://upload-images.jianshu.io/upload_images/5067306-07c780f4bd852dfc.jpg" alt=""></p><p>处理好了防水层，就可以铺瓦片了，瓦片的铺设有很多现成的教程，俺就不细说了。下图是已经铺好瓦片，装好drip edge跟fascia board的样子。</p><p><img src="http://upload-images.jianshu.io/upload_images/5067306-ffc0e2cb99be7783.jpg" alt=""></p><h2 id="5-风扇"><a href="#5-风扇" class="headerlink" title="5. 风扇"></a>5. 风扇</h2><p>装好屋顶，安装好朝外的防水板（俺用的是48x96’’的SmartSide板子切割成需要的大小，防水防虫）后，整个patio cover的基本结构就完工了 。但是，屋顶的内部，木头还裸露在外，外了避免潮湿空气、害虫等破坏未经处理的木头，需要对这些裸露的木头进行包装。俺用防水板把整个屋顶全部包裹起来，内部是一个空腔，类似于房子的阁楼，用来保持木头所处环境的相对稳定，阁楼通过soffit的通风口跟外部交换空气。</p><p><img src="http://upload-images.jianshu.io/upload_images/5067306-482c8b6dfa4cde17.png" alt=""></p><p>在封闭顶棚的过程中，俺顺便连接了安装风扇用的线路。户外的电线，不能裸露在外，要用专门的管子包裹起来，这种管子有金属材料的，有塑料材料的。俺用的是塑料的，比较容易安装。</p><p><img src="http://upload-images.jianshu.io/upload_images/5067306-405f4d3a6ca9cba3.jpg" alt=""></p><p>风扇的基座固定在顶部的木梁上。</p><p><img src="http://upload-images.jianshu.io/upload_images/5067306-f6605cfed54f8d69.png" alt=""></p><p>线都连好后，安装风扇的过程就很简单了。买一个户外专用的风扇，固定到风扇基座上。</p><p><img src="http://upload-images.jianshu.io/upload_images/5067306-eeb77f91cbe6ab77.jpg" alt=""> </p><h2 id="6-Gutter"><a href="#6-Gutter" class="headerlink" title="6. Gutter"></a>6. Gutter</h2><p>Patio cover造好后，下雨时水流会顺着顶部的坡度流到前面的水泥地上，水流急的时候，会把水溅得到处都是，安装一个rain gutter可以很好的解决这个问题。Gutter跟屋檐的关系如下图所示。</p><p><img src="http://upload-images.jianshu.io/upload_images/5067306-46ffd131f5574a28.jpg" alt=""></p><p>为了让gutter里的水流到地面上，gutter在水平方向上要有一定的倾斜角度。一般的，每隔20’下降1’’。</p><p><img src="http://upload-images.jianshu.io/upload_images/5067306-c38626f1a8a74210.png" alt=""></p><p>最后为了让柱子看起来更美观些，俺用涂过户外水性白色油漆的自制column wrap把柱子包裹起来，如果柱子本来就很粗，可以直接在外面刷层漆或者stain一下就可以。</p><p><img src="http://upload-images.jianshu.io/upload_images/5067306-fbf0e3e024023fc4.jpg" alt=""></p><h2 id="7-结语"><a href="#7-结语" class="headerlink" title="7. 结语"></a>7. 结语</h2><p>这是俺做的历时最长的大过程，其间走过不少弯路。虽然看起来步骤似乎比较多，实际上并不比造一个工具房复杂。最主要的需要注意的就是要处理好水平力，这个俺前面已经提过，再次强调下。俺的建议是，用尽量粗的柱子，柱子底部用砖或者水泥结构，让柱子的木头部分尽量短。</p><p>造的过程中，俺在横梁上装了四个挂秋千的挂勾。这几个秋千后来成为俺家两娃最爱的玩具。</p>]]></content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;1-缘起&quot;&gt;&lt;a href=&quot;#1-缘起&quot; class=&quot;headerlink&quot; title=&quot;1. 缘起&quot;&gt;&lt;/a&gt;1. 缘起&lt;/h2&gt;&lt;p&gt;休斯敦的夏天实在是太长太热了，自从买了房子，俺就长草自己建一个带cover的patio，不光是可以挡风挡雨挡太阳，保护通向后院的房门（因为雨水把原来的房门、门框弄烂了，俺的前房主在卖房之前刚换过房门，修过门框）；而且可以扩大孩子玩耍的空间。&lt;/p&gt;
    
    </summary>
    
      <category term="生活DIY" scheme="https://autumntail.github.io/categories/%E7%94%9F%E6%B4%BBDIY/"/>
    
    
      <category term="木工" scheme="https://autumntail.github.io/tags/%E6%9C%A8%E5%B7%A5/"/>
    
      <category term="建筑" scheme="https://autumntail.github.io/tags/%E5%BB%BA%E7%AD%91/"/>
    
      <category term="电" scheme="https://autumntail.github.io/tags/%E7%94%B5/"/>
    
  </entry>
  
</feed>
